window.__require=function e(t,i,n){function s(a,r){if(!i[a]){if(!t[a]){var d=a.split("/");if(d=d[d.length-1],!t[d]){var c="function"==typeof __require&&__require;if(!r&&c)return c(d,!0);if(o)return o(d,!0);throw new Error("Cannot find module '"+a+"'")}}var l=i[a]={exports:{}};t[a][0].call(l.exports,function(e){return s(t[a][1][e]||e)},l,l.exports,e,t,i,n)}return i[a].exports}for(var o="function"==typeof __require&&__require,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(e,t,i){"use strict";var n=n||function(e,t){var i={},n=i.lib={},s=function(){},o=n.Base={extend:function(e){s.prototype=this;var t=new s;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var s=0;s<e;s++)t[n+s>>>2]|=(i[s>>>2]>>>24-s%4*8&255)<<24-(n+s)%4*8;else if(65535<i.length)for(s=0;s<e;s+=4)t[n+s>>>2]=i[s>>>2];else t.push.apply(t,i);return this.sigBytes+=e,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(4294967296*e.random()|0);return new a.init(i,t)}}),r=i.enc={},d=r.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(i,t/2)}},c=r.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var i=[],n=0;n<e;n++)i.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(i,t)}},l=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=n.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,n=i.words,s=i.sigBytes,o=this.blockSize,r=s/(4*o);if(t=(r=t?e.ceil(r):e.max((0|r)-this._minBufferSize,0))*o,s=e.min(4*t,s),t){for(var d=0;d<t;d+=o)this._doProcessBlock(n,d);d=n.splice(0,t),i.sigBytes-=s}return new a.init(d,s)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new h.HMAC.init(e,i).finalize(t)}}});var h=i.algo={};return i}(Math);(function(e){for(var t=n,i=(o=t.lib).WordArray,s=o.Hasher,o=t.algo,a=[],r=[],d=function(e){return 4294967296*(e-(0|e))|0},c=2,l=0;64>l;){var u;e:{u=c;for(var h=e.sqrt(u),m=2;m<=h;m++)if(!(u%m)){u=!1;break e}u=!0}u&&(8>l&&(a[l]=d(e.pow(c,.5))),r[l]=d(e.pow(c,1/3)),l++),c++}var g=[];o=o.SHA256=s.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],s=i[1],o=i[2],a=i[3],d=i[4],c=i[5],l=i[6],u=i[7],h=0;64>h;h++){if(16>h)g[h]=0|e[t+h];else{var m=g[h-15],p=g[h-2];g[h]=((m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3)+g[h-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+g[h-16]}m=u+((d<<26|d>>>6)^(d<<21|d>>>11)^(d<<7|d>>>25))+(d&c^~d&l)+r[h]+g[h],p=((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+(n&s^n&o^s&o),u=l,l=c,c=d,d=a+m|0,a=o,o=s,s=n,n=m+p|0}i[0]=i[0]+n|0,i[1]=i[1]+s|0,i[2]=i[2]+o|0,i[3]=i[3]+a|0,i[4]=i[4]+d|0,i[5]=i[5]+c|0,i[6]=i[6]+l|0,i[7]=i[7]+u|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;return i[s>>>5]|=128<<24-s%32,i[14+(s+64>>>9<<4)]=e.floor(n/4294967296),i[15+(s+64>>>9<<4)]=n,t.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(o),t.HmacSHA256=s._createHmacHelper(o)})(Math),function(){var e=n,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,i){e=this._hasher=new e.init,"string"==typeof i&&(i=t.parse(i));var n=e.blockSize,s=4*n;i.sigBytes>s&&(i=e.finalize(i)),i.clamp();for(var o=this._oKey=i.clone(),a=this._iKey=i.clone(),r=o.words,d=a.words,c=0;c<n;c++)r[c]^=1549556828,d[c]^=909522486;o.sigBytes=a.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=n,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,i=e.sigBytes,n=this._map;e.clamp(),e=[];for(var s=0;s<i;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;4>a&&s+.75*a<i;a++)e.push(n.charAt(o>>>6*(3-a)&63));if(t=n.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var i=e.length,n=this._map;(s=n.charAt(64))&&(-1!=(s=e.indexOf(s))&&(i=s));for(var s=[],o=0,a=0;a<i;a++)if(a%4){var r=n.indexOf(e.charAt(a-1))<<a%4*2,d=n.indexOf(e.charAt(a))>>>6-a%4*2;s[o>>>2]|=(r|d)<<24-o%4*8,o++}return t.create(s,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){(function(e){e[e.Undefined=0]="Undefined",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical"})(e.EGAErrorSeverity||(e.EGAErrorSeverity={})),function(e){e[e.Undefined=0]="Undefined",e[e.Male=1]="Male",e[e.Female=2]="Female"}(e.EGAGender||(e.EGAGender={})),function(e){e[e.Undefined=0]="Undefined",e[e.Start=1]="Start",e[e.Complete=2]="Complete",e[e.Fail=3]="Fail"}(e.EGAProgressionStatus||(e.EGAProgressionStatus={})),function(e){e[e.Undefined=0]="Undefined",e[e.Source=1]="Source",e[e.Sink=2]="Sink"}(e.EGAResourceFlowType||(e.EGAResourceFlowType={})),function(e){(function(e){e[e.Undefined=0]="Undefined",e[e.Rejected=1]="Rejected"})(e.EGASdkErrorType||(e.EGASdkErrorType={})),function(e){e[e.NoResponse=0]="NoResponse",e[e.BadResponse=1]="BadResponse",e[e.RequestTimeout=2]="RequestTimeout",e[e.JsonEncodeFailed=3]="JsonEncodeFailed",e[e.JsonDecodeFailed=4]="JsonDecodeFailed",e[e.InternalServerError=5]="InternalServerError",e[e.BadRequest=6]="BadRequest",e[e.Unauthorized=7]="Unauthorized",e[e.UnknownResponseCode=8]="UnknownResponseCode",e[e.Ok=9]="Ok"}(e.EGAHTTPApiResponse||(e.EGAHTTPApiResponse={}))}(e.http||(e.http={}))}(s||(s={}));var s;s.EGAErrorSeverity,s.EGAGender,s.EGAProgressionStatus,s.EGAResourceFlowType;(function(e){(function(e){var t;(function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Debug=3]="Debug"})(t||(t={}));var i=function(){function e(){e.debugEnabled=!1}return e.setInfoLog=function(t){e.instance.infoLogEnabled=t},e.setVerboseLog=function(t){e.instance.infoLogVerboseEnabled=t},e.i=function(i){if(e.instance.infoLogEnabled){var n="Info/"+e.Tag+": "+i;e.instance.sendNotificationMessage(n,t.Info)}},e.w=function(i){var n="Warning/"+e.Tag+": "+i;e.instance.sendNotificationMessage(n,t.Warning)},e.e=function(i){var n="Error/"+e.Tag+": "+i;e.instance.sendNotificationMessage(n,t.Error)},e.ii=function(i){if(e.instance.infoLogVerboseEnabled){var n="Verbose/"+e.Tag+": "+i;e.instance.sendNotificationMessage(n,t.Info)}},e.d=function(i){if(e.debugEnabled){var n="Debug/"+e.Tag+": "+i;e.instance.sendNotificationMessage(n,t.Debug)}},e.prototype.sendNotificationMessage=function(e,i){switch(i){case t.Error:console.error(e);break;case t.Warning:console.warn(e);break;case t.Debug:"function"==typeof console.debug?console.debug(e):console.log(e);break;case t.Info:console.log(e)}},e.instance=new e,e.Tag="GameAnalytics",e}();e.GALogger=i})(e.logging||(e.logging={}))})(s||(s={})),function(e){(function(t){var i=e.logging.GALogger,s=function(){function e(){}return e.getHmac=function(e,t){var i=n.HmacSHA256(t,e);return n.enc.Base64.stringify(i)},e.stringMatch=function(e,t){return!(!e||!t)&&t.test(e)},e.joinStringArray=function(e,t){for(var i="",n=0,s=e.length;n<s;n++)n>0&&(i+=t),i+=e[n];return i},e.stringArrayContainsString=function(e,t){if(0===e.length)return!1;for(var i in e)if(e[i]===t)return!0;return!1},e.encode64=function(t){t=encodeURI(t);var i,n,s,o,a,r="",d=0,c=0,l=0;do{s=(i=t.charCodeAt(l++))>>2,o=(3&i)<<4|(n=t.charCodeAt(l++))>>4,a=(15&n)<<2|(d=t.charCodeAt(l++))>>6,c=63&d,isNaN(n)?a=c=64:isNaN(d)&&(c=64),r=r+e.keyStr.charAt(s)+e.keyStr.charAt(o)+e.keyStr.charAt(a)+e.keyStr.charAt(c),i=n=d=0,s=o=a=c=0}while(l<t.length);return r},e.decode64=function(t){var n,s,o,a,r="",d=0,c=0,l=0;/[^A-Za-z0-9\+\/\=]/g.exec(t)&&i.w("There were invalid base64 characters in the input text. Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='. Expect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{n=e.keyStr.indexOf(t.charAt(l++))<<2|(o=e.keyStr.indexOf(t.charAt(l++)))>>4,s=(15&o)<<4|(a=e.keyStr.indexOf(t.charAt(l++)))>>2,d=(3&a)<<6|(c=e.keyStr.indexOf(t.charAt(l++))),r+=String.fromCharCode(n),64!=a&&(r+=String.fromCharCode(s)),64!=c&&(r+=String.fromCharCode(d)),n=s=d=0,o=a=c=0}while(l<t.length);return decodeURI(r)},e.timeIntervalSince1970=function(){var e=new Date;return Math.round(e.getTime()/1e3)},e.createGuid=function(){return(e.s4()+e.s4()+"-"+e.s4()+"-4"+e.s4().substr(0,3)+"-"+e.s4()+"-"+e.s4()+e.s4()+e.s4()).toLowerCase()},e.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e}();t.GAUtilities=s})(e.utilities||(e.utilities={}))}(s||(s={})),function(e){(function(t){var i=e.logging.GALogger,n=e.http.EGASdkErrorType,s=e.utilities.GAUtilities,o=function(){function t(){}return t.validateBusinessEvent=function(e,n,s,o,a){return t.validateCurrency(e)?n<0?(i.w("Validation fail - business event - amount. Cannot be less than 0. Failed amount: "+n),!1):t.validateShortString(s,!0)?t.validateEventPartLength(o,!1)?t.validateEventPartCharacters(o)?t.validateEventPartLength(a,!1)?!!t.validateEventPartCharacters(a)||(i.w("Validation fail - business event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+a),!1):(i.w("Validation fail - business event - itemId. Cannot be (null), empty or above 64 characters. String: "+a),!1):(i.w("Validation fail - business event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+o),!1):(i.w("Validation fail - business event - itemType: Cannot be (null), empty or above 64 characters. String: "+o),!1):(i.w("Validation fail - business event - cartType. Cannot be above 32 length. String: "+s),!1):(i.w("Validation fail - business event - currency: Cannot be (null) and need to be A-Z, 3 characters and in the standard at openexchangerates.org. Failed currency: "+e),!1)},t.validateResourceEvent=function(n,o,a,r,d,c,l){return n==e.EGAResourceFlowType.Undefined?(i.w("Validation fail - resource event - flowType: Invalid flow type."),!1):o?s.stringArrayContainsString(c,o)?a>0?r?t.validateEventPartLength(r,!1)?t.validateEventPartCharacters(r)?s.stringArrayContainsString(l,r)?t.validateEventPartLength(d,!1)?!!t.validateEventPartCharacters(d)||(i.w("Validation fail - resource event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+d),!1):(i.w("Validation fail - resource event - itemId: Cannot be (null), empty or above 64 characters. String: "+d),!1):(i.w("Validation fail - resource event - itemType: Not found in list of pre-defined available resource itemTypes. String: "+r),!1):(i.w("Validation fail - resource event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+r),!1):(i.w("Validation fail - resource event - itemType: Cannot be (null), empty or above 64 characters. String: "+r),!1):(i.w("Validation fail - resource event - itemType: Cannot be (null)"),!1):(i.w("Validation fail - resource event - amount: Float amount cannot be 0 or negative. Value: "+a),!1):(i.w("Validation fail - resource event - currency: Not found in list of pre-defined available resource currencies. String: "+o),!1):(i.w("Validation fail - resource event - currency: Cannot be (null)"),!1)},t.validateProgressionEvent=function(n,s,o,a){if(n==e.EGAProgressionStatus.Undefined)return i.w("Validation fail - progression event: Invalid progression status."),!1;if(a&&!o&&s)return i.w("Validation fail - progression event: 03 found but 01+02 are invalid. Progression must be set as either 01, 01+02 or 01+02+03."),!1;if(o&&!s)return i.w("Validation fail - progression event: 02 found but not 01. Progression must be set as either 01, 01+02 or 01+02+03"),!1;if(!s)return i.w("Validation fail - progression event: progression01 not valid. Progressions must be set as either 01, 01+02 or 01+02+03"),!1;if(!t.validateEventPartLength(s,!1))return i.w("Validation fail - progression event - progression01: Cannot be (null), empty or above 64 characters. String: "+s),!1;if(!t.validateEventPartCharacters(s))return i.w("Validation fail - progression event - progression01: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+s),!1;if(o){if(!t.validateEventPartLength(o,!0))return i.w("Validation fail - progression event - progression02: Cannot be empty or above 64 characters. String: "+o),!1;if(!t.validateEventPartCharacters(o))return i.w("Validation fail - progression event - progression02: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+o),!1}if(a){if(!t.validateEventPartLength(a,!0))return i.w("Validation fail - progression event - progression03: Cannot be empty or above 64 characters. String: "+a),!1;if(!t.validateEventPartCharacters(a))return i.w("Validation fail - progression event - progression03: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+a),!1}return!0},t.validateDesignEvent=function(e,n){return t.validateEventIdLength(e)?!!t.validateEventIdCharacters(e)||(i.w("Validation fail - design event - eventId: Non valid characters. Only allowed A-z, 0-9, -_., ()!?. String: "+e),!1):(i.w("Validation fail - design event - eventId: Cannot be (null) or empty. Only 5 event parts allowed seperated by :. Each part need to be 32 characters or less. String: "+e),!1)},t.validateErrorEvent=function(n,s){return n==e.EGAErrorSeverity.Undefined?(i.w("Validation fail - error event - severity: Severity was unsupported value."),!1):!!t.validateLongString(s,!0)||(i.w("Validation fail - error event - message: Message cannot be above 8192 characters."),!1)},t.validateSdkErrorEvent=function(e,s,o){return!!t.validateKeys(e,s)&&(o!==n.Undefined||(i.w("Validation fail - sdk error event - type: Type was unsupported value."),!1))},t.validateKeys=function(e,t){return!(!s.stringMatch(e,/^[A-z0-9]{32}$/)||!s.stringMatch(t,/^[A-z0-9]{40}$/))},t.validateCurrency=function(e){return!!e&&!!s.stringMatch(e,/^[A-Z]{3}$/)},t.validateEventPartLength=function(e,t){return!(!t||e)||!!e&&!(e.length>64)},t.validateEventPartCharacters=function(e){return!!s.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}$/)},t.validateEventIdLength=function(e){return!!e&&!!s.stringMatch(e,/^[^:]{1,64}(?::[^:]{1,64}){0,4}$/)},t.validateEventIdCharacters=function(e){return!!e&&!!s.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}(:[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}){0,4}$/)},t.validateAndCleanInitRequestResponse=function(e){if(null==e)return i.w("validateInitRequestResponse failed - no response dictionary."),null;var t={};try{t.enabled=e.enabled}catch(e){return i.w("validateInitRequestResponse failed - invalid type in 'enabled' field."),null}try{var n=e.server_ts;if(!(n>0))return i.w("validateInitRequestResponse failed - invalid value in 'server_ts' field."),null;t.server_ts=n}catch(t){return i.w("validateInitRequestResponse failed - invalid type in 'server_ts' field. type="+typeof e.server_ts+", value="+e.server_ts+", "+t),null}try{var s=e.configurations;t.configurations=s}catch(t){return i.w("validateInitRequestResponse failed - invalid type in 'configurations' field. type="+typeof e.configurations+", value="+e.configurations+", "+t),null}return t},t.validateBuild=function(e){return!!t.validateShortString(e,!1)},t.validateSdkWrapperVersion=function(e){return!!s.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/)},t.validateEngineVersion=function(e){return!(!e||!s.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/))},t.validateUserId=function(e){return!!t.validateString(e,!1)||(i.w("Validation fail - user id: id cannot be (null), empty or above 64 characters."),!1)},t.validateShortString=function(e,t){return!(!t||e)||!(!e||e.length>32)},t.validateString=function(e,t){return!(!t||e)||!(!e||e.length>64)},t.validateLongString=function(e,t){return!(!t||e)||!(!e||e.length>8192)},t.validateConnectionType=function(e){return s.stringMatch(e,/^(wwan|wifi|lan|offline)$/)},t.validateCustomDimensions=function(e){return t.validateArrayOfStrings(20,32,!1,"custom dimensions",e)},t.validateResourceCurrencies=function(e){if(!t.validateArrayOfStrings(20,64,!1,"resource currencies",e))return!1;for(var n=0;n<e.length;++n)if(!s.stringMatch(e[n],/^[A-Za-z]+$/))return i.w("resource currencies validation failed: a resource currency can only be A-Z, a-z. String was: "+e[n]),!1;return!0},t.validateResourceItemTypes=function(e){if(!t.validateArrayOfStrings(20,32,!1,"resource item types",e))return!1;for(var n=0;n<e.length;++n)if(!t.validateEventPartCharacters(e[n]))return i.w("resource item types validation failed: a resource item type cannot contain other characters than A-z, 0-9, -_., ()!?. String was: "+e[n]),!1;return!0},t.validateDimension01=function(e,t){return!e||!!s.stringArrayContainsString(t,e)},t.validateDimension02=function(e,t){return!e||!!s.stringArrayContainsString(t,e)},t.validateDimension03=function(e,t){return!e||!!s.stringArrayContainsString(t,e)},t.validateArrayOfStrings=function(e,t,n,s,o){var a=s;if(a||(a="Array"),!o)return i.w(a+" validation failed: array cannot be null. "),!1;if(0==n&&0==o.length)return i.w(a+" validation failed: array cannot be empty. "),!1;if(e>0&&o.length>e)return i.w(a+" validation failed: array cannot exceed "+e+" values. It has "+o.length+" values."),!1;for(var r=0;r<o.length;++r){var d=o[r]?o[r].length:0;if(0===d)return i.w(a+" validation failed: contained an empty string. Array="+JSON.stringify(o)),!1;if(t>0&&d>t)return i.w(a+" validation failed: a string exceeded max allowed length (which is: "+t+"). String was: "+o[r]),!1}return!0},t.validateFacebookId=function(e){return!!t.validateString(e,!1)||(i.w("Validation fail - facebook id: id cannot be (null), empty or above 64 characters."),!1)},t.validateGender=function(t){if(isNaN(Number(e.EGAGender[t]))){if(t==e.EGAGender.Undefined||t!=e.EGAGender.Male&&t!=e.EGAGender.Female)return i.w("Validation fail - gender: Has to be 'male' or 'female'. Was: "+t),!1}else if(t==e.EGAGender[e.EGAGender.Undefined]||t!=e.EGAGender[e.EGAGender.Male]&&t!=e.EGAGender[e.EGAGender.Female])return i.w("Validation fail - gender: Has to be 'male' or 'female'. Was: "+t),!1;return!0},t.validateBirthyear=function(e){return!(e<0||e>9999)||(i.w("Validation fail - birthYear: Cannot be (null) or invalid range."),!1)},t.validateClientTs=function(e){return!(e<-4294967294||e>4294967294)},t}();t.GAValidator=o})(e.validators||(e.validators={}))}(s||(s={})),function(e){(function(e){var t=function(){return function(e,t,i){this.name=e,this.value=t,this.version=i}}();e.NameValueVersion=t;var i=function(){return function(e,t){this.name=e,this.version=t}}();e.NameVersion=i;var n=function(){function e(){}return e.touch=function(){},e.getRelevantSdkVersion=function(){return e.sdkGameEngineVersion?e.sdkGameEngineVersion:e.sdkWrapperVersion},e.getConnectionType=function(){return e.connectionType},e.updateConnectionType=function(){navigator.onLine?"ios"===e.buildPlatform||"android"===e.buildPlatform?e.connectionType="wwan":e.connectionType="lan":e.connectionType="offline"},e.getOSVersionString=function(){return e.buildPlatform+" "+e.osVersionPair.version},e.runtimePlatformToString=function(){return e.osVersionPair.name},e.getBrowserVersionString=function(){var t,i=navigator.userAgent,n=i.match(/(opera|chrome|safari|firefox|ubrowser|msie|trident|fbav(?=\/))\/?\s*(\d+)/i)||[];if(0==n.length&&"ios"===e.buildPlatform)return"webkit_"+e.osVersion;if(/trident/i.test(n[1]))return"IE "+((t=/\brv[ :]+(\d+)/g.exec(i)||[])[1]||"");if("Chrome"===n[1]&&null!=(t=i.match(/\b(OPR|Edge|UBrowser)\/(\d+)/)))return t.slice(1).join(" ").replace("OPR","Opera").replace("UBrowser","UC").toLowerCase();if(n[1]&&"fbav"===n[1].toLowerCase()&&(n[1]="facebook",n[2]))return"facebook "+n[2];var s=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!=(t=i.match(/version\/(\d+)/i))&&s.splice(1,1,t[1]),s.join(" ").toLowerCase()},e.getDeviceModel=function(){return"unknown"},e.getDeviceManufacturer=function(){return"unknown"},e.matchItem=function(e,t){var n,s,o,a,r=new i("unknown","0.0.0"),d=0,c=0;for(d=0;d<t.length;d+=1)if(new RegExp(t[d].value,"i").test(e)){if(n=new RegExp(t[d].version+"[- /:;]([\\d._]+)","i"),a="",(s=e.match(n))&&s[1]&&(o=s[1]),o){var l=o.split(/[._]+/);for(c=0;c<Math.min(l.length,3);c+=1)a+=l[c]+(c<Math.min(l.length,3)-1?".":"")}else a="0.0.0";return r.name=t[d].name,r.version=a,r}return r},e.sdkWrapperVersion="javascript 3.1.2",e.osVersionPair=e.matchItem([navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor].join(" "),[new t("windows_phone","Windows Phone","OS"),new t("windows","Win","NT"),new t("ios","iPhone","OS"),new t("ios","iPad","OS"),new t("ios","iPod","OS"),new t("android","Android","Android"),new t("blackBerry","BlackBerry","/"),new t("mac_osx","Mac","OS X"),new t("tizen","Tizen","Tizen"),new t("linux","Linux","rv")]),e.buildPlatform=e.runtimePlatformToString(),e.deviceModel=e.getDeviceModel(),e.deviceManufacturer=e.getDeviceManufacturer(),e.osVersion=e.getOSVersionString(),e.browserVersion=e.getBrowserVersionString(),e.maxSafeInteger=Math.pow(2,53)-1,e}();e.GADevice=n})(e.device||(e.device={}))}(s||(s={})),function(e){(function(e){var t=function(){function e(t){this.deadline=t,this.ignore=!1,this.async=!1,this.running=!1,this.id=++e.idCounter}return e.idCounter=0,e}();e.TimedBlock=t})(e.threading||(e.threading={}))}(s||(s={})),function(e){(function(e){var t=function(){function e(e){this.comparer=e,this._subQueues={},this._sortedKeys=[]}return e.prototype.enqueue=function(e,t){-1===this._sortedKeys.indexOf(e)&&this.addQueueOfPriority(e),this._subQueues[e].push(t)},e.prototype.addQueueOfPriority=function(e){var t=this;this._sortedKeys.push(e),this._sortedKeys.sort(function(e,i){return t.comparer.compare(e,i)}),this._subQueues[e]=[]},e.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},e.prototype.hasItems=function(){return this._sortedKeys.length>0},e.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},e.prototype.dequeueFromHighPriorityQueue=function(){var e=this._sortedKeys[0],t=this._subQueues[e].shift();return 0===this._subQueues[e].length&&(this._sortedKeys.shift(),delete this._subQueues[e]),t},e}();e.PriorityQueue=t})(e.threading||(e.threading={}))}(s||(s={})),function(e){(function(t){var i,n,s=e.logging.GALogger;(function(e){e[e.Equal=0]="Equal",e[e.LessOrEqual=1]="LessOrEqual",e[e.NotEqual=2]="NotEqual"})(i=t.EGAStoreArgsOperator||(t.EGAStoreArgsOperator={})),function(e){e[e.Events=0]="Events",e[e.Sessions=1]="Sessions",e[e.Progression=2]="Progression"}(n=t.EGAStore||(t.EGAStore={}));var o=function(){function e(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"==typeof localStorage?(localStorage.setItem("testingLocalStorage","yes"),localStorage.removeItem("testingLocalStorage"),e.storageAvailable=!0):e.storageAvailable=!1}catch(e){}}return e.isStorageAvailable=function(){return e.storageAvailable},e.isStoreTooLargeForEvents=function(){return e.instance.eventsStore.length+e.instance.sessionsStore.length>e.MaxNumberOfEntries},e.select=function(t,n,s,o){void 0===n&&(n=[]),void 0===s&&(s=!1),void 0===o&&(o=0);var a=e.getStore(t);if(!a)return null;for(var r=[],d=0;d<a.length;++d){for(var c=a[d],l=!0,u=0;u<n.length;++u){var h=n[u];if(c[h[0]])switch(h[1]){case i.Equal:l=c[h[0]]==h[2];break;case i.LessOrEqual:l=c[h[0]]<=h[2];break;case i.NotEqual:l=c[h[0]]!=h[2];break;default:l=!1}else l=!1;if(!l)break}l&&r.push(c)}return s&&r.sort(function(e,t){return e.client_ts-t.client_ts}),o>0&&r.length>o&&(r=r.slice(0,o+1)),r},e.update=function(t,n,s){void 0===s&&(s=[]);var o=e.getStore(t);if(!o)return!1;for(var a=0;a<o.length;++a){for(var r=o[a],d=!0,c=0;c<s.length;++c){var l=s[c];if(r[l[0]])switch(l[1]){case i.Equal:d=r[l[0]]==l[2];break;case i.LessOrEqual:d=r[l[0]]<=l[2];break;case i.NotEqual:d=r[l[0]]!=l[2];break;default:d=!1}else d=!1;if(!d)break}if(d)for(c=0;c<n.length;++c){var u=n[c];r[u[0]]=u[1]}}return!0},e.delete=function(t,n){var s=e.getStore(t);if(s)for(var o=0;o<s.length;++o){for(var a=s[o],r=!0,d=0;d<n.length;++d){var c=n[d];if(a[c[0]])switch(c[1]){case i.Equal:r=a[c[0]]==c[2];break;case i.LessOrEqual:r=a[c[0]]<=c[2];break;case i.NotEqual:r=a[c[0]]!=c[2];break;default:r=!1}else r=!1;if(!r)break}r&&(s.splice(o,1),--o)}},e.insert=function(t,i,n,s){void 0===n&&(n=!1),void 0===s&&(s=null);var o=e.getStore(t);if(o)if(n){if(!s)return;for(var a=!1,r=0;r<o.length;++r){var d=o[r];if(d[s]==i[s]){for(var c in i)d[c]=i[c];a=!0;break}}a||o.push(i)}else o.push(i)},e.save=function(){e.isStorageAvailable()?(localStorage.setItem(e.KeyPrefix+e.EventsStoreKey,JSON.stringify(e.instance.eventsStore)),localStorage.setItem(e.KeyPrefix+e.SessionsStoreKey,JSON.stringify(e.instance.sessionsStore)),localStorage.setItem(e.KeyPrefix+e.ProgressionStoreKey,JSON.stringify(e.instance.progressionStore)),localStorage.setItem(e.KeyPrefix+e.ItemsStoreKey,JSON.stringify(e.instance.storeItems))):s.w("Storage is not available, cannot save.")},e.load=function(){if(e.isStorageAvailable()){try{e.instance.eventsStore=JSON.parse(localStorage.getItem(e.KeyPrefix+e.EventsStoreKey)),e.instance.eventsStore||(e.instance.eventsStore=[])}catch(t){s.w("Load failed for 'events' store. Using empty store."),e.instance.eventsStore=[]}try{e.instance.sessionsStore=JSON.parse(localStorage.getItem(e.KeyPrefix+e.SessionsStoreKey)),e.instance.sessionsStore||(e.instance.sessionsStore=[])}catch(t){s.w("Load failed for 'sessions' store. Using empty store."),e.instance.sessionsStore=[]}try{e.instance.progressionStore=JSON.parse(localStorage.getItem(e.KeyPrefix+e.ProgressionStoreKey)),e.instance.progressionStore||(e.instance.progressionStore=[])}catch(t){s.w("Load failed for 'progression' store. Using empty store."),e.instance.progressionStore=[]}try{e.instance.storeItems=JSON.parse(localStorage.getItem(e.KeyPrefix+e.ItemsStoreKey)),e.instance.storeItems||(e.instance.storeItems={})}catch(t){s.w("Load failed for 'items' store. Using empty store."),e.instance.progressionStore=[]}}else s.w("Storage is not available, cannot load.")},e.setItem=function(t,i){var n=e.KeyPrefix+t;i?e.instance.storeItems[n]=i:n in e.instance.storeItems&&delete e.instance.storeItems[n]},e.getItem=function(t){var i=e.KeyPrefix+t;return i in e.instance.storeItems?e.instance.storeItems[i]:null},e.getStore=function(t){switch(t){case n.Events:return e.instance.eventsStore;case n.Sessions:return e.instance.sessionsStore;case n.Progression:return e.instance.progressionStore;default:return s.w("GAStore.getStore(): Cannot find store: "+t),null}},e.instance=new e,e.MaxNumberOfEntries=2e3,e.KeyPrefix="GA::",e.EventsStoreKey="ga_event",e.SessionsStoreKey="ga_session",e.ProgressionStoreKey="ga_progression",e.ItemsStoreKey="ga_items",e}();t.GAStore=o})(e.store||(e.store={}))}(s||(s={})),function(e){(function(t){var i=e.validators.GAValidator,n=e.utilities.GAUtilities,s=e.logging.GALogger,o=e.store.GAStore,a=e.device.GADevice,r=e.store.EGAStore,d=e.store.EGAStoreArgsOperator,c=function(){function t(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.configurations={},this.commandCenterListeners=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={},this._isEventSubmissionEnabled=!0}return t.setUserId=function(e){t.instance.userId=e,t.cacheIdentifier()},t.getIdentifier=function(){return t.instance.identifier},t.isInitialized=function(){return t.instance.initialized},t.setInitialized=function(e){t.instance.initialized=e},t.getSessionStart=function(){return t.instance.sessionStart},t.getSessionNum=function(){return t.instance.sessionNum},t.getTransactionNum=function(){return t.instance.transactionNum},t.getSessionId=function(){return t.instance.sessionId},t.getCurrentCustomDimension01=function(){return t.instance.currentCustomDimension01},t.getCurrentCustomDimension02=function(){return t.instance.currentCustomDimension02},t.getCurrentCustomDimension03=function(){return t.instance.currentCustomDimension03},t.getGameKey=function(){return t.instance.gameKey},t.getGameSecret=function(){return t.instance.gameSecret},t.getAvailableCustomDimensions01=function(){return t.instance.availableCustomDimensions01},t.setAvailableCustomDimensions01=function(e){i.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions01=e,t.validateAndFixCurrentDimensions(),s.i("Set available custom01 dimension values: ("+n.joinStringArray(e,", ")+")"))},t.getAvailableCustomDimensions02=function(){return t.instance.availableCustomDimensions02},t.setAvailableCustomDimensions02=function(e){i.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions02=e,t.validateAndFixCurrentDimensions(),s.i("Set available custom02 dimension values: ("+n.joinStringArray(e,", ")+")"))},t.getAvailableCustomDimensions03=function(){return t.instance.availableCustomDimensions03},t.setAvailableCustomDimensions03=function(e){i.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions03=e,t.validateAndFixCurrentDimensions(),s.i("Set available custom03 dimension values: ("+n.joinStringArray(e,", ")+")"))},t.getAvailableResourceCurrencies=function(){return t.instance.availableResourceCurrencies},t.setAvailableResourceCurrencies=function(e){i.validateResourceCurrencies(e)&&(t.instance.availableResourceCurrencies=e,s.i("Set available resource currencies: ("+n.joinStringArray(e,", ")+")"))},t.getAvailableResourceItemTypes=function(){return t.instance.availableResourceItemTypes},t.setAvailableResourceItemTypes=function(e){i.validateResourceItemTypes(e)&&(t.instance.availableResourceItemTypes=e,s.i("Set available resource item types: ("+n.joinStringArray(e,", ")+")"))},t.getBuild=function(){return t.instance.build},t.setBuild=function(e){t.instance.build=e,s.i("Set build version: "+e)},t.getUseManualSessionHandling=function(){return t.instance.useManualSessionHandling},t.isEventSubmissionEnabled=function(){return t.instance._isEventSubmissionEnabled},t.prototype.setDefaultId=function(e){this.defaultUserId=e||"",t.cacheIdentifier()},t.getDefaultId=function(){return t.instance.defaultUserId},t.getSdkConfig=function(){var e=0;for(var i in t.instance.sdkConfig)0===e&&(n=i),++e;if(n&&e>0)return t.instance.sdkConfig;var n;e=0;for(var i in t.instance.sdkConfigCached)0===e&&(n=i),++e;return n&&e>0?t.instance.sdkConfigCached:t.instance.sdkConfigDefault},t.isEnabled=function(){var e=t.getSdkConfig();return(!e.enabled||"false"!=e.enabled)&&!!t.instance.initAuthorized},t.setCustomDimension01=function(e){t.instance.currentCustomDimension01=e,o.setItem(t.Dimension01Key,e),s.i("Set custom01 dimension value: "+e)},t.setCustomDimension02=function(e){t.instance.currentCustomDimension02=e,o.setItem(t.Dimension02Key,e),s.i("Set custom02 dimension value: "+e)},t.setCustomDimension03=function(e){t.instance.currentCustomDimension03=e,o.setItem(t.Dimension03Key,e),s.i("Set custom03 dimension value: "+e)},t.setFacebookId=function(e){t.instance.facebookId=e,o.setItem(t.FacebookIdKey,e),s.i("Set facebook id: "+e)},t.setGender=function(i){t.instance.gender=isNaN(Number(e.EGAGender[i]))?e.EGAGender[i].toString().toLowerCase():e.EGAGender[e.EGAGender[i]].toString().toLowerCase(),o.setItem(t.GenderKey,t.instance.gender),s.i("Set gender: "+t.instance.gender)},t.setBirthYear=function(e){t.instance.birthYear=e,o.setItem(t.BirthYearKey,e.toString()),s.i("Set birth year: "+e)},t.incrementSessionNum=function(){var e=t.getSessionNum()+1;t.instance.sessionNum=e},t.incrementTransactionNum=function(){var e=t.getTransactionNum()+1;t.instance.transactionNum=e},t.incrementProgressionTries=function(e){var i=t.getProgressionTries(e)+1;t.instance.progressionTries[e]=i;var n={};n.progression=e,n.tries=i,o.insert(r.Progression,n,!0,"progression")},t.getProgressionTries=function(e){return e in t.instance.progressionTries?t.instance.progressionTries[e]:0},t.clearProgressionTries=function(e){e in t.instance.progressionTries&&delete t.instance.progressionTries[e];var i=[];i.push(["progression",d.Equal,e]),o.delete(r.Progression,i)},t.setKeys=function(e,i){t.instance.gameKey=e,t.instance.gameSecret=i},t.setManualSessionHandling=function(e){t.instance.useManualSessionHandling=e,s.i("Use manual session handling: "+e)},t.setEnabledEventSubmission=function(e){t.instance._isEventSubmissionEnabled=e},t.getEventAnnotations=function(){var e={v:2};e.user_id=t.instance.identifier,e.client_ts=t.getClientTsAdjusted(),e.sdk_version=a.getRelevantSdkVersion(),e.os_version=a.osVersion,e.manufacturer=a.deviceManufacturer,e.device=a.deviceModel,e.browser_version=a.browserVersion,e.platform=a.buildPlatform,e.session_id=t.instance.sessionId,e[t.SessionNumKey]=t.instance.sessionNum;var n=a.getConnectionType();return i.validateConnectionType(n)&&(e.connection_type=n),a.gameEngineVersion&&(e.engine_version=a.gameEngineVersion),t.instance.build&&(e.build=t.instance.build),t.instance.facebookId&&(e[t.FacebookIdKey]=t.instance.facebookId),t.instance.gender&&(e[t.GenderKey]=t.instance.gender),0!=t.instance.birthYear&&(e[t.BirthYearKey]=t.instance.birthYear),e},t.getSdkErrorEventAnnotations=function(){var e={v:2};e.category=t.CategorySdkError,e.sdk_version=a.getRelevantSdkVersion(),e.os_version=a.osVersion,e.manufacturer=a.deviceManufacturer,e.device=a.deviceModel,e.platform=a.buildPlatform;var n=a.getConnectionType();return i.validateConnectionType(n)&&(e.connection_type=n),a.gameEngineVersion&&(e.engine_version=a.gameEngineVersion),e},t.getInitAnnotations=function(){var e={};return e.user_id=t.getIdentifier(),e.sdk_version=a.getRelevantSdkVersion(),e.os_version=a.osVersion,e.platform=a.buildPlatform,e},t.getClientTsAdjusted=function(){var e=n.timeIntervalSince1970(),s=e+t.instance.clientServerTimeOffset;return i.validateClientTs(s)?s:e},t.sessionIsStarted=function(){return 0!=t.instance.sessionStart},t.cacheIdentifier=function(){t.instance.userId?t.instance.identifier=t.instance.userId:t.instance.defaultUserId&&(t.instance.identifier=t.instance.defaultUserId)},t.ensurePersistedStates=function(){o.isStorageAvailable()&&o.load();var e=t.instance;e.setDefaultId(null!=o.getItem(t.DefaultUserIdKey)?o.getItem(t.DefaultUserIdKey):n.createGuid()),e.sessionNum=null!=o.getItem(t.SessionNumKey)?Number(o.getItem(t.SessionNumKey)):0,e.transactionNum=null!=o.getItem(t.TransactionNumKey)?Number(o.getItem(t.TransactionNumKey)):0,e.facebookId?o.setItem(t.FacebookIdKey,e.facebookId):(e.facebookId=null!=o.getItem(t.FacebookIdKey)?o.getItem(t.FacebookIdKey):"",e.facebookId),e.gender?o.setItem(t.GenderKey,e.gender):(e.gender=null!=o.getItem(t.GenderKey)?o.getItem(t.GenderKey):"",e.gender),e.birthYear&&0!=e.birthYear?o.setItem(t.BirthYearKey,e.birthYear.toString()):(e.birthYear=null!=o.getItem(t.BirthYearKey)?Number(o.getItem(t.BirthYearKey)):0,e.birthYear),e.currentCustomDimension01?o.setItem(t.Dimension01Key,e.currentCustomDimension01):(e.currentCustomDimension01=null!=o.getItem(t.Dimension01Key)?o.getItem(t.Dimension01Key):"",e.currentCustomDimension01),e.currentCustomDimension02?o.setItem(t.Dimension02Key,e.currentCustomDimension02):(e.currentCustomDimension02=null!=o.getItem(t.Dimension02Key)?o.getItem(t.Dimension02Key):"",e.currentCustomDimension02),e.currentCustomDimension03?o.setItem(t.Dimension03Key,e.currentCustomDimension03):(e.currentCustomDimension03=null!=o.getItem(t.Dimension03Key)?o.getItem(t.Dimension03Key):"",e.currentCustomDimension03);var i=null!=o.getItem(t.SdkConfigCachedKey)?o.getItem(t.SdkConfigCachedKey):"";if(i){var s=JSON.parse(n.decode64(i));s&&(e.sdkConfigCached=s)}var a=o.select(r.Progression);if(a)for(var d=0;d<a.length;++d){var c=a[d];c&&(e.progressionTries[c.progression]=c.tries)}},t.calculateServerTimeOffset=function(e){return e-n.timeIntervalSince1970()},t.validateAndCleanCustomFields=function(e){var i={};if(e){var o=0;for(var a in e){var r=e[a];if(a&&r)if(o<t.MAX_CUSTOM_FIELDS_COUNT){var d=new RegExp("^[a-zA-Z0-9_]{1,"+t.MAX_CUSTOM_FIELDS_KEY_LENGTH+"}$");if(n.stringMatch(a,d)){var c=typeof r;if("string"===c||r instanceof String){var l=r;l.length<=t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH&&l.length>0?(i[a]=l,++o):s.w("validateAndCleanCustomFields: entry with key="+a+", value="+r+" has been omitted because its value is an empty string or exceeds the max number of characters ("+t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH+")")}else if("number"===c||r instanceof Number){var u=r;i[a]=u,++o}else s.w("validateAndCleanCustomFields: entry with key="+a+", value="+r+" has been omitted because its value is not a string or number")}else s.w("validateAndCleanCustomFields: entry with key="+a+", value="+r+" has been omitted because its key contains illegal character, is empty or exceeds the max number of characters ("+t.MAX_CUSTOM_FIELDS_KEY_LENGTH+")")}else s.w("validateAndCleanCustomFields: entry with key="+a+", value="+r+" has been omitted because it exceeds the max number of custom fields ("+t.MAX_CUSTOM_FIELDS_COUNT+")");else s.w("validateAndCleanCustomFields: entry with key="+a+", value="+r+" has been omitted because its key or value is null")}}return i},t.validateAndFixCurrentDimensions=function(){i.validateDimension01(t.getCurrentCustomDimension01(),t.getAvailableCustomDimensions01())||t.setCustomDimension01(""),i.validateDimension02(t.getCurrentCustomDimension02(),t.getAvailableCustomDimensions02())||t.setCustomDimension02(""),i.validateDimension03(t.getCurrentCustomDimension03(),t.getAvailableCustomDimensions03())||t.setCustomDimension03("")},t.getConfigurationStringValue=function(e,i){return t.instance.configurations[e]?t.instance.configurations[e].toString():i},t.isCommandCenterReady=function(){return t.instance.commandCenterIsReady},t.addCommandCenterListener=function(e){t.instance.commandCenterListeners.indexOf(e)<0&&t.instance.commandCenterListeners.push(e)},t.removeCommandCenterListener=function(e){var i=t.instance.commandCenterListeners.indexOf(e);i>-1&&t.instance.commandCenterListeners.splice(i,1)},t.getConfigurationsContentAsString=function(){return JSON.stringify(t.instance.configurations)},t.populateConfigurations=function(e){var i=e.configurations;if(i)for(var n=0;n<i.length;++n){var s=i[n];if(s){var o=s.key,a=s.value,r=s.start?s.start:Number.MIN_VALUE,d=s.end?s.end:Number.MAX_VALUE,c=t.getClientTsAdjusted();o&&a&&c>r&&c<d&&(t.instance.configurations[o]=a)}}t.instance.commandCenterIsReady=!0;var l=t.instance.commandCenterListeners;for(n=0;n<l.length;++n)l[n]&&l[n].onCommandCenterUpdated()},t.CategorySdkError="sdk_error",t.MAX_CUSTOM_FIELDS_COUNT=50,t.MAX_CUSTOM_FIELDS_KEY_LENGTH=64,t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH=256,t.instance=new t,t.DefaultUserIdKey="default_user_id",t.SessionNumKey="session_num",t.TransactionNumKey="transaction_num",t.FacebookIdKey="facebook_id",t.GenderKey="gender",t.BirthYearKey="birth_year",t.Dimension01Key="dimension01",t.Dimension02Key="dimension02",t.Dimension03Key="dimension03",t.SdkConfigCachedKey="sdk_config_cached",t}();t.GAState=c})(e.state||(e.state={}))}(s||(s={})),function(e){(function(t){var i=e.utilities.GAUtilities,n=e.logging.GALogger,s=function(){function e(){}return e.execute=function(t,s,o,a){if(e.countMap[s]||(e.countMap[s]=0),!(e.countMap[s]>=e.MaxCount)){var r=i.getHmac(a,o),d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState){if(!d.responseText)return;if(200!=d.status)return void n.w("sdk error failed. response code not 200. status code: "+d.status+", description: "+d.statusText+", body: "+d.responseText);e.countMap[s]=e.countMap[s]+1}},d.open("POST",t,!0),d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("Authorization",r);try{d.send(o)}catch(e){console.error(e)}}},e.MaxCount=10,e.countMap={},e}();t.SdkErrorTask=s})(e.tasks||(e.tasks={}))}(s||(s={})),function(e){(function(t){var i=e.state.GAState,n=e.logging.GALogger,s=e.utilities.GAUtilities,o=e.validators.GAValidator,a=e.tasks.SdkErrorTask,r=function(){function e(){this.protocol="https",this.hostName="api.gameanalytics.com",this.version="v2",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}return e.prototype.requestInit=function(n){var s=i.getGameKey(),o=(this.baseUrl,this.initializeUrlPath);o="https://rubick.gameanalytics.com/v2/command_center?game_key="+s+"&interval_seconds=1000000";var a=i.getInitAnnotations(),r=JSON.stringify(a);if(r){var d=this.createPayloadData(r,this.useGzip),c=[];c.push(r),e.sendRequest(o,d,c,this.useGzip,e.initRequestCallback,n)}else n(t.EGAHTTPApiResponse.JsonEncodeFailed,null)},e.prototype.sendEventsInArray=function(n,s,o){if(0!=n.length){var a=i.getGameKey(),r=this.baseUrl+"/"+a+"/"+this.eventsUrlPath,d=JSON.stringify(n);if(d){var c=this.createPayloadData(d,this.useGzip),l=[];l.push(d),l.push(s),l.push(n.length.toString()),e.sendRequest(r,c,l,this.useGzip,e.sendEventInArrayRequestCallback,o)}else o(t.EGAHTTPApiResponse.JsonEncodeFailed,null,s,n.length)}},e.prototype.sendSdkErrorEvent=function(t){if(i.isEventSubmissionEnabled()){var s=i.getGameKey(),r=i.getGameSecret();if(o.validateSdkErrorEvent(s,r,t)){var d,c=this.baseUrl+"/"+s+"/"+this.eventsUrlPath,l=i.getSdkErrorEventAnnotations(),u=e.sdkErrorTypeToString(t);l.type=u;var h=[];h.push(l),(d=JSON.stringify(h))?a.execute(c,t,d,r):n.w("sendSdkErrorEvent: JSON encoding failed.")}}},e.sendEventInArrayRequestCallback=function(i,n,s,o){void 0===o&&(o=null);o[0],o[1];var a,r,d=o[2],c=parseInt(o[3]);a=i.responseText,r=i.status;var l=e.instance.processRequestResponse(r,i.statusText,a,"Events");if(l==t.EGAHTTPApiResponse.Ok||l==t.EGAHTTPApiResponse.BadRequest){var u=a?JSON.parse(a):{};null!=u?(t.EGAHTTPApiResponse.BadRequest,s(l,u,d,c)):s(t.EGAHTTPApiResponse.JsonDecodeFailed,null,d,c)}else s(l,null,d,c)},e.sendRequest=function(e,t,n,o,a,r){var d=new XMLHttpRequest,c=i.getGameSecret(),l=s.getHmac(c,t),u=[];for(var h in u.push(l),n)u.push(n[h]);if(d.onreadystatechange=function(){4===d.readyState&&a(d,e,r,u)},d.open("POST",e,!0),d.setRequestHeader("Content-Type","text/plain"),d.setRequestHeader("Authorization",l),o)throw new Error("gzip not supported");try{d.send(t)}catch(e){console.error(e.stack)}},e.initRequestCallback=function(i,n,s,a){void 0===a&&(a=null);var r,d;a[0],a[1];r=i.responseText,d=i.status;var c=r?JSON.parse(r):{},l=e.instance.processRequestResponse(d,i.statusText,r,"Init");if(l==t.EGAHTTPApiResponse.Ok||l==t.EGAHTTPApiResponse.BadRequest)if(null!=c)if(l!==t.EGAHTTPApiResponse.BadRequest){var u=o.validateAndCleanInitRequestResponse(c);u?s(t.EGAHTTPApiResponse.Ok,u,"",0):s(t.EGAHTTPApiResponse.BadResponse,null,"",0)}else s(l,null,"",0);else s(t.EGAHTTPApiResponse.JsonDecodeFailed,null,"",0);else s(l,null,"",0)},e.prototype.createPayloadData=function(e,t){if(t)throw new Error("gzip not supported");return e},e.prototype.processRequestResponse=function(e,i,n,s){return n?200===e?t.EGAHTTPApiResponse.Ok:0===e||401===e?t.EGAHTTPApiResponse.Unauthorized:400===e?t.EGAHTTPApiResponse.BadRequest:500===e?t.EGAHTTPApiResponse.InternalServerError:t.EGAHTTPApiResponse.UnknownResponseCode:t.EGAHTTPApiResponse.NoResponse},e.sdkErrorTypeToString=function(e){switch(e){case t.EGASdkErrorType.Rejected:return"rejected";default:return""}},e.instance=new e,e}();t.GAHTTPApi=r})(e.http||(e.http={}))}(s||(s={})),function(e){(function(t){var i=e.store.GAStore,n=e.store.EGAStore,s=e.store.EGAStoreArgsOperator,o=e.state.GAState,a=e.logging.GALogger,r=e.utilities.GAUtilities,d=e.http.EGAHTTPApiResponse,c=e.http.GAHTTPApi,l=e.validators.GAValidator,u=e.http.EGASdkErrorType,h=function(){function t(){}return t.addSessionStartEvent=function(){if(o.isEventSubmissionEnabled()){var e={};e.category=t.CategorySessionStart,o.incrementSessionNum(),i.setItem(o.SessionNumKey,o.getSessionNum().toString()),t.addDimensionsToEvent(e),t.addEventToStore(e),a.i("Add SESSION START event"),t.processEvents(t.CategorySessionStart,!1)}},t.addSessionEndEvent=function(){if(o.isEventSubmissionEnabled()){var e=o.getSessionStart(),i=o.getClientTsAdjusted()-e;i<0&&(a.w("Session length was calculated to be less then 0. Should not be possible. Resetting to 0."),i=0);var n={};n.category=t.CategorySessionEnd,n.length=i,t.addDimensionsToEvent(n),t.addEventToStore(n),a.i("Add SESSION END event."),t.processEvents("",!1)}},t.addBusinessEvent=function(e,n,s,r,d,h){if(void 0===d&&(d=null),o.isEventSubmissionEnabled())if(l.validateBusinessEvent(e,n,d,s,r)){var m={};o.incrementTransactionNum(),i.setItem(o.TransactionNumKey,o.getTransactionNum().toString()),m.event_id=s+":"+r,m.category=t.CategoryBusiness,m.currency=e,m.amount=n,m[o.TransactionNumKey]=o.getTransactionNum(),d&&(m.cart_type=d),t.addDimensionsToEvent(m),t.addFieldsToEvent(m,o.validateAndCleanCustomFields(h)),a.i("Add BUSINESS event: {currency:"+e+", amount:"+n+", itemType:"+s+", itemId:"+r+", cartType:"+d+"}"),t.addEventToStore(m)}else c.instance.sendSdkErrorEvent(u.Rejected)},t.addResourceEvent=function(i,n,s,r,d,h){if(o.isEventSubmissionEnabled())if(l.validateResourceEvent(i,n,s,r,d,o.getAvailableResourceCurrencies(),o.getAvailableResourceItemTypes())){i===e.EGAResourceFlowType.Sink&&(s*=-1);var m={},g=t.resourceFlowTypeToString(i);m.event_id=g+":"+n+":"+r+":"+d,m.category=t.CategoryResource,m.amount=s,t.addDimensionsToEvent(m),t.addFieldsToEvent(m,o.validateAndCleanCustomFields(h)),a.i("Add RESOURCE event: {currency:"+n+", amount:"+s+", itemType:"+r+", itemId:"+d+"}"),t.addEventToStore(m)}else c.instance.sendSdkErrorEvent(u.Rejected)},t.addProgressionEvent=function(i,n,s,r,d,h,m){if(o.isEventSubmissionEnabled()){var g=t.progressionStatusToString(i);if(l.validateProgressionEvent(i,n,s,r)){var p,w={};p=s?r?n+":"+s+":"+r:n+":"+s:n,w.category=t.CategoryProgression,w.event_id=g+":"+p;var f=0;h&&i!=e.EGAProgressionStatus.Start&&(w.score=d),i===e.EGAProgressionStatus.Fail&&o.incrementProgressionTries(p),i===e.EGAProgressionStatus.Complete&&(o.incrementProgressionTries(p),f=o.getProgressionTries(p),w.attempt_num=f,o.clearProgressionTries(p)),t.addDimensionsToEvent(w),t.addFieldsToEvent(w,o.validateAndCleanCustomFields(m)),a.i("Add PROGRESSION event: {status:"+g+", progression01:"+n+", progression02:"+s+", progression03:"+r+", score:"+d+", attempt:"+f+"}"),t.addEventToStore(w)}else c.instance.sendSdkErrorEvent(u.Rejected)}},t.addDesignEvent=function(e,i,n,s){if(o.isEventSubmissionEnabled())if(l.validateDesignEvent(e,i)){var r={};r.category=t.CategoryDesign,r.event_id=e,n&&(r.value=i),t.addDimensionsToEvent(r),t.addFieldsToEvent(r,o.validateAndCleanCustomFields(s)),a.i("Add DESIGN event: {eventId:"+e+", value:"+i+"}"),t.addEventToStore(r)}else c.instance.sendSdkErrorEvent(u.Rejected)},t.addErrorEvent=function(e,i,n){if(o.isEventSubmissionEnabled()){var s=t.errorSeverityToString(e);if(l.validateErrorEvent(e,i)){var r={};r.category=t.CategoryError,r.severity=s,r.message=i,t.addDimensionsToEvent(r),t.addFieldsToEvent(r,o.validateAndCleanCustomFields(n)),a.i("Add ERROR event: {severity:"+s+", message:"+i+"}"),t.addEventToStore(r)}else c.instance.sendSdkErrorEvent(u.Rejected)}},t.processEvents=function(e,d){if(o.isEventSubmissionEnabled())try{var l=r.createGuid();d&&(t.cleanupEvents(),t.fixMissingSessionEndEvents());var u=[];u.push(["status",s.Equal,"new"]);var h=[];h.push(["status",s.Equal,"new"]),e&&(u.push(["category",s.Equal,e]),h.push(["category",s.Equal,e]));var m=[];m.push(["status",l]);var g=i.select(n.Events,u);if(!g||0==g.length)return a.i("Event queue: No events to send"),void t.updateSessionStore();if(g.length>t.MaxEventCount){if(!(g=i.select(n.Events,u,!0,t.MaxEventCount)))return;var p=g[g.length-1].client_ts;if(u.push(["client_ts",s.LessOrEqual,p]),!(g=i.select(n.Events,u)))return;h.push(["client_ts",s.LessOrEqual,p])}if(a.i("Event queue: Sending "+g.length+" events."),!i.update(n.Events,m,h))return;for(var w=[],f=0;f<g.length;++f){var v=g[f],S=JSON.parse(r.decode64(v.event));0!=S.length&&w.push(S)}c.instance.sendEventsInArray(w,l,t.processEventsCallback)}catch(e){a.e("Error during ProcessEvents(): "+e.stack)}},t.processEventsCallback=function(e,t,o,r){var c=[];if(c.push(["status",s.Equal,o]),e===d.Ok)i.delete(n.Events,c),a.i("Event queue: "+r+" events sent.");else if(e===d.NoResponse){var l=[];l.push(["status","new"]),a.w("Event queue: Failed to send events to collector - Retrying next time"),i.update(n.Events,l,c)}else{if(t){var u,h=0;for(var m in t)0==h&&(u=t[m]),++h;e===d.BadRequest&&u.constructor===Array?a.w("Event queue: "+r+" events sent. "+h+" events failed GA server validation."):a.w("Event queue: Failed to send events.")}else a.w("Event queue: Failed to send events.");i.delete(n.Events,c)}},t.cleanupEvents=function(){i.update(n.Events,[["status","new"]])},t.fixMissingSessionEndEvents=function(){if(o.isEventSubmissionEnabled()){var e=[];e.push(["session_id",s.NotEqual,o.getSessionId()]);var d=i.select(n.Sessions,e);if(d&&0!=d.length){a.i(d.length+" session(s) located with missing session_end event.");for(var c=0;c<d.length;++c){var l=JSON.parse(r.decode64(d[c].event)),u=l.client_ts-d[c].timestamp;u=Math.max(0,u),l.category=t.CategorySessionEnd,l.length=u,t.addEventToStore(l)}}}},t.addEventToStore=function(e){if(o.isEventSubmissionEnabled())if(o.isInitialized())try{if(i.isStoreTooLargeForEvents()&&!r.stringMatch(e.category,/^(user|session_end|business)$/))return void a.w("Database too large. Event has been blocked.");var d=o.getEventAnnotations(),c=r.encode64(JSON.stringify(d));for(var l in e)d[l]=e[l];var u=JSON.stringify(d);a.ii("Event added to queue: "+u);var h={status:"new"};h.category=d.category,h.session_id=d.session_id,h.client_ts=d.client_ts,h.event=r.encode64(JSON.stringify(d)),i.insert(n.Events,h),e.category==t.CategorySessionEnd?i.delete(n.Sessions,[["session_id",s.Equal,d.session_id]]):((h={}).session_id=d.session_id,h.timestamp=o.getSessionStart(),h.event=c,i.insert(n.Sessions,h,!0,"session_id")),i.isStorageAvailable()&&i.save()}catch(l){a.e("addEventToStore: error"),a.e(l.stack)}else a.w("Could not add event: SDK is not initialized")},t.updateSessionStore=function(){if(o.sessionIsStarted()){var e={};e.session_id=o.instance.sessionId,e.timestamp=o.getSessionStart(),e.event=r.encode64(JSON.stringify(o.getEventAnnotations())),i.insert(n.Sessions,e,!0,"session_id"),i.isStorageAvailable()&&i.save()}},t.addDimensionsToEvent=function(e){e&&(o.getCurrentCustomDimension01()&&(e.custom_01=o.getCurrentCustomDimension01()),o.getCurrentCustomDimension02()&&(e.custom_02=o.getCurrentCustomDimension02()),o.getCurrentCustomDimension03()&&(e.custom_03=o.getCurrentCustomDimension03()))},t.addFieldsToEvent=function(e,t){e&&t&&Object.keys(t).length>0&&(e.custom_fields=t)},t.resourceFlowTypeToString=function(t){return t==e.EGAResourceFlowType.Source||t==e.EGAResourceFlowType[e.EGAResourceFlowType.Source]?"Source":t==e.EGAResourceFlowType.Sink||t==e.EGAResourceFlowType[e.EGAResourceFlowType.Sink]?"Sink":""},t.progressionStatusToString=function(t){return t==e.EGAProgressionStatus.Start||t==e.EGAProgressionStatus[e.EGAProgressionStatus.Start]?"Start":t==e.EGAProgressionStatus.Complete||t==e.EGAProgressionStatus[e.EGAProgressionStatus.Complete]?"Complete":t==e.EGAProgressionStatus.Fail||t==e.EGAProgressionStatus[e.EGAProgressionStatus.Fail]?"Fail":""},t.errorSeverityToString=function(t){return t==e.EGAErrorSeverity.Debug||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Debug]?"debug":t==e.EGAErrorSeverity.Info||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Info]?"info":t==e.EGAErrorSeverity.Warning||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Warning]?"warning":t==e.EGAErrorSeverity.Error||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Error]?"error":t==e.EGAErrorSeverity.Critical||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Critical]?"critical":""},t.instance=new t,t.CategorySessionStart="user",t.CategorySessionEnd="session_end",t.CategoryDesign="design",t.CategoryBusiness="business",t.CategoryProgression="progression",t.CategoryResource="resource",t.CategoryError="error",t.MaxEventCount=500,t}();t.GAEvents=h})(e.events||(e.events={}))}(s||(s={})),function(e){(function(t){var i=e.logging.GALogger,n=e.state.GAState,s=e.events.GAEvents,o=function(){function e(){this.blocks=new t.PriorityQueue({compare:function(e,t){return e-t}}),this.id2TimedBlockMap={},e.startThread()}return e.createTimedBlock=function(e){void 0===e&&(e=0);var i=new Date;return i.setSeconds(i.getSeconds()+e),new t.TimedBlock(i)},e.performTaskOnGAThread=function(i,n){void 0===n&&(n=0);var s=new Date;s.setSeconds(s.getSeconds()+n);var o=new t.TimedBlock(s);o.block=i,e.instance.id2TimedBlockMap[o.id]=o,e.instance.addTimedBlock(o)},e.performTimedBlockOnGAThread=function(t){e.instance.id2TimedBlockMap[t.id]=t,e.instance.addTimedBlock(t)},e.scheduleTimer=function(i,n){var s=new Date;s.setSeconds(s.getSeconds()+i);var o=new t.TimedBlock(s);return o.block=n,e.instance.id2TimedBlockMap[o.id]=o,e.instance.addTimedBlock(o),o.id},e.getTimedBlockById=function(t){return t in e.instance.id2TimedBlockMap?e.instance.id2TimedBlockMap[t]:null},e.ensureEventQueueIsRunning=function(){e.instance.keepRunning=!0,e.instance.isRunning||(e.instance.isRunning=!0,e.scheduleTimer(e.ProcessEventsIntervalInSeconds,e.processEventQueue))},e.endSessionAndStopQueue=function(){n.isInitialized()&&(i.i("Ending session."),e.stopEventQueue(),n.isEnabled()&&n.sessionIsStarted()&&(s.addSessionEndEvent(),n.instance.sessionStart=0))},e.stopEventQueue=function(){e.instance.keepRunning=!1},e.ignoreTimer=function(t){t in e.instance.id2TimedBlockMap&&(e.instance.id2TimedBlockMap[t].ignore=!0)},e.setEventProcessInterval=function(t){t>0&&(e.ProcessEventsIntervalInSeconds=t)},e.prototype.addTimedBlock=function(e){this.blocks.enqueue(e.deadline.getTime(),e)},e.run=function(){clearTimeout(e.runTimeoutId);try{for(var t;t=e.getNextBlock();)if(!t.ignore)if(t.async){if(!t.running){t.running=!0,t.block();break}}else t.block();return void(e.runTimeoutId=setTimeout(e.run,e.ThreadWaitTimeInMs))}catch(e){i.e("Error on GA thread"),i.e(e.stack)}},e.startThread=function(){e.runTimeoutId=setTimeout(e.run,0)},e.getNextBlock=function(){var t=new Date;return e.instance.blocks.hasItems()&&e.instance.blocks.peek().deadline.getTime()<=t.getTime()?e.instance.blocks.peek().async&&e.instance.blocks.peek().running?e.instance.blocks.peek():e.instance.blocks.dequeue():null},e.processEventQueue=function(){s.processEvents("",!0),e.instance.keepRunning?e.scheduleTimer(e.ProcessEventsIntervalInSeconds,e.processEventQueue):e.instance.isRunning=!1},e.instance=new e,e.ThreadWaitTimeInMs=1e3,e.ProcessEventsIntervalInSeconds=8,e}();t.GAThreading=o})(e.threading||(e.threading={}))}(s||(s={})),function(e){var t=e.threading.GAThreading,i=e.logging.GALogger,n=e.store.GAStore,s=e.state.GAState,o=e.http.GAHTTPApi,a=e.device.GADevice,r=e.validators.GAValidator,d=e.http.EGAHTTPApiResponse,c=e.utilities.GAUtilities,l=e.events.GAEvents,u=function(){function u(){}return u.init=function(){if(a.touch(),u.methodMap.configureAvailableCustomDimensions01=u.configureAvailableCustomDimensions01,u.methodMap.configureAvailableCustomDimensions02=u.configureAvailableCustomDimensions02,u.methodMap.configureAvailableCustomDimensions03=u.configureAvailableCustomDimensions03,u.methodMap.configureAvailableResourceCurrencies=u.configureAvailableResourceCurrencies,u.methodMap.configureAvailableResourceItemTypes=u.configureAvailableResourceItemTypes,u.methodMap.configureBuild=u.configureBuild,u.methodMap.configureSdkGameEngineVersion=u.configureSdkGameEngineVersion,u.methodMap.configureGameEngineVersion=u.configureGameEngineVersion,u.methodMap.configureUserId=u.configureUserId,u.methodMap.initialize=u.initialize,u.methodMap.addBusinessEvent=u.addBusinessEvent,u.methodMap.addResourceEvent=u.addResourceEvent,u.methodMap.addProgressionEvent=u.addProgressionEvent,u.methodMap.addDesignEvent=u.addDesignEvent,u.methodMap.addErrorEvent=u.addErrorEvent,u.methodMap.addErrorEvent=u.addErrorEvent,u.methodMap.setEnabledInfoLog=u.setEnabledInfoLog,u.methodMap.setEnabledVerboseLog=u.setEnabledVerboseLog,u.methodMap.setEnabledManualSessionHandling=u.setEnabledManualSessionHandling,u.methodMap.setEnabledEventSubmission=u.setEnabledEventSubmission,u.methodMap.setCustomDimension01=u.setCustomDimension01,u.methodMap.setCustomDimension02=u.setCustomDimension02,u.methodMap.setCustomDimension03=u.setCustomDimension03,u.methodMap.setFacebookId=u.setFacebookId,u.methodMap.setGender=u.setGender,u.methodMap.setBirthYear=u.setBirthYear,u.methodMap.setEventProcessInterval=u.setEventProcessInterval,u.methodMap.startSession=u.startSession,u.methodMap.endSession=u.endSession,u.methodMap.onStop=u.onStop,u.methodMap.onResume=u.onResume,u.methodMap.addCommandCenterListener=u.addCommandCenterListener,u.methodMap.removeCommandCenterListener=u.removeCommandCenterListener,u.methodMap.getCommandCenterValueAsString=u.getCommandCenterValueAsString,u.methodMap.isCommandCenterReady=u.isCommandCenterReady,u.methodMap.getConfigurationsContentAsString=u.getConfigurationsContentAsString,"undefined"!=typeof window&&void 0!==window.GameAnalytics&&void 0!==window.GameAnalytics.q){var e=window.GameAnalytics.q;for(var t in e)u.gaCommand.apply(null,e[t])}},u.gaCommand=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];t.length>0&&t[0]in e.GameAnalytics.methodMap&&(t.length>1?e.GameAnalytics.methodMap[t[0]].apply(null,Array.prototype.slice.call(t,1)):e.GameAnalytics.methodMap[t[0]]())},u.configureAvailableCustomDimensions01=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?i.w("Available custom dimensions must be set before SDK is initialized"):s.setAvailableCustomDimensions01(e)})},u.configureAvailableCustomDimensions02=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?i.w("Available custom dimensions must be set before SDK is initialized"):s.setAvailableCustomDimensions02(e)})},u.configureAvailableCustomDimensions03=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?i.w("Available custom dimensions must be set before SDK is initialized"):s.setAvailableCustomDimensions03(e)})},u.configureAvailableResourceCurrencies=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?i.w("Available resource currencies must be set before SDK is initialized"):s.setAvailableResourceCurrencies(e)})},u.configureAvailableResourceItemTypes=function(e){void 0===e&&(e=[]),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?i.w("Available resource item types must be set before SDK is initialized"):s.setAvailableResourceItemTypes(e)})},u.configureBuild=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?i.w("Build version must be set before SDK is initialized."):r.validateBuild(e)?s.setBuild(e):i.i("Validation fail - configure build: Cannot be null, empty or above 32 length. String: "+e)})},u.configureSdkGameEngineVersion=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)||(r.validateSdkWrapperVersion(e)?a.sdkGameEngineVersion=e:i.i("Validation fail - configure sdk version: Sdk version not supported. String: "+e))})},u.configureGameEngineVersion=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)||(r.validateEngineVersion(e)?a.gameEngineVersion=e:i.i("Validation fail - configure game engine version: Game engine version not supported. String: "+e))})},u.configureUserId=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!1)?i.w("A custom user id must be set before SDK is initialized."):r.validateUserId(e)?s.setUserId(e):i.i("Validation fail - configure user_id: Cannot be null, empty or above 64 length. Will use default user_id method. Used string: "+e)})},u.initialize=function(e,n){void 0===e&&(e=""),void 0===n&&(n=""),a.updateConnectionType();var o=t.createTimedBlock();o.async=!0,u.initTimedBlockId=o.id,o.block=function(){u.isSdkReady(!0,!1)?i.w("SDK already initialized. Can only be called once."):r.validateKeys(e,n)?(s.setKeys(e,n),u.internalInitialize()):i.w("SDK failed initialize. Game key or secret key is invalid. Can only contain characters A-z 0-9, gameKey is 32 length, gameSecret is 40 length. Failed keys - gameKey: "+e+", secretKey: "+n)},t.performTimedBlockOnGAThread(o)},u.addBusinessEvent=function(e,i,n,s,o){void 0===e&&(e=""),void 0===i&&(i=0),void 0===n&&(n=""),void 0===s&&(s=""),void 0===o&&(o=""),a.updateConnectionType(),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!0,"Could not add business event")&&l.addBusinessEvent(e,i,n,s,o,{})})},u.addResourceEvent=function(i,n,s,o,r){void 0===i&&(i=e.EGAResourceFlowType.Undefined),void 0===n&&(n=""),void 0===s&&(s=0),void 0===o&&(o=""),void 0===r&&(r=""),a.updateConnectionType(),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!0,"Could not add resource event")&&l.addResourceEvent(i,n,s,o,r,{})})},u.addProgressionEvent=function(i,n,s,o,r){void 0===i&&(i=e.EGAProgressionStatus.Undefined),void 0===n&&(n=""),void 0===s&&(s=""),void 0===o&&(o=""),a.updateConnectionType(),t.performTaskOnGAThread(function(){if(u.isSdkReady(!0,!0,"Could not add progression event")){var e="number"==typeof r;l.addProgressionEvent(i,n,s,o,e?r:0,e,{})}})},u.addDesignEvent=function(e,i){a.updateConnectionType(),t.performTaskOnGAThread(function(){if(u.isSdkReady(!0,!0,"Could not add design event")){var t="number"==typeof i;l.addDesignEvent(e,t?i:0,t,{})}})},u.addErrorEvent=function(i,n){void 0===i&&(i=e.EGAErrorSeverity.Undefined),void 0===n&&(n=""),a.updateConnectionType(),t.performTaskOnGAThread(function(){u.isSdkReady(!0,!0,"Could not add error event")&&l.addErrorEvent(i,n,{})})},u.setEnabledInfoLog=function(e){void 0===e&&(e=!1),t.performTaskOnGAThread(function(){e?(i.setInfoLog(e),i.i("Info logging enabled")):(i.i("Info logging disabled"),i.setInfoLog(e))})},u.setEnabledVerboseLog=function(e){void 0===e&&(e=!1),t.performTaskOnGAThread(function(){e?(i.setVerboseLog(e),i.i("Verbose logging enabled")):(i.i("Verbose logging disabled"),i.setVerboseLog(e))})},u.setEnabledManualSessionHandling=function(e){void 0===e&&(e=!1),t.performTaskOnGAThread(function(){s.setManualSessionHandling(e)})},u.setEnabledEventSubmission=function(e){void 0===e&&(e=!1),t.performTaskOnGAThread(function(){e?(s.setEnabledEventSubmission(e),i.i("Event submission enabled")):(i.i("Event submission disabled"),s.setEnabledEventSubmission(e))})},u.setCustomDimension01=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){r.validateDimension01(e,s.getAvailableCustomDimensions01())?s.setCustomDimension01(e):i.w("Could not set custom01 dimension value to '"+e+"'. Value not found in available custom01 dimension values")})},u.setCustomDimension02=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){r.validateDimension02(e,s.getAvailableCustomDimensions02())?s.setCustomDimension02(e):i.w("Could not set custom02 dimension value to '"+e+"'. Value not found in available custom02 dimension values")})},u.setCustomDimension03=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){r.validateDimension03(e,s.getAvailableCustomDimensions03())?s.setCustomDimension03(e):i.w("Could not set custom03 dimension value to '"+e+"'. Value not found in available custom03 dimension values")})},u.setFacebookId=function(e){void 0===e&&(e=""),t.performTaskOnGAThread(function(){r.validateFacebookId(e)&&s.setFacebookId(e)})},u.setGender=function(i){void 0===i&&(i=e.EGAGender.Undefined),t.performTaskOnGAThread(function(){r.validateGender(i)&&s.setGender(i)})},u.setBirthYear=function(e){void 0===e&&(e=0),t.performTaskOnGAThread(function(){r.validateBirthyear(e)&&s.setBirthYear(e)})},u.setEventProcessInterval=function(e){t.performTaskOnGAThread(function(){t.setEventProcessInterval(e)})},u.startSession=function(){if(s.isInitialized()){var e=t.createTimedBlock();e.async=!0,u.initTimedBlockId=e.id,e.block=function(){s.isEnabled()&&s.sessionIsStarted()&&t.endSessionAndStopQueue(),u.resumeSessionAndStartQueue()},t.performTimedBlockOnGAThread(e)}},u.endSession=function(){u.onStop()},u.onStop=function(){t.performTaskOnGAThread(function(){try{t.endSessionAndStopQueue()}catch(e){}})},u.onResume=function(){var e=t.createTimedBlock();e.async=!0,u.initTimedBlockId=e.id,e.block=function(){u.resumeSessionAndStartQueue()},t.performTimedBlockOnGAThread(e)},u.getCommandCenterValueAsString=function(e,t){return void 0===t&&(t=null),s.getConfigurationStringValue(e,t)},u.isCommandCenterReady=function(){return s.isCommandCenterReady()},u.addCommandCenterListener=function(e){s.addCommandCenterListener(e)},u.removeCommandCenterListener=function(e){s.removeCommandCenterListener(e)},u.getConfigurationsContentAsString=function(){return s.getConfigurationsContentAsString()},u.internalInitialize=function(){s.ensurePersistedStates(),n.setItem(s.DefaultUserIdKey,s.getDefaultId()),s.setInitialized(!0),u.newSession(),s.isEnabled()&&t.ensureEventQueueIsRunning()},u.newSession=function(){i.i("Starting a new session."),s.validateAndFixCurrentDimensions(),o.instance.requestInit(u.startNewSessionCallback)},u.startNewSessionCallback=function(e,o){if(e===d.Ok&&o){var a=0;if(o.server_ts){var r=o.server_ts;a=s.calculateServerTimeOffset(r)}o.time_offset=a,n.setItem(s.SdkConfigCachedKey,c.encode64(JSON.stringify(o))),s.instance.sdkConfigCached=o,s.instance.sdkConfig=o,s.instance.initAuthorized=!0}else e==d.Unauthorized?(i.w("Initialize SDK failed - Unauthorized"),s.instance.initAuthorized=!1):(e===d.NoResponse||e===d.RequestTimeout?i.i("Init call (session start) failed - no response. Could be offline or timeout."):e===d.BadResponse||e===d.JsonEncodeFailed||e===d.JsonDecodeFailed?i.i("Init call (session start) failed - bad response. Could be bad response from proxy or GA servers."):e!==d.BadRequest&&e!==d.UnknownResponseCode||i.i("Init call (session start) failed - bad request or unknown response."),null==s.instance.sdkConfig?null!=s.instance.sdkConfigCached?(i.i("Init call (session start) failed - using cached init values."),s.instance.sdkConfig=s.instance.sdkConfigCached):(i.i("Init call (session start) failed - using default init values."),s.instance.sdkConfig=s.instance.sdkConfigDefault):i.i("Init call (session start) failed - using cached init values."),s.instance.initAuthorized=!0);if(s.instance.clientServerTimeOffset=s.getSdkConfig().time_offset?s.getSdkConfig().time_offset:0,s.populateConfigurations(s.getSdkConfig()),!s.isEnabled())return i.w("Could not start session: SDK is disabled."),void t.stopEventQueue();t.ensureEventQueueIsRunning();var h=c.createGuid();s.instance.sessionId=h,s.instance.sessionStart=s.getClientTsAdjusted(),l.addSessionStartEvent();var m=t.getTimedBlockById(u.initTimedBlockId);null!=m&&(m.running=!1),u.initTimedBlockId=-1},u.resumeSessionAndStartQueue=function(){s.isInitialized()&&(i.i("Resuming session."),s.sessionIsStarted()||u.newSession())},u.isSdkReady=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=""),n&&(n+=": "),e&&!s.isInitialized()?(t&&i.w(n+"SDK is not initialized"),!1):e&&!s.isEnabled()?(t&&i.w(n+"SDK is disabled"),!1):!(e&&!s.sessionIsStarted())||(t&&i.w(n+"Session has not started yet"),!1)},u.initTimedBlockId=-1,u.methodMap={},u}();e.GameAnalytics=u}(s||(s={})),s.GameAnalytics.init();s.GameAnalytics.gaCommand;t.exports=s},{}],achievementController:[function(e,t,i){"use strict";cc._RF.push(t,"e094eAGealM05kL+kYX2izY","achievementController");var n=cc.Class({extends:cc.Component,properties:{list:cc.Node,button:cc.Prefab,icons:[cc.SpriteFrame],dungeonXP:cc.Label},onEnable:function(){this.updateSpecialButton("truedeath"),this.updateSpecialButton("daredevil"),this.updateSpecialButton("already"),this.updateSpecialButton("overkill"),this.updateSpecialButton("darkness"),this.updateSpecialButton("lucky"),this.updateButton(this.levelMax),this.updateButton(this.xp),this.updateButton(this.tiles),this.updateButton(this.killstotal),this.updateButton(this.killsmelee),this.updateButton(this.killsranged),this.updateButton(this.killsmagic),this.updateButton(this.trapstotal),this.updateButton(this.trapsfire),this.updateButton(this.trapsice),this.updateButton(this.trapsacid),this.updateButton(this.trapselectricity),this.updateButton(this.trapsspikes),this.updateButton(this.trapspoison),this.updateButton(this.itemschests),this.updateButton(this.itemstotal),this.updateButton(this.itemsfire),this.updateButton(this.itemsice),this.updateButton(this.itemsacid),this.updateButton(this.itemselectricity),this.updateButton(this.itemsspikes),this.updateButton(this.itemspoison),this.updateButton(this.itemspotion),this.updateButton(this.damagetotal),this.updateButton(this.damagefire),this.updateButton(this.damageice),this.updateButton(this.damageacid),this.updateButton(this.damageelectricity),this.updateButton(this.damagespikes),this.updateButton(this.damagepoison),this.updateButton(this.damagemelee),this.updateButton(this.damageranged),this.updateButton(this.damagemagic),this.updateButton(this.deathtotal),this.updateButton(this.deathfire),this.updateButton(this.deathice),this.updateButton(this.deathacid),this.updateButton(this.deathelectricity),this.updateButton(this.deathspikes),this.updateButton(this.deathpoison),this.updateButton(this.deathmelee),this.updateButton(this.deathranged),this.updateButton(this.deathmagic)},start:function(){this.createSpecialButton("True Death","Get to -10HP","truedeath",1),this.createSpecialButton("Daredevil","Face a trap with 1HP and 0 shields","daredevil",1),this.createSpecialButton("Already back?","Die, then die again in the next floor","already",1),this.createSpecialButton("Overkill","Get an enemy to -10HP","overkill",1),this.createSpecialButton("Stop Moving!","Get 'Dungeon Moves' twice in a floor","darkness",1),this.createSpecialButton("Lucky","Cross a floor without hitting any trap","lucky",1),this.createSpecialButton("Did not expected that","Die to a sub boss","subboss",1),this.createSpecialButton("Expected that","Die to a boss","boss",1),this.createButton("Explorer","Deepest floor you went",null,"levelMax",2,10,1e4),this.createButton("High level","Total XP spent",null,"xp",2,1e5),this.createButton("Runner","Tiles walked",null,"tiles",2,1e3),this.createButton("In a Row","Floors explored without dying",null,"row",2,5,5e3),this.createButton("God of War","Enemies you defeated","kills","total",3),this.createButton("Warrior","Enemies you defeated with your sword","kills","melee",3,100,500),this.createButton("Archer","Enemies you defeated with your bow","kills","ranged",4,100,500),this.createButton("Archmage","Enemies you defeated with your wand","kills","magic",5,100,500),this.createButton("Trap Finder","Total traps found the hard way","traps","total",6),this.createButton("Getting warmer","Total fire traps found the hard way","traps","fire",6,50,2500),this.createButton("Getting colder","Total ice traps found the hard way","traps","ice",6,50,2500),this.createButton("Dirty floor","Total acid traps found the hard way","traps","acid",6,50,2500),this.createButton("Tesla attack","Total electricity traps found the hard way","traps","electricity",6,50,2500),this.createButton("Holed floor","Total spikes traps found the hard way","traps","spikes",6,50,2500),this.createButton("Holed wall","Total poisoned dart traps found the hard way","traps","poison",6,50,2500),this.createButton("Treasure Hunter","Total chests found","items","chests",7),this.createButton("Spender","Total items used","items","total",8,500),this.createButton("Like sunscreen","Total fire shields used","items","fire",9,100,500),this.createButton("A warm blanket","Total ice shields used","items","ice",9,100,500),this.createButton("Still intact","Total acid shields used","items","acid",9,100,500),this.createButton("Fully isolated","Total electricity shields used","items","electricity",9,100,500),this.createButton("Steel boots","Total spikes shields used","items","spikes",9,100,500),this.createButton("Antidote","Total poison shields used","items","poison",9,100,500),this.createButton("Not addicted","Total potions used","items","potion",10,100,500),this.createButton("It hurts everywhere","Total damage taken","damage","total",11,100,500),this.createButton("Needs some Aloe","Total fire damage","damage","fire",11,50,1e3),this.createButton("I want a blanket","Total ice damage","damage","ice",11,50,1e3),this.createButton("I need a base","Total acid damage","damage","acid",11,50,1e3),this.createButton("I need rubber boots","Total electricity damage","damage","electricity",11,50,1e3),this.createButton("Not again...","Total spikes damage","damage","spikes",11,50,1e3),this.createButton("Feeling kind green","Total poison damage","damage","poison",11,50,1e3),this.createButton("I need a shield","Total damage in melee combat","damage","melee",3,50,1e3),this.createButton("Gunch shooter","Total damage in ranged combat","damage","ranged",4,50,1e3),this.createButton("I need a staff","Total damage in magic combat","damage","magic",5,50,1e3),this.createButton("Kenny","Total deaths","death","total",12,10,2500),this.createButton("Barbecue","Total burned deaths","death","fire",12,10,5e3),this.createButton("Popsicle","Total frozen deaths","death","ice",12,10,5e3),this.createButton("Not much left","Total dissolved deaths","death","acid",12,10,5e3),this.createButton("Full of Energy","Total electricity deaths","death","electricity",12,10,5e3),this.createButton("Is Vlad here?","Total impaled deaths","death","spikes",12,10,5e3),this.createButton("Is there an antidote?","Total poisoned deaths","death","poison",12,10,5e3),this.createButton("Shaky hand","Total deaths in melee combat","death","melee",12,10,5e3),this.createButton("Bad Sight","Total deaths in ranged combat","death","ranged",12,10,5e3),this.createButton("Curled Tongue","Total deaths in magic combat","death","magic",12,10,5e3)},createSpecialButton:function(e,t,i,n){var s=0;window.gameSession.stats.unique[i]&&(s=1);var o="unique"+i,a=s/1,r=s+" / 1",d=cc.instantiate(this.button);d.parent=this.list,d.progress=a,d.prize=1e4,d.sub="unique",d.field=i,d.mult=1,d.id=n,d.getChildByName("Name").getComponent(cc.Label).string=e,d.getChildByName("Description").getComponent(cc.Label).string=t,d.getChildByName("Value").getComponent(cc.Label).string=1e4+"XP",d.getChildByName("Progress").getComponent(cc.ProgressBar).progress=a,d.getChildByName("Completion").getComponent(cc.Label).string=r,window.gameSession.achievements.unique[i]?d.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[n]:d.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[0];var c=new cc.Component.EventHandler;c.target=this.node,c.component="achievementController",c.handler="getSpecialPrize",d.getComponent(cc.Button).clickEvents.push(c),this[o]=d},getSpecialPrize:function(e){var t=e.target,i=t.progress,n=(t.sub,t.field);i>=1&&!window.gameSession.achievements.unique[n]&&(window.analytics.Design_event("achievement:unique:"+n),window.gameSession.xp+=t.prize,this.dungeonXP.string=window.gameSession.xp,window.gameSession.achievements.unique[n]=!0),this.updateSpecialButton(n),this.saveGame()},updateSpecialButton:function(e){var t=this["unique"+e];if(t){var i=0;window.gameSession.stats.unique[e]&&(i=1);var n=i/1,s=i+" / 1";t.progress=n,t.prize=1e4,t.getChildByName("Value").getComponent(cc.Label).string=1e4+"XP",t.getChildByName("Progress").getComponent(cc.ProgressBar).progress=n,t.getChildByName("Completion").getComponent(cc.Label).string=s,window.gameSession.achievements.unique[e]?t.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[t.id]:t.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[0]}},createButton:function(e,t,i,n,s){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:100,r=void 0,d=void 0,c=void 0;i?(r=window.gameSession.achievements[i][n],d=window.gameSession.stats[i][n],c=i+n):(r=window.gameSession.achievements[n],d=window.gameSession.stats[n],c=n);var l=(r+1)*o,u=(r+1)*a,h=(d-l+o)/o,m=d+" / "+l,g=cc.instantiate(this.button);g.parent=this.list,g.progress=h,g.step=o,g.prize=a,g.reward=u,g.sub=i,g.field=n,g.spriteID=s,g.getChildByName("Name").getComponent(cc.Label).string=e,g.getChildByName("Description").getComponent(cc.Label).string=t,g.getChildByName("Value").getComponent(cc.Label).string=u+"XP",g.getChildByName("Progress").getComponent(cc.ProgressBar).progress=h,g.getChildByName("Completion").getComponent(cc.Label).string=m,g.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=r<1?this.icons[0]:this.icons[s];var p=new cc.Component.EventHandler;p.target=this.node,p.component="achievementController",p.handler="getPrize",g.getComponent(cc.Button).clickEvents.push(p),this[c]=g},getPrize:function(e){var t=e.target,i=t.progress,n=t.sub,s=t.field;i>=1&&(n?(window.gameSession.achievements[n][s]++,window.gameSession.achievements[n][s]>100?(window.gameSession.achievements[n][s]=100,window.gameSession.xp-=t.reward):window.analytics.Design_event("achievement:multiple:"+n+":"+s,window.gameSession.achievements[n][s])):(window.gameSession.achievements[s]++,window.gameSession.achievements[s]>100?(window.gameSession.achievements[s]=100,window.gameSession.xp-=t.reward):window.analytics.Design_event("achievement:multiple:"+s,window.gameSession.achievements[s])),window.gameSession.xp+=t.reward,this.dungeonXP.string=window.gameSession.xp),this.updateButton(t,n,s),this.saveGame()},updateButton:function(e){if(e){e.mult;var t=e.sub,i=e.field,n=e.step,s=void 0,o=void 0;t?(s=window.gameSession.achievements[t][i],o=window.gameSession.stats[t][i]):(s=window.gameSession.achievements[i],o=window.gameSession.stats[i]);var a=(s+1)*n,r=(s+1)*e.prize,d=(o-a+n)/n,c=o+" / "+a;e.progress=d,e.reward=r,e.getChildByName("Value").getComponent(cc.Label).string=r+"XP",e.getChildByName("Progress").getComponent(cc.ProgressBar).progress=d,e.getChildByName("Completion").getComponent(cc.Label).string=c,e.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=s<1?this.icons[0]:this.icons[e.spriteID]}},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))}});t.exports=n,cc._RF.pop()},{}],analytics:[function(e,t,i){"use strict";var n;function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}cc._RF.push(t,"1f007vKAV5O5rj1ZBpAqkDr","analytics");var o=e("gameanalytics"),a=cc.Class((s(n={extends:cc.Component,properties:{Info_Log:!0,Analytics_Enabled:!0,Analytics_Initialized:{default:!1,visible:!1}},onLoad:function(){},start:function(){this.Init_Analytics()},Init_Analytics:function(){this.Analytics_Initialized||(this.Info_Log&&o.GameAnalytics.setEnabledInfoLog(!0),this.Analytics_Enabled||o.GameAnalytics.setEnabledEventSubmission(!1),o.GameAnalytics.configureBuild("0.5.0"),o.GameAnalytics.initialize("63d0bf37a3c7e7bbb8ece69373eabb43","3f919b525355ccba0faabc45f7cd0108908abe1f"),this.Analytics_Initialized=!0,cc.log("Analytics is on")),window.analytics=this},Analytics_Ready:function(){return o.GameAnalytics.isSdkReady(!0,!1)},Start_Analytics_Session:function(){o.GameAnalytics.startSession()},End_Analytics_Session:function(){o.GameAnalytics.endSessionImmediate()},Get_User_ID:function(){return o.GameAnalytics.Get_User_ID()},Level_Start:function(e,t){t=t||cc.director.getScene().name,this.Analytics_Ready()&&o.GameAnalytics.addProgressionEvent(o.EGAProgressionStatus.Start,t,e)}},"Level_Start",function(e,t){t=t||cc.director.getScene().name,this.Analytics_Ready()&&o.GameAnalytics.addProgressionEvent(o.EGAProgressionStatus.Start,t,e)}),s(n,"Level_Fail",function(e,t){t=t||cc.director.getScene().name,this.Analytics_Ready()&&o.GameAnalytics.addProgressionEvent(o.EGAProgressionStatus.Fail,t,e)}),s(n,"Level_Complete",function(e,t){t=t||cc.director.getScene().name,this.Analytics_Ready()&&o.GameAnalytics.addProgressionEvent(o.EGAProgressionStatus.Complete,t,e)}),s(n,"Design_event",function(e,t){t||(t=-1),this.Analytics_Ready()&&o.GameAnalytics.addDesignEvent(e,t)}),n));t.exports=a,cc._RF.pop()},{gameanalytics:1}],deathController:[function(e,t,i){"use strict";cc._RF.push(t,"6c4a65Zyl5N9a5j6+E0StCV","deathController");var n=e("popupController"),s=e("hudController"),o=e("feedbackController"),a=cc.Class({extends:cc.Component,properties:{popupController:n,feedbackController:o,hudController:s,deathPopup:cc.Node,deathMessage:cc.Label},iDied:function(){window.gameSession.stats.row=0,window.analytics.Level_Fail("Floor "+window.gameSession.level,"Dungeon Scene"),window.gameSession.level=window.gameSession.levelMin,window.gameSession.hp=window.gameSession.hpMax,window.gameSession.death=!0,window.gameSession.job=0,window.gameSession.inventory.fire=Math.min(window.gameSession.inventory.fireMin,window.gameSession.inventory.fireMax),window.gameSession.inventory.ice=Math.min(window.gameSession.inventory.iceMin,window.gameSession.inventory.iceMax),window.gameSession.inventory.acid=Math.min(window.gameSession.inventory.acidMin,window.gameSession.inventory.acidMax),window.gameSession.inventory.electricity=Math.min(window.gameSession.inventory.electricityMin,window.gameSession.inventory.electricityMax),window.gameSession.inventory.spikes=Math.min(window.gameSession.inventory.spikesMin,window.gameSession.inventory.spikesMax),window.gameSession.inventory.poison=Math.min(window.gameSession.inventory.poisonMin,window.gameSession.inventory.poisonMax),window.gameSession.inventory.potion=Math.min(window.gameSession.inventory.potionMin,window.gameSession.inventory.potionMax),cc.director.loadScene("gameScene")},iAmBack:function(){window.gameSession.currency<100||(window.gameSession.stats.row=0,window.gameSession.currency-=100,window.analytics.Design_event("event:ressurrection",window.gameSession.currency),window.gameSession.hp=window.gameSession.hpMax,this.hudController.updateLabel("hp",window.gameSession.hp),this.saveGame(),this.popupController.closePopupByName("death"))},kill:function(){window.gameSession.hp=-1,this.hudController.updateLabel("hp",window.gameSession.hp),this.popupController.openPermanentPopup("death")},isDead:function(){return window.gameSession.hp<1},isTrulyDead:function(){return window.gameSession.hp<9},isAlmostDead:function(){return 1==window.gameSession.hp},hasDamage:function(){return window.gameSession.hp<window.gameSession.hpMax},heal:function(e){window.gameSession.hp+=e,window.gameSession.hp>window.gameSession.hpMax&&(window.gameSession.hp=window.gameSession.hpMax),this.hudController.updateLabel("hp",window.gameSession.hp),this.feedbackController.showFeedback("+"+e+"HP",new cc.Color(0,255,0),"hp",!1)},hurt:function(e){window.gameSession.hp-=e,this.hudController.updateLabel("hp",window.gameSession.hp),this.isDead()&&this.popupController.openPermanentPopup("death"),this.feedbackController.showFeedback("-"+e+"HP",new cc.Color(255,0,0),"hp",!1),this.saveGame()},setMessage:function(e){this.deathMessage.string="You died!\n"+e},start:function(){},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))}});t.exports=a,cc._RF.pop()},{feedbackController:"feedbackController",hudController:"hudController",popupController:"popupController"}],feedbackController:[function(e,t,i){"use strict";cc._RF.push(t,"513b61nT9pAL5PhaofC19sE","feedbackController");var n=cc.Class({extends:cc.Component,properties:{defaultPosition:cc.Node,floorPosition:cc.Node,hpPosition:cc.Node,xpPosition:cc.Node,soulPosition:cc.Node,achievementPosition:cc.Node,feedbackLog:cc.Node,feedbackPrefab:cc.Prefab},start:function(){},showFeedbackAtNode:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100,a=cc.instantiate(this.feedbackPrefab);a.parent=this.node,a.color=t;var r=i.parent.convertToWorldSpaceAR(i.position);r=this.node.convertToNodeSpaceAR(r),a.x=r.x,a.x<-231&&(a.x=-200),a.x>231&&(a.x=200),a.y=r.y,a.getComponent(cc.Label).string=e;var d=void 0;d=n?cc.sequence(cc.moveBy(s,cc.v2(0,o)),cc.fadeOut(s),cc.callFunc(this.removeFeedback,this,a)):cc.sequence(cc.spawn(cc.moveBy(s,cc.v2(0,o)),cc.fadeOut(s)),cc.callFunc(this.removeFeedback,this,a)),a.runAction(d);var c=cc.instantiate(this.feedbackPrefab);c.parent=this.feedbackLog,c.getComponent(cc.Label).string=e,c.color=t},showFeedback:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],this.defaultPosition);this.hasOwnProperty(i+"Position")&&(o=this[i+"Position"]),this.showFeedbackAtNode(e,t,o,n,s)},removeFeedback:function(e){e.destroy()}});t.exports=n,cc._RF.pop()},{}],gridController:[function(e,t,i){"use strict";cc._RF.push(t,"2bcdfsBj75NDKCCf3TUBANw","gridController");var n=e("popupController"),s=e("inventoryController"),o=e("hudController"),a=e("feedbackController"),r=e("deathController");cc.Class({extends:cc.Component,properties:{popupController:n,inventoryController:s,hudController:o,feedbackController:a,deathController:r,tilePrefab:cc.Prefab,gridNode:cc.Node,nextButton:cc.Node,loadingAnimation:cc.Node,door_corner:cc.SpriteFrame,door_side:cc.SpriteFrame,deadend:cc.SpriteFrame,line:cc.SpriteFrame,curve:cc.SpriteFrame,threeway:cc.SpriteFrame,fourway:cc.SpriteFrame,unknown:cc.SpriteFrame,open:cc.SpriteFrame,danger:[cc.SpriteFrame],monster:[cc.SpriteFrame],chest:cc.SpriteFrame,stair_down:cc.SpriteFrame,stair_up:cc.SpriteFrame,lever:cc.SpriteFrame,stone:cc.SpriteFrame},start:function(){this.deathController.isDead()&&this.popupController.openPermanentPopup("death"),window.analytics.Level_Start("Floor "+window.gameSession.level,"Dungeon Scene"),this.enumSides={undefined:0,block:1,wall:2,open:3},this.enumTile={undefined:0,entrance:1,exit:2,deadend:3,corridor:4},this.enumStatus={hidden:0,flashing:1,visible:2},this.enumContent={empty:0,treasure:1,danger:2,darkness:3,monster:4,lever:5},this.enumSprite={entrance:0,exit:1,deadend:2,curve:3,line:4,threeway:5,fourway:6},this.enumClass={undefined:0,rogue:1,fighter:2,wizard:3},this.hudController.updateAllLabels(),window.gameSession.job<1&&this.showJobSelection(),this.showUpgrades(),this.checkTime(),this.saveGame(),this.clicks=0,this.dangers=0,this.dangersType=[0,0,0,0,0,0],this.treasures=0,this.monsters=0,this.clickable=0,this.dungeonMoves=0,this.running=!1,this.hitTrap=!1,this.timeToRun=.5;var e=Math.min(Math.floor(window.gameSession.level/10),10);this.size=10+e;this.tileWidth=[75,68,62.1,57.2,53,49.3,46.1,43.2,40.7,38.5,36.5][e],this.subtileWidth=[54,48.9,44.7,41.2,38.1,35.5,33.2,31.1,29.3,27.7,26.2][e],this.gridSize=this.size*this.size-1,this.initGrid(this.size),this.closed=window.gameSession.level%5==0,this.setDoorDirection(this.size),this.closed&&this.setLever(this.size),this.buildStack=new Array,this.buildMaze(this.entrance.x,this.entrance.y),this.fillGrid(this.size),this.showClickZones(this.entrance.x,this.entrance.y),this.revealSubSprite(this.entrance.x,this.entrance.y),window.gameSession.treasureHunter&&this.hudController.activateLabel("chests"),window.gameSession.trapFinder&&this.hudController.activateLabel("traps"),window.gameSession.fireFinder&&this.hudController.activateTrapLabel("fire"),window.gameSession.iceFinder&&this.hudController.activateTrapLabel("ice"),window.gameSession.acidFinder&&this.hudController.activateTrapLabel("acid"),window.gameSession.electricityFinder&&this.hudController.activateTrapLabel("electricity"),window.gameSession.spikesFinder&&this.hudController.activateTrapLabel("spikes"),window.gameSession.poisonFinder&&this.hudController.activateTrapLabel("poison"),window.gameSession.tracker&&this.hudController.activateLabel("enemies")},checkTime:function(){var e=new Date,t={d:e.getDate(),m:e.getMonth(),y:e.getFullYear()},i=window.gameSession.date;this.isNewDay(t,i)&&(this.wbPrize(),this.popupController.openPermanentPopup("dailyReward"),window.gameSession.date=t,this.saveGame())},isNewDay:function(e,t){return t?t.y<e.y||!(t.y>e.y)&&(t.m<e.m||!(t.m>e.m)&&(t.d<e.d||(t.d,e.d,!1))):(window.gameSession.date=e,!1)},wbPrize:function(){var e=Math.min(window.gameSession.upgrades.fireMin,window.gameSession.upgrades.fireMax,window.gameSession.upgrades.iceMin,window.gameSession.upgrades.iceMax,window.gameSession.upgrades.acidMin,window.gameSession.upgrades.acidMax,window.gameSession.upgrades.electricityMin,window.gameSession.upgrades.electricityMax,window.gameSession.upgrades.spikesMin,window.gameSession.upgrades.spikesMax,window.gameSession.upgrades.poisonMin,window.gameSession.upgrades.poisonMax,window.gameSession.upgrades.potionMin,window.gameSession.upgrades.potionMax,window.gameSession.upgrades.hpMax);window.gameSession.xp+=e,window.gameGlobals.xpReward=e,this.hudController.updateLabel("xp",""+window.gameSession.xp),this.feedbackController.showFeedback("+"+e+"XP",new cc.Color(0,255,0),"xp",!1),window.analytics.Design_event("event:dailyXP",e),window.gameSession.currency+=10,this.hudController.updateLabel("soul",""+window.gameSession.currency)},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},showUpgrades:function(){var e=Math.min(window.gameSession.upgrades.fireMin,window.gameSession.upgrades.fireMax,window.gameSession.upgrades.iceMin,window.gameSession.upgrades.iceMax,window.gameSession.upgrades.acidMin,window.gameSession.upgrades.acidMax,window.gameSession.upgrades.electricityMin,window.gameSession.upgrades.electricityMax,window.gameSession.upgrades.spikesMin,window.gameSession.upgrades.spikesMax,window.gameSession.upgrades.poisonMin,window.gameSession.upgrades.poisonMax,window.gameSession.upgrades.potionMin,window.gameSession.upgrades.potionMax,window.gameSession.upgrades.hpMax);window.gameSession.xp>e&&this.popupController.openPopup("upgrade")},showJobSelection:function(){this.popupController.openPermanentPopup("job")},cleanGrid:function(e){this.nextButton.active=!1,this.clicks=0,this.dangers=0,this.dangersType=[0,0,0,0,0,0],this.treasures=0,this.monsters=0;for(var t=0;t<e;t++)for(var i=0;i<e;i++)this.gridUI[t][i].destroy()},initGrid:function(e){this.grid=new Array(e),this.gridUI=new Array(e);for(var t=0;t<e;t++){this.grid[t]=new Array(e),this.gridUI[t]=new Array(e);for(var i=0;i<e;i++)this.grid[t][i]={},this.grid[t][i].x=t,this.grid[t][i].y=i,this.grid[t][i].north=this.enumSides[void 0],this.grid[t][i].south=this.enumSides[void 0],this.grid[t][i].east=this.enumSides[void 0],this.grid[t][i].west=this.enumSides[void 0],this.grid[t][i].tile=this.enumTile[void 0],this.grid[t][i].status=this.enumStatus.hidden,this.grid[t][i].content=this.enumContent.empty,0==t&&(this.grid[t][i].north=this.enumSides.block),t==e-1&&(this.grid[t][i].south=this.enumSides.block),0==i&&(this.grid[t][i].west=this.enumSides.block),i==e-1&&(this.grid[t][i].east=this.enumSides.block)}},showClickZones:function(e,t){var i=this.grid[e][t],n=0;i.north==this.enumSides.open&&this.addClickFunction(e-1,t)&&n++,i.south==this.enumSides.open&&this.addClickFunction(e+1,t)&&n++,i.east==this.enumSides.open&&this.addClickFunction(e,t+1)&&n++,i.west==this.enumSides.open&&this.addClickFunction(e,t-1)&&n++,n>1&&(this.running=!1)},addClickFunction:function(e,t){var i=this.grid[e][t];if(i.status==this.enumStatus.visible)return!1;if(i.status==this.enumStatus.flashing)return this.lastClickZone=this.gridUI[e][t],!0;i.status=this.enumStatus.flashing,this.clickable++;var n=this.gridUI[e][t];n.getComponent(cc.Sprite).spriteFrame=this.open;var s=new cc.Component.EventHandler;return s.target=this.node,s.component="gridController",s.handler="gridClick",n.tile=i,n.getComponent(cc.Button).clickEvents.push(s),this.lastClickZone=n,!0},startRunning:function(){this.running=!0,this.timeToRun=.5},run:function(e){var t={};this.lastClickZone?(t.target=this.lastClickZone,this.lastClickZone=null,null!=t.target&&this.gridClick(t)):this.running=!1},gridClick:function(e){if(this.deathController.isDead())this.popupController.openPermanentPopup("death");else if(!this.popupController.isAnyOpen())if(e.target.tile.tile!=this.enumTile.exit||!e.target.used||this.closed){if(!e.target.used){e.target.used=!0,this.clickable--,window.gameSession.stats.tiles++,window.gameSession.stats.tiles%1e3==0&&this.feedbackController.showFeedback("Achievement: Runner",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.treasureHunter&&this.hudController.activateLabel("chests"),window.gameSession.trapFinder&&this.hudController.activateLabel("traps"),window.gameSession.fireFinder&&this.hudController.activateTrapLabel("fire"),window.gameSession.iceFinder&&this.hudController.activateTrapLabel("ice"),window.gameSession.acidFinder&&this.hudController.activateTrapLabel("acid"),window.gameSession.electricityFinder&&this.hudController.activateTrapLabel("electricity"),window.gameSession.spikesFinder&&this.hudController.activateTrapLabel("spikes"),window.gameSession.poisonFinder&&this.hudController.activateTrapLabel("poison"),window.gameSession.tracker&&this.hudController.activateLabel("enemies"),this.startRunning();var t=e.target.tile;t.status=this.enumStatus.visible,e.target.getComponent(cc.Sprite).spriteFrame=t.sprite,this.showClickZones(t.x,t.y),this.deathController.hasDamage()&&window.gameSession.inventory.potion>0&&(this.inventoryController.useItem("potion",1,e.target),window.gameSession.stats.items.potion%100==0&&this.feedbackController.showFeedback("Achievement: Not addicted",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.items.total%100==0&&this.feedbackController.showFeedback("Achievement: Spender",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.job==this.enumClass.wizard?this.deathController.heal(2):this.deathController.heal(1));var i=0;if(this.clicks++,this.clicks==this.gridSize&&(window.analytics.Design_event("event:cleanFloor",window.gameSession.level),i+=window.gameSession.level*(this.gridSize+1),window.gameSession.job==this.enumClass.wizard&&(i+=window.gameSession.level*this.gridSize)),i+=window.gameSession.level,window.gameSession.job==this.enumClass.wizard&&(i+=window.gameSession.level),t.content==this.enumContent.treasure&&(this.running=!1,this.giveTreasure(Math.floor(100*Math.random()+1),e.target)),t.content==this.enumContent.danger&&(this.running=!1,this.fightDanger(t.contentType,e.target),this.findSubSprite(t,t.contentType),this.deathController.isDead()?(this.popupController.openPermanentPopup("death"),this.deathController.setMessage("You were "+this.lastDanger+"!")):(i+=25*window.gameSession.level,window.gameSession.job==this.enumClass.rogue&&(i+=25*window.gameSession.level),window.gameSession.stats.traps.total++,window.gameSession.stats.traps.total%100==0&&this.feedbackController.showFeedback("Achievement: Trap Finder",new cc.Color(0,255,0),"achievement",!0,5))),t.content==this.enumContent.darkness){this.feedbackController.showFeedback("Dungeon Moves!",new cc.Color(255,0,0),"floor",!0),this.dungeonMoves++,window.analytics.Design_event("event:darkness",this.dungeonMoves),this.dungeonMoves>1&&(window.gameSession.stats.unique.darkness=!0,window.gameSession.achievements.unique.darkness||this.feedbackController.showFeedback("Achievement: Stop Moving!",new cc.Color(0,255,0),"achievement",!0,5)),this.running=!1;var n=e.target.tile.x,s=e.target.tile.y;this.cleanGrid(this.size),this.initGrid(this.size),this.closed=window.gameSession.level%25==0,this.setDoorDirection(this.size),this.closed&&this.setLever(this.size),this.buildStack=new Array,this.buildMaze(this.entrance.x,this.entrance.y),this.grid[this.entrance.x][this.entrance.y].status=this.enumStatus.hidden,this.grid[n][s].status=this.enumStatus.visible,this.fillGrid(this.size),this.showClickZones(n,s)}if(t.content==this.enumContent.monster){this.running=!1;var o=Math.floor(3*Math.random()+1);this.fightMonster(o,e.target,0),this.findSubSprite(t,o),this.deathController.isDead()?(this.popupController.openPermanentPopup("death"),this.deathController.setMessage("You were "+this.lastDanger+"!")):(i+=25*window.gameSession.level,window.gameSession.job==this.enumClass.fighter&&(i+=50*window.gameSession.level))}if(t.content==this.enumContent.lever){window.analytics.Design_event("event:lever",window.gameSession.level),this.feedbackController.showFeedback("Stairs Unlocked",new cc.Color(0,255,0),"floor",!0),this.closed=!1;var a=this.grid[this.exit.x][this.exit.y];this.findSubSprite(a,-1),a.status==this.enumStatus.visible&&(this.revealSubSprite(this.exit.x,this.exit.y),this.nextButton.active=!0)}if(this.revealSubSprite(t.x,t.y),t.tile==this.enumTile.exit){this.running=!1,this.closed?(this.feedbackController.showFeedback("Stairs Locked",new cc.Color(255,0,0),"floor",!0),window.analytics.Design_event("event:stairsLocked",window.gameSession.level)):this.nextButton.active=!0;var r=0;if(window.gameSession.level%10==0?r=2:window.gameSession.level%5==0&&(r=1),r>0){this.monsters++;var d=Math.floor(3*Math.random()+1);this.fightMonster(d,e.target,r),this.findSubSprite(t,d),this.deathController.isDead()?(this.popupController.openPermanentPopup("death"),this.deathController.setMessage("You were "+this.lastDanger+"!")):(i+=25*window.gameSession.level,window.gameSession.job==this.enumClass.fighter&&(i+=50*window.gameSession.level))}}window.gameSession.xp+=i,this.hudController.updateLabel("xp",""+window.gameSession.xp),this.feedbackController.showFeedback("+"+i+"XP",new cc.Color(0,255,0),"xp",!1)}}else this.nextLevel()},revealSubSprite:function(e,t){var i=this.grid[e][t],n=this.gridUI[e][t],s=n.getChildByName("content");s.angle=360-n.angle,i.subsprite&&(s.getComponent(cc.Sprite).spriteFrame=i.subsprite)},fightMonster:function(e,t,i){this.monsters--,this.hudController.updateLabel("enemies",""+this.monsters);var n=Math.floor(window.gameSession.level/5)+1+i*Math.floor(Math.random()*Math.floor(window.gameSession.level/10)+1);window.gameSession.job==this.enumClass.fighter&&n--;var s=void 0,o=void 0,a=void 0,r=void 0,d=void 0,c=void 0;switch(e){case 1:s="Fought Orc",o="murdered",a="melee",r="I need a shield",d="Warrior",c="Shaky Hand";break;case 2:s="Fought Cockatrice",o="petrified",a="ranged",r="This bow is bad",d="Archer",c="Bad Sight";break;case 3:s="Fought Ghost",o="drained of life",a="magic",r="I need a staff",d="Archmage",c="Curled Tongue"}i>1?s+=" Boss":i>0&&(s+=" Sub-boss"),this.feedbackController.showFeedbackAtNode(s,new cc.Color(255,0,0),t,!0,3,75),this.lastDanger=o,n-window.gameSession.inventory[a]<-9&&(window.gameSession.achievements.unique.overkill||this.feedbackController.showFeedback("Achievement: Overkill",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.unique.overkill=!0),window.analytics.Design_event("Fight:"+a+":"+n,window.gameSession.inventory[a]),(n-=Math.min(n,window.gameSession.inventory[a]))>0&&(this.deathController.hurt(n),window.gameSession.stats.damage[a]+=n,window.gameSession.stats.damage[a]%100==0&&this.feedbackController.showFeedback("Achievement: "+r,new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.damage.total+=n,window.gameSession.stats.damage.total%100==0&&this.feedbackController.showFeedback("Achievement: It hurts everywhere",new cc.Color(0,255,0),"achievement",!0,5)),this.deathController.isDead()?(this.deathController.isTrulyDead()&&(window.gameSession.achievements.unique.truedeath||this.feedbackController.showFeedback("Achievement: True Death",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.unique.truedeath=!0),1==i&&(window.gameSession.achievements.unique.subboss||this.feedbackController.showFeedback("Achievement: Did not expected that",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.unique.subboss=!0),2==i&&(window.gameSession.achievements.unique.boss||this.feedbackController.showFeedback("Achievement: Expected that",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.unique.boss=!0),window.gameSession.death&&(window.gameSession.achievements.unique.already||this.feedbackController.showFeedback("Achievement: Already Back?",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.unique.already=!0),window.gameSession.stats.death[a]++,window.gameSession.stats.death[a]%100==0&&this.feedbackController.showFeedback("Achievement: "+c,new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.death.total++,window.gameSession.stats.death.total%100==0&&this.feedbackController.showFeedback("Achievement: Kenny",new cc.Color(0,255,0),"achievement",!0,5)):(window.gameSession.stats.kills[a]++,window.gameSession.stats.kills[a]%100==0&&this.feedbackController.showFeedback("Achievement: "+d,new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.kills.total++,window.gameSession.stats.kills.total%100==0&&this.feedbackController.showFeedback("Achievement: God of War",new cc.Color(0,255,0),"achievement",!0,5),this.giveTreasure(Math.floor(100*Math.random()+1),t,!0))},fightDanger:function(e,t){this.dangers--,this.hitTrap=!0,this.hudController.updateLabel("traps",""+this.dangers);var i=Math.floor(window.gameSession.level/10+1);window.gameSession.job==this.enumClass.rogue&&i--;var n=void 0,s=void 0,o=void 0,a=void 0,r=void 0,d=void 0;switch(this.deathController.isAlmostDead()&&!this.inventoryController.hasDefenses()&&(window.gameSession.achievements.unique.daredevil||this.feedbackController.showFeedback("Achievement: Daredevil",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.unique.daredevil=!0),e){case 1:n="Fire Trap",s="burned",o="fire","Fire",a="Getting warmer",r="Like sunscreen",d="Barbecue";break;case 2:n="Freezing Trap",s="frozen",o="ice","Ice",a="Getting colder",r="A warm blanket",d="Popsicle";break;case 3:n="Acid Trap",s="dissolved",o="acid","Acid",a="Dirty floor",r="Still intact",d="Not much left";break;case 4:n="Electricity Trap",s="electrocuted",o="electricity","Electricity",a="Tesla attack",r="Fully isolated",d="Full of Energy";break;case 5:n="Floor Spikes Trap",s="impaled",o="spikes","Spikes",a="Holed floor",r="Steel boots",d="Is Vlad here?";break;case 6:n="Poisoned Dart Trap",s="poisoned",o="poison","Poison",a="Holed wall",r="Antidote",d="Is there an antidote?"}if(this.dangersType[e-1]--,this.hudController.updateTraps(o,this.dangersType[e-1]),window.analytics.Design_event("Trap:"+o+":"+i,window.gameSession.inventory[o]),i-=window.gameSession.skills[o+"Shield"],this.feedbackController.showFeedbackAtNode(n,new cc.Color(255,0,0),t,!0,3,75),this.lastDanger=s,window.gameSession.stats.traps[o]++,window.gameSession.stats.traps[o]%100==0&&this.feedbackController.showFeedback("Achievement: "+a,new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.inventory[o]>0){var c=window.gameSession.inventory[o],l=Math.min(i,c);this.inventoryController.useItem(o,l,t),window.gameSession.stats.items[o]%100==0&&this.feedbackController.showFeedback("Achievement: "+r,new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.items.total%100==0&&this.feedbackController.showFeedback("Achievement: Spender",new cc.Color(0,255,0),"achievement",!0,5),i-=l}i>0&&(this.deathController.hurt(i),window.gameSession.stats.damage[o]+=i,window.gameSession.stats.items[o]%100==0&&this.feedbackController.showFeedback("Achievement: "+r,new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.damage.total+=i,window.gameSession.stats.damage.total%100==0&&this.feedbackController.showFeedback("Achievement: It hurts everywhere",new cc.Color(0,255,0),"achievement",!0,5)),this.deathController.isDead()&&(this.deathController.isTrulyDead()&&(window.gameSession.achievements.unique.truedeath||this.feedbackController.showFeedback("Achievement: True Death",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.unique.truedeath=!0),window.gameSession.death&&(window.gameSession.achievements.unique.already||this.feedbackController.showFeedback("Achievement: Already Back?",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.unique.already=!0),window.gameSession.stats.death[o]++,window.gameSession.stats.death[o]%100==0&&this.feedbackController.showFeedback("Achievement: "+d,new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.death.total++,window.gameSession.stats.death.total%100==0&&this.feedbackController.showFeedback("Achievement: Kenny",new cc.Color(0,255,0),"achievement",!0,5))},giveTreasure:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(this.treasures--,this.hudController.updateLabel("chests",""+this.treasures));var i=1+window.gameSession.skills.totalShield;window.gameSession.stats.items.chests+=i,window.gameSession.stats.items.chests%100==0&&this.feedbackController.showFeedback("Achievement: Treasure Hunter",new cc.Color(0,255,0),"achievement",!0,5),e<=10?this.inventoryController.giveItem("potion",i,t,"Potion"):e<=25?this.inventoryController.giveItem("fire",i,t,"Fire Shield"):e<=40?this.inventoryController.giveItem("ice",i,t,"Ice Shield"):e<=55?this.inventoryController.giveItem("acid",i,t,"Acid Shield"):e<=70?this.inventoryController.giveItem("electricity",i,t,"Electricity Shield"):e<=85?this.inventoryController.giveItem("spikes",i,t,"Spikes Shield"):e<=100&&this.inventoryController.giveItem("poison",i,t,"Poison Shield")},nextLevel:function(){this.deathController.isDead()?this.popupController.openPermanentPopup("death"):(this.loadingAnimation.active=!0,window.gameSession.death=!1,this.hitTrap||(window.gameSession.achievements.unique.lucky||this.feedbackController.showFeedback("Achievement: Lucky",new cc.Color(0,255,0),"achievement",!0,5),window.gameSession.stats.unique.lucky=!0),window.gameSession.currency++,window.gameSession.stats.row++,window.analytics.Level_Complete("Floor "+window.gameSession.level,"Dungeon Scene"),window.gameSession.level++,window.gameSession.level>window.gameSession.stats.levelMax&&(window.gameSession.stats.levelMax=window.gameSession.level),window.gameSession.stats.levelMax%100==0&&this.feedbackController.showFeedback("Achievement: Explorer",new cc.Color(0,255,0),"achievement",!0,5),cc.director.loadScene("gameScene"))},fillGrid:function(e){for(var t=0;t<e;t++)for(var i=0;i<e;i++){var n=this.grid[t][i];this.makeWall(n),this.findSprite(n),this.findSubSprite(n,-1);var s=cc.instantiate(this.tilePrefab);this.gridUI[t][i]=s,s.width=this.tileWidth,s.height=this.tileWidth;var o=s.getChildByName("content");o.width=this.subtileWidth,o.height=this.subtileWidth,s.parent=this.gridNode,s.angle=n.angle;var a=s.getComponent(cc.Sprite);n.status==this.enumStatus.visible?a.spriteFrame=n.sprite:n.status==this.enumStatus.hidden&&(a.spriteFrame=this.unknown)}},findSubSprite:function(e,t){e.tile==this.enumTile.entrance?e.subsprite=this.stair_up:e.tile==this.enumTile.exit&&this.closed?e.subsprite=this.stone:e.tile==this.enumTile.exit?e.subsprite=this.stair_down:e.content==this.enumContent.treasure?e.subsprite=this.chest:e.content==this.enumContent.danger&&t>-1?e.subsprite=this.danger[t-1]:e.content==this.enumContent.monster&&t>-1?e.subsprite=this.monster[t-1]:e.content==this.enumContent.lever&&(e.subsprite=this.lever)},findSprite:function(e){if(e.tile==this.enumTile.deadend)this.showDeadend(e);else{var t=0;e.north==this.enumSides.open&&t++,e.south==this.enumSides.open&&t++,e.east==this.enumSides.open&&t++,e.west==this.enumSides.open&&t++,1==t?this.showDeadend(e):2==t&&(e.north==this.enumSides.open&&e.south==this.enumSides.open||e.east==this.enumSides.open&&e.west==this.enumSides.open)?this.showLine(e):2==t?this.showCurve(e):3==t?this.showThreeWay(e):4==t?this.showFourWay(e):console.error("ERROR: no sprite",e)}},showDoor:function(e){var t=0;e.north==this.enumSides.block&&t++,e.south==this.enumSides.block&&t++,e.east==this.enumSides.block&&t++,e.west==this.enumSides.block&&t++,2==t?(e.sprite=this.door_corner,1==e.north?1==e.west?e.angle=-0:1==e.east&&(e.angle=-90):1==e.south&&(1==e.west?e.angle=-270:1==e.east&&(e.angle=-180))):1==t?(e.sprite=this.door_side,1==e.north?e.angle=-0:1==e.east?e.angle=-90:1==e.south?e.angle=-180:1==e.west&&(e.angle=-270)):console.error("ERROR: should not have that amount of blocks",e,t)},showDeadend:function(e){e.sprite=this.deadend,e.north==this.enumSides.open?e.angle=-270:e.east==this.enumSides.open?e.angle=-0:e.south==this.enumSides.open?e.angle=-90:e.west==this.enumSides.open&&(e.angle=-180),Math.floor(100*Math.random()+1)<=25+Math.min(35,window.gameSession.level)&&e.content==this.enumContent.empty&&e.tile!=this.enumTile.entrance&&e.tile!=this.enumTile.exit?(e.content=this.enumContent.danger,e.contentType=Math.floor(6*Math.random()+1),this.dangersType[e.contentType-1]++,this.hudController.updateTrapsByNumber(e.contentType-1,this.dangersType[e.contentType-1]),this.dangers++,this.hudController.updateLabel("traps",""+this.dangers)):e.content==this.enumContent.empty&&e.tile!=this.enumTile.entrance&&e.tile!=this.enumTile.exit&&(e.content=this.enumContent.treasure,this.treasures++,this.hudController.updateLabel("chests",""+this.treasures))},showLine:function(e){e.sprite=this.line,e.north==this.enumSides.open?e.angle=-0:e.east==this.enumSides.open&&(e.angle=-90)},showCurve:function(e){e.sprite=this.curve,e.north==this.enumSides.open?e.west==this.enumSides.open?e.angle=-180:e.east==this.enumSides.open&&(e.angle=-270):e.south==this.enumSides.open&&(e.west==this.enumSides.open?e.angle=-90:e.east==this.enumSides.open&&(e.angle=-0))},showThreeWay:function(e){e.sprite=this.threeway,e.north==this.enumSides.wall||e.north==this.enumSides.block?e.angle=-0:e.east==this.enumSides.wall||e.east==this.enumSides.block?e.angle=-90:e.south==this.enumSides.wall||e.south==this.enumSides.block?e.angle=-180:e.west==this.enumSides.wall||e.west==this.enumSides.block?e.angle=-270:console.error("ERROR: no wall",e)},showFourWay:function(e){e.sprite=this.fourway,e.angle=-0},makeWall:function(e){e.north==this.enumSides[void 0]&&(e.north=this.enumSides.wall),e.south==this.enumSides[void 0]&&(e.south=this.enumSides.wall),e.east==this.enumSides[void 0]&&(e.east=this.enumSides.wall),e.west==this.enumSides[void 0]&&(e.west=this.enumSides.wall)},buildMaze:function(e,t){this.buildStack.push({x:e,y:t});var i=this.grid[e][t],n=this.findPath(i);if(0==n){if(i.tile==this.enumTile[void 0]&&(i.tile=this.enumTile.deadend),this.buildStack.pop(),this.buildStack.length>0){var s=this.buildStack.pop();this.buildMaze(s.x,s.y)}}else{if(i.tile==this.enumTile[void 0]){i.tile=this.enumTile.corridor;var o=Math.floor(100*Math.random()+1);if(o<=5&&i.content==this.enumContent.empty){var a=Math.floor(100*Math.random()+1),r=Math.min(25,window.gameSession.level);0==window.gameSession.level%5&&a<=1?i.content=this.enumContent.darkness:a<=25+r?(i.content=this.enumContent.danger,i.contentType=Math.floor(6*Math.random()+1),this.dangersType[i.contentType-1]++,this.hudController.updateTrapsByNumber(i.contentType-1,this.dangersType[i.contentType-1]),this.dangers++,this.hudController.updateLabel("traps",""+this.dangers)):(i.content=this.enumContent.treasure,this.treasures++,this.hudController.updateLabel("chests",""+this.treasures))}else o<=10&&i.content==this.enumContent.empty&&(i.content=this.enumContent.monster,this.monsters++,this.hudController.updateLabel("enemies",""+this.monsters))}var d=Math.floor(Math.random()*n+1);this.makePath(e,t,d)}},makePath:function(e,t,i){var n=this.grid[e][t],s=0;return n.north==this.enumSides[void 0]&&s++,s==i?(n.north=this.enumSides.open,this.grid[e-1][t].south=this.enumSides.open,void this.buildMaze(e-1,t)):(n.east==this.enumSides[void 0]&&s++,s==i?(n.east=this.enumSides.open,this.grid[e][t+1].west=this.enumSides.open,void this.buildMaze(e,t+1)):(n.south==this.enumSides[void 0]&&s++,s==i?(n.south=this.enumSides.open,this.grid[e+1][t].north=this.enumSides.open,void this.buildMaze(e+1,t)):(n.west==this.enumSides[void 0]&&s++,s==i?(n.west=this.enumSides.open,this.grid[e][t-1].east=this.enumSides.open,void this.buildMaze(e,t-1)):void 0)))},findPath:function(e){var t=0;return e.north==this.enumSides[void 0]&&this.isPathFree("north",e,e.x-1,e.y)?t++:e.north==this.enumSides[void 0]&&(e.north=this.enumSides.wall),e.south==this.enumSides[void 0]&&this.isPathFree("south",e,e.x+1,e.y)?t++:e.south==this.enumSides[void 0]&&(e.south=this.enumSides.wall),e.east==this.enumSides[void 0]&&this.isPathFree("east",e,e.x,e.y+1)?t++:e.east==this.enumSides[void 0]&&(e.east=this.enumSides.wall),e.west==this.enumSides[void 0]&&this.isPathFree("west",e,e.x,e.y-1)?t++:e.west==this.enumSides[void 0]&&(e.west=this.enumSides.wall),t},isPathFree:function(e,t,i,n){if(t[e]==this.enumSides.block)return!1;var s=this.grid[i][n];return s.tile!=this.enumTile.deadend&&s.tile!=this.enumTile.corridor&&(s.tile==this.enumTile[void 0]||s.tile==this.enumTile.exit)},setDoorDirection:function(e){var t=Math.floor(4*Math.random()+1),i=Math.floor(Math.random()*Math.floor(this.size/2));switch(t){case 1:this.makeDoors(0,Math.floor(Math.random()*e),e-1-i,Math.floor(Math.random()*e));break;case 2:this.makeDoors(e-1,Math.floor(Math.random()*e),0+i,Math.floor(Math.random()*e));break;case 3:this.makeDoors(Math.floor(Math.random()*e),0,Math.floor(Math.random()*e),e-1-i);break;case 4:this.makeDoors(Math.floor(Math.random()*e),e-1,Math.floor(Math.random()*e),0+i)}},setLever:function(e){var t=Math.floor(Math.random()*(e-2)+1),i=Math.floor(Math.random()*(e-2)+1);this.grid[t][i].content=this.enumContent.lever},makeDoors:function(e,t,i,n){var s=this.grid[e][t];s.tile=this.enumTile.entrance,s.status=this.enumStatus.visible,this.entrance={x:e,y:t},(s=this.grid[i][n]).tile=this.enumTile.exit,this.exit={x:i,y:n}},update:function(e){this.running&&(this.timeToRun-=e,this.timeToRun<0&&(this.startRunning(),this.run(this.size)))}});cc._RF.pop()},{deathController:"deathController",feedbackController:"feedbackController",hudController:"hudController",inventoryController:"inventoryController",popupController:"popupController"}],hudController:[function(e,t,i){"use strict";cc._RF.push(t,"2880fofxmxAZYlWg9He4tOm","hudController");var n=cc.Class({extends:cc.Component,properties:{soul:cc.Label,floor:cc.Label,xp:cc.Label,hp:cc.Label,fireShield:cc.Label,iceShield:cc.Label,acidShield:cc.Label,electricityShield:cc.Label,spikesShield:cc.Label,poisonShield:cc.Label,fireTrap:cc.Label,iceTrap:cc.Label,acidTrap:cc.Label,electricityTrap:cc.Label,spikesTrap:cc.Label,poisonTrap:cc.Label,traps:cc.Label,enemies:cc.Label,chests:cc.Label},start:function(){this.hasOwnProperty("elements")||(this.elements=["fire","ice","acid","electricity","spikes","poison"])},activateLabel:function(e){this.hasOwnProperty(e)&&(this[e].node.active=!0)},activateTrapLabel:function(e){this.hasOwnProperty(e+"Trap")&&(this[e+"Trap"].node.active=!0)},updateLabel:function(e,t){this.hasOwnProperty(e)&&(this[e].string=t)},updateShields:function(e){this.hasOwnProperty(e+"Shield")&&(this[e+"Shield"].string=window.gameSession.inventory[e])},updateTraps:function(e,t){this.hasOwnProperty(e+"Trap")&&(this[e+"Trap"].string=t)},updateTrapsByNumber:function(e,t){this.hasOwnProperty("elements")||(this.elements=["fire","ice","acid","electricity","spikes","poison"]),this.updateTraps(this.elements[e],t)},updateAllLabels:function(){this.updateLabel("floor",""+window.gameSession.level),this.updateLabel("xp",""+window.gameSession.xp),this.updateLabel("hp",""+window.gameSession.hp),this.updateLabel("soul",""+window.gameSession.currency),this.updateShields("fire"),this.updateShields("ice"),this.updateShields("acid"),this.updateShields("electricity"),this.updateShields("spikes"),this.updateShields("poison")}});t.exports=n,cc._RF.pop()},{}],inventoryController:[function(e,t,i){"use strict";cc._RF.push(t,"417d1Ks4C1G6rI6w1DtonjZ","inventoryController");var n=e("hudController"),s=e("feedbackController"),o=cc.Class({extends:cc.Component,properties:{hudController:n,feedbackController:s,inventoryFire:cc.Label,inventoryIce:cc.Label,inventoryAcid:cc.Label,inventoryElectricity:cc.Label,inventorySpikes:cc.Label,inventoryPoison:cc.Label,inventoryPotion:cc.Label},onEnable:function(){this.updateLabel("fire"," Shield"),this.updateLabel("ice"," Shield"),this.updateLabel("acid"," Shield"),this.updateLabel("electricity"," Shield"),this.updateLabel("spikes"," Shield"),this.updateLabel("poison"," Shield"),this.updateLabel("potion","")},start:function(){},hasDefenses:function(){return window.gameSession.inventory.fire+window.gameSession.inventory.ice+window.gameSession.inventory.acid+window.gameSession.inventory.electricity+window.gameSession.inventory.spikes+window.gameSession.inventory.poison>0},updateLabel:function(e,t){var i=this.jsUcfirst(e);this["inventory"+i].string=i+t+": "+window.gameSession.inventory[e]+"/"+window.gameSession.inventory[e+"Max"],window.gameSession.skills.hasOwnProperty(e+"Shield")&&(this["inventory"+i].string=this["inventory"+i].string+" (+"+window.gameSession.skills[e+"Shield"]+")")},giveItem:function(e,t,i,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Treasure";window.analytics.Design_event(s+":"+e,t),window.gameSession.inventory[e]=Math.min(window.gameSession.inventory[e]+t,window.gameSession.inventory[e+"Max"]),this.hudController.updateShields(e),this.feedbackController.showFeedbackAtNode("Got "+t+" "+n,new cc.Color(0,255,0),i,!0,3,150)},useItem:function(e,t,i){window.analytics.Design_event("Use:"+e,t),window.gameSession.inventory[e]=Math.max(window.gameSession.inventory[e]-t,0),this.hudController.updateShields(e),"potion"!=e?this.feedbackController.showFeedbackAtNode("-"+t+" "+e+" Shield",new cc.Color(255,0,0),i,!0,3,150):this.feedbackController.showFeedbackAtNode("Used potion",new cc.Color(0,255,0),i,!0,3,150),window.gameSession.stats.items.potion+=t,window.gameSession.stats.items.total+=t},jsUcfirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}});t.exports=o,cc._RF.pop()},{feedbackController:"feedbackController",hudController:"hudController"}],jobController:[function(e,t,i){"use strict";cc._RF.push(t,"27833am8SxCGaYvkSU/1GHv","jobController"),cc.Class({extends:cc.Component,properties:{jobPrefab:cc.Prefab,icons:[cc.SpriteFrame]},start:function(){this.enumClass={undefined:0,rogue:1,fighter:2,wizard:3}},setClass:function(e,t){window.analytics.Design_event("class:"+t),window.gameSession.job=this.enumClass[t],this.saveGame()},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))}}),cc._RF.pop()},{}],loadAnimation:[function(e,t,i){"use strict";cc._RF.push(t,"fb4a7g7oO9NsJmnvlyTyK/R","loadAnimation"),cc.Class({extends:cc.Component,properties:{animated:cc.Node},start:function(){this.animate()},animate:function(){var e=cc.sequence(cc.moveBy(.1,cc.v2(-100,0)),cc.moveBy(.2,cc.v2(0,200)),cc.moveBy(.2,cc.v2(-200,0)),cc.moveBy(.4,cc.v2(0,-400)),cc.moveBy(.2,cc.v2(200,0)),cc.moveBy(.2,cc.v2(0,200)),cc.moveBy(.2,cc.v2(200,0)),cc.moveBy(.2,cc.v2(0,200)),cc.moveBy(.2,cc.v2(200,0)),cc.moveBy(.4,cc.v2(0,-400)),cc.moveBy(.2,cc.v2(-200,0)),cc.moveBy(.2,cc.v2(0,200)),cc.moveBy(.1,cc.v2(-100,0)));this.animated.runAction(cc.repeatForever(e))}}),cc._RF.pop()},{}],loadingController:[function(e,t,i){"use strict";cc._RF.push(t,"eb052hXqyVDe45o+9GyjV2u","loadingController");var n=e("analytics");cc.Class({extends:cc.Component,properties:{analytics:n,sprite:cc.Sprite,tutorial:[cc.SpriteFrame]},start:function(){this.saveLoaded=!1,this.timer=0;this.initSession({major:0,minor:6,fix:0}),this.saveLoaded=!0},initSession:function(e){this.loadGame(),window.gameGlobals={},this.setDefault(window,"gameSession",{}),this.setDefault(window.gameSession,"xp",0),this.setDefault(window.gameSession,"currency",0),this.setDefault(window.gameSession,"hp",3),this.setDefault(window.gameSession,"hpMax",3),this.setDefault(window.gameSession,"level",1),this.setDefault(window.gameSession,"levelMin",1),this.setDefault(window.gameSession,"levelPassage",window.gameSession.levelMin),this.setDefault(window.gameSession,"inventory",{}),this.setDefault(window.gameSession.inventory,"fire",0),this.setDefault(window.gameSession.inventory,"fireMin",0),this.setDefault(window.gameSession.inventory,"fireMax",3),this.setDefault(window.gameSession.inventory,"ice",0),this.setDefault(window.gameSession.inventory,"iceMin",0),this.setDefault(window.gameSession.inventory,"iceMax",3),this.setDefault(window.gameSession.inventory,"acid",0),this.setDefault(window.gameSession.inventory,"acidMin",0),this.setDefault(window.gameSession.inventory,"acidMax",3),this.setDefault(window.gameSession.inventory,"electricity",0),this.setDefault(window.gameSession.inventory,"electricityMin",0),this.setDefault(window.gameSession.inventory,"electricityMax",3),this.setDefault(window.gameSession.inventory,"spikes",0),this.setDefault(window.gameSession.inventory,"spikesMin",0),this.setDefault(window.gameSession.inventory,"spikesMax",3),this.setDefault(window.gameSession.inventory,"poison",0),this.setDefault(window.gameSession.inventory,"poisonMin",0),this.setDefault(window.gameSession.inventory,"poisonMax",3),this.setDefault(window.gameSession.inventory,"potion",0),this.setDefault(window.gameSession.inventory,"potionMin",0),this.setDefault(window.gameSession.inventory,"potionMax",3),this.setDefault(window.gameSession.inventory,"melee",1),this.setDefault(window.gameSession.inventory,"ranged",1),this.setDefault(window.gameSession.inventory,"magic",1),this.setDefault(window.gameSession,"upgrades",{}),this.setDefault(window.gameSession.upgrades,"fireMin",1e3),this.setDefault(window.gameSession.upgrades,"fireMax",1e3),this.setDefault(window.gameSession.upgrades,"iceMin",1e3),this.setDefault(window.gameSession.upgrades,"iceMax",1e3),this.setDefault(window.gameSession.upgrades,"acidMin",1e3),this.setDefault(window.gameSession.upgrades,"acidMax",1e3),this.setDefault(window.gameSession.upgrades,"electricityMin",1e3),this.setDefault(window.gameSession.upgrades,"electricityMax",1e3),this.setDefault(window.gameSession.upgrades,"spikesMin",1e3),this.setDefault(window.gameSession.upgrades,"spikesMax",1e3),this.setDefault(window.gameSession.upgrades,"poisonMin",1e3),this.setDefault(window.gameSession.upgrades,"poisonMax",1e3),this.setDefault(window.gameSession.upgrades,"potionMin",1e3),this.setDefault(window.gameSession.upgrades,"potionMax",1e3),this.setDefault(window.gameSession.upgrades,"hpMax",1e3),this.setDefault(window.gameSession.upgrades,"levelMin",1e3),this.setDefault(window.gameSession.upgrades,"info",1e3),this.setDefault(window.gameSession.upgrades,"melee",1e3),this.setDefault(window.gameSession.upgrades,"ranged",1e3),this.setDefault(window.gameSession.upgrades,"magic",1e3),this.setDefault(window.gameSession,"stats",{}),this.setDefault(window.gameSession.stats,"unique",{}),this.setDefault(window.gameSession.stats.unique,"truedeath",!1),this.setDefault(window.gameSession.stats.unique,"daredevil",!1),this.setDefault(window.gameSession.stats.unique,"already",!1),this.setDefault(window.gameSession.stats.unique,"overkill",!1),this.setDefault(window.gameSession.stats.unique,"darkness",!1),this.setDefault(window.gameSession.stats.unique,"lucky",!1),this.setDefault(window.gameSession.stats.unique,"subboss",!1),this.setDefault(window.gameSession.stats.unique,"boss",!1),this.setDefault(window.gameSession.stats,"death",{}),this.setDefault(window.gameSession.stats.death,"total",0),this.setDefault(window.gameSession.stats.death,"fire",0),this.setDefault(window.gameSession.stats.death,"ice",0),this.setDefault(window.gameSession.stats.death,"acid",0),this.setDefault(window.gameSession.stats.death,"electricity",0),this.setDefault(window.gameSession.stats.death,"spikes",0),this.setDefault(window.gameSession.stats.death,"poison",0),this.setDefault(window.gameSession.stats.death,"melee",0),this.setDefault(window.gameSession.stats.death,"ranged",0),this.setDefault(window.gameSession.stats.death,"magic",0),this.setDefault(window.gameSession.stats,"damage",{}),this.setDefault(window.gameSession.stats.damage,"total",0),this.setDefault(window.gameSession.stats.damage,"fire",0),this.setDefault(window.gameSession.stats.damage,"ice",0),this.setDefault(window.gameSession.stats.damage,"acid",0),this.setDefault(window.gameSession.stats.damage,"electricity",0),this.setDefault(window.gameSession.stats.damage,"spikes",0),this.setDefault(window.gameSession.stats.damage,"poison",0),this.setDefault(window.gameSession.stats.damage,"melee",0),this.setDefault(window.gameSession.stats.damage,"ranged",0),this.setDefault(window.gameSession.stats.damage,"magic",0),this.setDefault(window.gameSession.stats,"items",{}),this.setDefault(window.gameSession.stats.items,"chests",0),this.setDefault(window.gameSession.stats.items,"total",0),this.setDefault(window.gameSession.stats.items,"fire",0),this.setDefault(window.gameSession.stats.items,"ice",0),this.setDefault(window.gameSession.stats.items,"acid",0),this.setDefault(window.gameSession.stats.items,"electricity",0),this.setDefault(window.gameSession.stats.items,"spikes",0),this.setDefault(window.gameSession.stats.items,"poison",0),this.setDefault(window.gameSession.stats.items,"potion",0),this.setDefault(window.gameSession.stats,"kills",{}),this.setDefault(window.gameSession.stats.kills,"total",0),this.setDefault(window.gameSession.stats.kills,"melee",0),this.setDefault(window.gameSession.stats.kills,"ranged",0),this.setDefault(window.gameSession.stats.kills,"magic",0),this.setDefault(window.gameSession.stats,"traps",{}),this.setDefault(window.gameSession.stats.traps,"total",0),this.setDefault(window.gameSession.stats.traps,"fire",0),this.setDefault(window.gameSession.stats.traps,"ice",0),this.setDefault(window.gameSession.stats.traps,"acid",0),this.setDefault(window.gameSession.stats.traps,"electricity",0),this.setDefault(window.gameSession.stats.traps,"spikes",0),this.setDefault(window.gameSession.stats.traps,"poison",0),this.setDefault(window.gameSession.stats,"levelMax",0),this.setDefault(window.gameSession.stats,"xp",0),this.setDefault(window.gameSession.stats,"tiles",0),this.setDefault(window.gameSession.stats,"row",0),this.setDefault(window.gameSession,"achievements",{}),this.setDefault(window.gameSession.achievements,"unique",{}),this.setDefault(window.gameSession.achievements,"death",{}),this.setDefault(window.gameSession.achievements.death,"total",0),this.setDefault(window.gameSession.achievements.death,"fire",0),this.setDefault(window.gameSession.achievements.death,"ice",0),this.setDefault(window.gameSession.achievements.death,"acid",0),this.setDefault(window.gameSession.achievements.death,"electricity",0),this.setDefault(window.gameSession.achievements.death,"spikes",0),this.setDefault(window.gameSession.achievements.death,"poison",0),this.setDefault(window.gameSession.achievements.death,"melee",0),this.setDefault(window.gameSession.achievements.death,"ranged",0),this.setDefault(window.gameSession.achievements.death,"magic",0),this.setDefault(window.gameSession.achievements,"damage",{}),this.setDefault(window.gameSession.achievements.damage,"total",0),this.setDefault(window.gameSession.achievements.damage,"fire",0),this.setDefault(window.gameSession.achievements.damage,"ice",0),this.setDefault(window.gameSession.achievements.damage,"acid",0),this.setDefault(window.gameSession.achievements.damage,"electricity",0),this.setDefault(window.gameSession.achievements.damage,"spikes",0),this.setDefault(window.gameSession.achievements.damage,"poison",0),this.setDefault(window.gameSession.achievements.damage,"melee",0),this.setDefault(window.gameSession.achievements.damage,"ranged",0),this.setDefault(window.gameSession.achievements.damage,"magic",0),this.setDefault(window.gameSession.achievements,"items",{}),this.setDefault(window.gameSession.achievements.items,"chests",0),this.setDefault(window.gameSession.achievements.items,"total",0),this.setDefault(window.gameSession.achievements.items,"fire",0),this.setDefault(window.gameSession.achievements.items,"ice",0),this.setDefault(window.gameSession.achievements.items,"acid",0),this.setDefault(window.gameSession.achievements.items,"electricity",0),this.setDefault(window.gameSession.achievements.items,"spikes",0),this.setDefault(window.gameSession.achievements.items,"poison",0),this.setDefault(window.gameSession.achievements.items,"potion",0),this.setDefault(window.gameSession.achievements,"kills",{}),this.setDefault(window.gameSession.achievements.kills,"total",0),this.setDefault(window.gameSession.achievements.kills,"melee",0),this.setDefault(window.gameSession.achievements.kills,"ranged",0),this.setDefault(window.gameSession.achievements.kills,"magic",0),this.setDefault(window.gameSession.achievements,"traps",{}),this.setDefault(window.gameSession.achievements.traps,"total",0),this.setDefault(window.gameSession.achievements.traps,"fire",0),this.setDefault(window.gameSession.achievements.traps,"ice",0),this.setDefault(window.gameSession.achievements.traps,"acid",0),this.setDefault(window.gameSession.achievements.traps,"electricity",0),this.setDefault(window.gameSession.achievements.traps,"spikes",0),this.setDefault(window.gameSession.achievements.traps,"poison",0),this.setDefault(window.gameSession.achievements,"levelMax",0),this.setDefault(window.gameSession.achievements,"xp",0),this.setDefault(window.gameSession.achievements,"tiles",0),this.setDefault(window.gameSession.achievements,"row",0),this.setDefault(window.gameSession,"tutorial",{}),this.setDefault(window.gameSession,"skills",{}),this.transferSave(window.gameSession.skills,window.gameSession,"treasureHunter",!1),this.setDefault(window.gameSession.skills,"fireShield",0),this.setDefault(window.gameSession.skills,"iceShield",0),this.setDefault(window.gameSession.skills,"acidShield",0),this.setDefault(window.gameSession.skills,"electricityShield",0),this.setDefault(window.gameSession.skills,"spikesShield",0),this.setDefault(window.gameSession.skills,"poisonShield",0),this.setDefault(window.gameSession.skills,"totalShield",0),this.transferSave(window.gameSession.skills,window.gameSession,"trapFinder",!1),this.setDefault(window.gameSession.skills,"fireFinder",!1),this.setDefault(window.gameSession.skills,"iceFinder",!1),this.setDefault(window.gameSession.skills,"acidFinder",!1),this.setDefault(window.gameSession.skills,"electricityFinder",!1),this.setDefault(window.gameSession.skills,"spikesFinder",!1),this.setDefault(window.gameSession.skills,"poisonFinder",!1),this.transferSave(window.gameSession.skills,window.gameSession,"tracker",!1),this.setDefault(window.gameSession.skills,"meleeTracker",!1),this.setDefault(window.gameSession.skills,"rangedTracker",!1),this.setDefault(window.gameSession.skills,"magicTracker",!1),this.setDefault(window.gameSession,"job",0);var t=new Date;this.setDefault(window.gameSession,"date",{d:t.getDate(),m:t.getMonth(),y:t.getFullYear()}),window.gameSession.saveVersion=e},setDefault:function(e,t,i){e.hasOwnProperty(t)||(e[t]=i)},transferSave:function(e,t,i,n){t.hasOwnProperty(i)&&!e.hasOwnProperty(i)?e[i]=t[i]:this.setDefault(e,i,n)},loadGame:function(){window.gameSession=JSON.parse(cc.sys.localStorage.getItem("gameSession")),null==window.gameSession&&(window.gameSession={}),window.hasOwnProperty("gameSession")||(window.gameSession={})},next:function(){cc.director.loadScene("gameScene")},update:function(e){this.timer+=e,this.saveLoaded&&this.analytics.Analytics_Ready()&&(this.saveLoaded=!1,this.next()),this.timer>30&&this.saveLoaded&&(this.saveLoaded=!1,cc.log("Analytics is taking too long"),this.next())}}),cc._RF.pop()},{analytics:"analytics"}],logController:[function(e,t,i){"use strict";cc._RF.push(t,"e14cbLjOG5L8JgGJDveC/6v","logController"),cc.Class({extends:cc.Component,properties:{},onEnable:function(){},start:function(){},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))}}),cc._RF.pop()},{}],optionsController:[function(e,t,i){"use strict";cc._RF.push(t,"3375bl2gz9J5oxjq4qTHFv8","optionsController");var n=e("popupController"),s=e("hudController");cc.Class({extends:cc.Component,properties:{popupController:n,hudController:s,startLevel:cc.Label},start:function(){this.startLevel.string="Starting Level: "+window.gameSession.levelMin},levelDecrease:function(e,t){window.gameSession.levelMin-=parseInt(t),window.gameSession.levelMin<1&&(window.gameSession.levelMin=1),this.startLevel.string="Starting Level: "+window.gameSession.levelMin},levelIncrease:function(e,t){window.gameSession.levelMin+=parseInt(t),window.gameSession.levelMin>window.gameSession.levelPassage&&(window.gameSession.levelMin=window.gameSession.levelPassage),this.startLevel.string="Starting Level: "+window.gameSession.levelMin}}),cc._RF.pop()},{hudController:"hudController",popupController:"popupController"}],popupController:[function(e,t,i){"use strict";cc._RF.push(t,"8fc0eF2dINOvKOLyKcQlv9s","popupController");var n=cc.Class({extends:cc.Component,properties:{job:cc.Node,upgrade:cc.Node,inventory:cc.Node,store:cc.Node,achievement:cc.Node,options:cc.Node,tutorial:cc.Node,log:cc.Node,death:cc.Node,dailyReward:cc.Node},start:function(){},openPopup:function(e){this.closePopup(),this[e].active=!0,this.current=this[e]},openPopupByButton:function(e,t){this.openPopup(t)},openPermanentPopup:function(e){this.closePopup(),this[e].active=!0},closePopup:function(){this.hasOwnProperty("current")&&(this.current.active=!1)},closePopupByName:function(e){this[e].active=!1},closePopupByButton:function(e,t){this.closePopupByName(t)},isAnyOpen:function(){return!!this.hasOwnProperty("current")&&(this.current.active||this.job.active||this.death.active||this.dailyReward.active)}});t.exports=n,cc._RF.pop()},{}],rewardController:[function(e,t,i){"use strict";cc._RF.push(t,"6cf2bszDFtBvIkJL8O0GFNP","rewardController"),cc.Class({extends:cc.Component,properties:{reward:cc.Label},onEnable:function(){this.reward.string=window.gameGlobals.xpReward+"XP"},start:function(){},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))}}),cc._RF.pop()},{}],storeController:[function(e,t,i){"use strict";cc._RF.push(t,"596c9dTjaNMor4gIr9hgIjI","storeController");var n=e("inventoryController"),s=e("hudController"),o=e("deathController");cc.Class({extends:cc.Component,properties:{inventoryController:n,hudController:s,deathController:o,grid:cc.Node,storeButton:cc.Prefab},onEnable:function(){},start:function(){this.createButton("Fire Shield","Get as many as you can carry.",10,"fire","fillPocket"),this.createButton("Ice Shield","Get as many as you can carry.",10,"ice","fillPocket"),this.createButton("Acid Shield","Get as many as you can carry.",10,"acid","fillPocket"),this.createButton("Electricity Shield","Get as many as you can carry.",10,"electricity","fillPocket"),this.createButton("Spikes Shield","Get as many as you can carry.",10,"spikes","fillPocket"),this.createButton("Poison Shield","Get as many as you can carry.",10,"poison","fillPocket"),this.createButton("Potion","Get as many as you can carry.",50,"potion","fillPocket"),this.createButton("A Place to Rest","You can continue when fully rested.",75,"","healing")},createButton:function(e,t,i,n,s){var o=cc.instantiate(this.storeButton);o.parent=this.grid,o.getChildByName("Name").getComponent(cc.Label).string=e,o.getChildByName("Description").getComponent(cc.Label).string=t,o.getChildByName("Price").getComponent(cc.Label).string=i+" Souls",o.item=n,o.price=i,o.txt=e;var a=new cc.Component.EventHandler;a.target=this.node,a.component="storeController",a.handler=s,o.getComponent(cc.Button).clickEvents.push(a)},fillPocket:function(e){var t=e.target,i=t.item,n=t.price;window.gameSession.currency<n||(window.gameSession.currency-=n,this.hudController.updateLabel("soul",window.gameSession.currency),this.inventoryController.giveItem(i,window.gameSession.inventory[i+"Max"],t,t.txt,"Store"),this.saveGame())},healing:function(e){var t=e.target,i=(t.item,t.price);window.gameSession.currency<i||(window.gameSession.currency-=i,this.hudController.updateLabel("soul",window.gameSession.currency),this.deathController.heal(window.gameSession.hpMax),this.saveGame())},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))}}),cc._RF.pop()},{deathController:"deathController",hudController:"hudController",inventoryController:"inventoryController"}],tutorialController:[function(e,t,i){"use strict";cc._RF.push(t,"ea3e5sNQUVBsJin+etBB5Q2","tutorialController"),cc.Class({extends:cc.Component,properties:{},onEnable:function(){},start:function(){},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))}}),cc._RF.pop()},{}],upgradeController:[function(e,t,i){"use strict";cc._RF.push(t,"c4e2cji+KROBamtHwGOccSx","upgradeController");var n=cc.Class({extends:cc.Component,properties:{grid:cc.Node,canvas:cc.Node,dungeonAchievement:cc.Node,feedbackLog:cc.Node,button:cc.Prefab,feedbackPrefab:cc.Prefab,logPrefab:cc.Prefab,dungeonXP:cc.Label,inventoryFire:cc.Label,inventoryIce:cc.Label,inventoryAcid:cc.Label,inventoryElectricity:cc.Label,inventorySpikes:cc.Label,inventoryPoison:cc.Label,inventoryPotion:cc.Label,icons:[cc.SpriteFrame]},start:function(){this.setButtons()},onEnable:function(){this.checkSecretPassage(),this.checkSpecialButton(window.gameSession.stats.traps.total,window.gameSession.trapFinder,this.trapFinder),this.checkSpecialButton(window.gameSession.stats.traps.fire,window.gameSession.fireFinder,this.fireFinder),this.checkSpecialButton(window.gameSession.stats.traps.ice,window.gameSession.iceFinder,this.iceFinder),this.checkSpecialButton(window.gameSession.stats.traps.acid,window.gameSession.acidFinder,this.acidFinder),this.checkSpecialButton(window.gameSession.stats.traps.electricity,window.gameSession.electricityFinder,this.electricityFinder),this.checkSpecialButton(window.gameSession.stats.traps.spikes,window.gameSession.spikesFinder,this.spikesFinder),this.checkSpecialButton(window.gameSession.stats.traps.poison,window.gameSession.poisonFinder,this.poisonFinder),this.checkSpecialButton(window.gameSession.stats.items.chests,window.gameSession.treasureHunter,this.treasureHunter),this.checkSpecialButton(window.gameSession.stats.kills.total,window.gameSession.tracker,this.tracker),this.checkPermanentShield("fire"),this.checkPermanentShield("ice"),this.checkPermanentShield("acid"),this.checkPermanentShield("electricity"),this.checkPermanentShield("spikes"),this.checkPermanentShield("poison"),this.checkPermanentShield("total")},setButtons:function(){window.gameSession&&(this.createButton("Fire Protection","fireMin","fire","Starting amount of Fire Shields",0,1,0),this.createButton("Ice Protection","iceMin","ice","Starting amount of Ice Shields",0,1,0),this.createButton("Acid Protection","acidMin","acid","Starting amount of Acid Shields",0,1,0),this.createButton("Electricity Protection","electricityMin","electricity","Starting amount of Electricity Shields",0,1,0),this.createButton("Spikes Protection","spikesMin","spikes","Starting amount of Spikes Shields",0,1,0),this.createButton("Poison Protection","poisonMin","poison","Starting amount of Poison Shields",0,1,0),this.createButton("Fire Pocket","fireMax",null,"Maximum amount of Fire Shields",1,1,3),this.createButton("Ice Pocket","iceMax",null,"Maximum amount of Ice Shields",1,1,3),this.createButton("Acid Pocket","acidMax",null,"Maximum amount of Acid Shields",1,1,3),this.createButton("Electricity Pocket","electricityMax",null,"Maximum amount of Electricity Shields",1,1,3),this.createButton("Spikes Pocket","spikesMax",null,"Maximum amount of Spikes Shields",1,1,3),this.createButton("Poison Pocket","poisonMax",null,"Maximum amount of Poison Shields",1,1,3),this.createButton("Starting Potion","potionMin","potion","Starting amount of Potions",3,1,0),this.createButton("Potion Pocket","potionMax",null,"Maximum amount of Potions",1,1,3),this.createButton("Health Points","hpMax",null,"Increases maximum HP",2,1,3),this.createButton("Sword Skill","melee",null,"Increases skill with swords",5,2,1),this.createButton("Bow Skill","ranged",null,"Increases skill with bows",6,2,1),this.createButton("Wand Skill","magic",null,"Increases skill with wands",7,2,1),this.createSecretPassageButton(),this.checkSecretPassage(),this.createSpecialButton("trapFinder","Trap Finder","Find how many traps exist in a floor.","upgradeTrapFinder"),this.checkSpecialButton(window.gameSession.stats.traps.total,window.gameSession.trapFinder,this.trapFinder),this.createSpecialButton("fireFinder","Fire Finder","Find how many fire traps exist in a floor.","upgradeFireFinder"),this.checkSpecialButton(window.gameSession.stats.traps.fire,window.gameSession.fireFinder,this.fireFinder),this.createSpecialButton("iceFinder","Ice Finder","Find how many ice traps exist in a floor.","upgradeIceFinder"),this.checkSpecialButton(window.gameSession.stats.traps.ice,window.gameSession.iceFinder,this.iceFinder),this.createSpecialButton("acidFinder","Acid Finder","Find how many acid traps exist in a floor.","upgradeAcidFinder"),this.checkSpecialButton(window.gameSession.stats.traps.acid,window.gameSession.acidFinder,this.acidFinder),this.createSpecialButton("electricityFinder","Electricity Finder","Find how many electricity traps exist in a floor.","upgradeElectricityFinder"),this.checkSpecialButton(window.gameSession.stats.traps.electricity,window.gameSession.electricityFinder,this.electricityFinder),this.createSpecialButton("spikesFinder","Spikes Finder","Find how many spikes traps exist in a floor.","upgradeSpikesFinder"),this.checkSpecialButton(window.gameSession.stats.traps.spikes,window.gameSession.spikesFinder,this.spikesFinder),this.createSpecialButton("poisonFinder","Poison Finder","Find how many poison traps exist in a floor.","upgradePoisonFinder"),this.checkSpecialButton(window.gameSession.stats.traps.poison,window.gameSession.poisonFinder,this.poisonFinder),this.createSpecialButton("treasureHunter","Treasure Hunter","Find how many chests exist in a floor.","upgradeTreasureHunter"),this.checkSpecialButton(window.gameSession.stats.items.chests,window.gameSession.treasureHunter,this.treasureHunter),this.createSpecialButton("tracker","Tracker","Find how many enemies are in a floor.","upgradeTracker"),this.checkSpecialButton(window.gameSession.stats.kills.total,window.gameSession.tracker,this.tracker),this.createPermanentShield("Fireproof","Permanent fire shield","fire",8),this.checkPermanentShield("fire"),this.createPermanentShield("Freezeproof","Permanent ice shield","ice",8),this.checkPermanentShield("ice"),this.createPermanentShield("Non-corrosive","Permanent acid shield","acid",8),this.checkPermanentShield("acid"),this.createPermanentShield("Ground Wire","Permanent electricity shield","electricity",8),this.checkPermanentShield("electricity"),this.createPermanentShield("Impenetrable","Permanent spikes shield","spikes",8),this.checkPermanentShield("spikes"),this.createPermanentShield("Mithridatism","Permanent poison shield","poison",8),this.checkPermanentShield("poison"),this.createPermanentShield("Scavenger","Increase itens got by chest","total",9),this.checkPermanentShield("total"))},createPermanentShield:function(e,t,i,n){var s=cc.instantiate(this.button);s.parent=this.grid,s.getChildByName("Name").getComponent(cc.Label).string=e,s.getChildByName("Description").getComponent(cc.Label).string=t,s.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.skills[i+"Shield"],s.getChildByName("Price").getComponent(cc.Label).string=5e3*(window.gameSession.skills[i+"Shield"]+1)+"XP",s.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[n],s.field=i;var o=new cc.Component.EventHandler;o.target=this.node,o.component="upgradeController",o.handler="permanentShield",s.getComponent(cc.Button).clickEvents.push(o),this["perm"+i]=s},checkPermanentShield:function(e){window.gameSession.skills[e+"Shield"]<window.gameSession.achievements.items[e]&&this["perm"+e]?this["perm"+e].active=!0:this["perm"+e]&&(this["perm"+e].active=!1)},permanentShield:function(e){var t=e.target,i=t.field,n=5e3*(window.gameSession.skills[i+"Shield"]+1);window.gameSession.xp>=n&&(window.gameSession.xp-=n,window.gameSession.stats.xp+=n,window.gameSession.stats.xp%1e5==0&&this.showFeedback("Achievement: High Level",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonXP.string=window.gameSession.xp,window.gameSession.skills[i+"Shield"]++,window.analytics.Design_event("upgrade:permanentShield:"+i,window.gameSession.skills[i+"Shield"]),t.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.skills[i+"Shield"],t.getChildByName("Price").getComponent(cc.Label).string=n+5e3+"XP",this.saveGame()),this.checkPermanentShield(i)},createSpecialButton:function(e,t,i,n){var s=cc.instantiate(this.button);s.parent=this.grid,this[e]=s,s.getChildByName("Name").getComponent(cc.Label).string=t,s.getChildByName("Description").getComponent(cc.Label).string=i,s.getChildByName("Value").getComponent(cc.Label).string=0,s.getChildByName("Price").getComponent(cc.Label).string="5000XP",s.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[4];var o=new cc.Component.EventHandler;o.target=this.node,o.component="upgradeController",o.handler=n,s.getComponent(cc.Button).clickEvents.push(o)},checkSpecialButton:function(e,t,i){e>49&&!t&&i?i.active=!0:i&&(i.active=!1)},upgradeSpecial:function(e,t){var i=e.target;window.gameSession.xp>=5e3&&(window.analytics.Design_event("upgrade:special:"+t),window.gameSession.xp-=5e3,window.gameSession.stats.xp+=5e3,window.gameSession.stats.xp%1e5==0&&this.showFeedback("Achievement: High Level",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonXP.string=window.gameSession.xp,window.gameSession[t]=!0,i.getChildByName("Value").getComponent(cc.Label).string=1,i.getChildByName("Price").getComponent(cc.Label).string="5000XP",this.saveGame())},upgradeFireFinder:function(e){this.upgradeSpecial(e,"fireFinder"),this.checkSpecialButton(window.gameSession.stats.traps.fire,window.gameSession.fireFinder,this.fireFinder)},upgradeIceFinder:function(e){this.upgradeSpecial(e,"iceFinder"),this.checkSpecialButton(window.gameSession.stats.traps.ice,window.gameSession.iceFinder,this.iceFinder)},upgradeAcidFinder:function(e){this.upgradeSpecial(e,"acidFinder"),this.checkSpecialButton(window.gameSession.stats.traps.acid,window.gameSession.acidFinder,this.acidFinder)},upgradeElectricityFinder:function(e){this.upgradeSpecial(e,"electricityFinder"),this.checkSpecialButton(window.gameSession.stats.traps.electricity,window.gameSession.electricityFinder,this.electricityFinder)},upgradeSpikesFinder:function(e){this.upgradeSpecial(e,"spikesFinder"),this.checkSpecialButton(window.gameSession.stats.traps.spikes,window.gameSession.spikesFinder,this.spikesFinder)},upgradePoisonFinder:function(e){this.upgradeSpecial(e,"poisonFinder"),this.checkSpecialButton(window.gameSession.stats.traps.poison,window.gameSession.poisonFinder,this.poisonFinder)},upgradeTrapFinder:function(e){this.upgradeSpecial(e,"trapFinder"),this.checkSpecialButton(window.gameSession.stats.traps.total,window.gameSession.trapFinder,this.trapFinder)},upgradeTreasureHunter:function(e){this.upgradeSpecial(e,"treasureHunter"),this.checkSpecialButton(window.gameSession.stats.items.chests,window.gameSession.treasureHunter,this.treasureHunter)},upgradeTracker:function(e){this.upgradeSpecial(e,"tracker"),this.checkSpecialButton(window.gameSession.stats.kills.total,window.gameSession.tracker,this.tracker)},createSecretPassageButton:function(){var e=cc.instantiate(this.button);e.parent=this.grid,this.secretPassage=e,e.getChildByName("Name").getComponent(cc.Label).string="Secret Passage",e.getChildByName("Description").getComponent(cc.Label).string="The floor you start back when you die.",e.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.levelPassage,window.gameSession.upgrades.levelPassage||(window.gameSession.upgrades.levelPassage=1e3),e.getChildByName("Price").getComponent(cc.Label).string=window.gameSession.upgrades.levelPassage+"XP",e.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[4];var t=new cc.Component.EventHandler;t.target=this.node,t.component="upgradeController",t.handler="upgradeSecretPassage",e.getComponent(cc.Button).clickEvents.push(t)},checkSecretPassage:function(){window.gameSession.levelPassage+5<window.gameSession.stats.levelMax&&this.secretPassage?this.secretPassage.active=!0:this.secretPassage&&(this.secretPassage.active=!1)},upgradeSecretPassage:function(e){var t=e.target;window.gameSession.xp>=window.gameSession.upgrades.levelPassage&&(window.gameSession.xp-=window.gameSession.upgrades.levelPassage,window.gameSession.stats.xp+=window.gameSession.upgrades.levelPassage,window.gameSession.stats.xp%1e5==0&&this.showFeedback("Achievement: High Level",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonXP.string=window.gameSession.xp,1==window.gameSession.levelPassage?window.gameSession.levelPassage=5:window.gameSession.levelPassage+=5,window.gameSession.levelMin=window.gameSession.levelPassage,window.analytics.Design_event("upgrade:special:secretPassage",window.gameSession.levelPassage),t.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.levelPassage,window.gameSession.upgrades.levelPassage+=1e3,t.getChildByName("Price").getComponent(cc.Label).string=window.gameSession.upgrades.levelPassage+"XP",this.saveGame()),this.checkSecretPassage()},createButton:function(e,t,i,n,s,o,a){var r=cc.instantiate(this.button);r.parent=this.grid,r.getChildByName("Name").getComponent(cc.Label).string=e,r.getChildByName("Description").getComponent(cc.Label).string=n;var d=void 0;null!=window.gameSession.inventory[t]?(r.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.inventory[t],d=window.gameSession.inventory[t]+1):(r.getChildByName("Value").getComponent(cc.Label).string=window.gameSession[t],d=window.gameSession[t]+1),d-=a,window.gameSession.upgrades[t]=1e3*d*o,r.getChildByName("Price").getComponent(cc.Label).string=window.gameSession.upgrades[t]+"XP",r.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[s],r.field=t,r.item=i,r.mult=o,r.start=a;var c=new cc.Component.EventHandler;c.target=this.node,c.component="upgradeController",c.handler="upgrade",r.getComponent(cc.Button).clickEvents.push(c)},upgrade:function(e){var t=e.target,i=t.field;if(window.gameSession.xp>=window.gameSession.upgrades[i]){window.gameSession.xp-=window.gameSession.upgrades[i],window.gameSession.stats.xp+=window.gameSession.upgrades[i],window.gameSession.stats.xp%1e5==0&&this.showFeedback("Achievement: High Level",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonXP.string=window.gameSession.xp;var n=void 0;null!=window.gameSession.inventory[i]?(window.gameSession.inventory[i]+=1,window.analytics.Design_event("upgrade:common:inventory:"+i,window.gameSession.inventory[i]),n=window.gameSession.inventory[i]+1,t.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.inventory[i],t.item&&this.giveItem(t.item)):(window.gameSession[i]+=1,window.analytics.Design_event("upgrade:common:"+i,window.gameSession[i]),n=window.gameSession[i]+1,t.getChildByName("Value").getComponent(cc.Label).string=window.gameSession[i]),n-=t.start,window.gameSession.upgrades[i]=1e3*n*t.mult,t.getChildByName("Price").getComponent(cc.Label).string=window.gameSession.upgrades[i]+"XP",this.saveGame()}},giveItem:function(e){window.gameSession.inventory[e]+1<=window.gameSession.inventory[e+"Max"]&&window.gameSession.inventory[e]++},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},showFeedback:function(e,t,i,n){var s=cc.instantiate(this.feedbackPrefab);s.parent=this.canvas,s.color=t;var o=i.parent.convertToWorldSpaceAR(i.position);o=this.canvas.convertToNodeSpaceAR(o),s.x=o.x,s.y=o.y,s.getComponent(cc.Label).string=e;var a=void 0;a=n?cc.sequence(cc.moveBy(2,cc.v2(0,100)),cc.fadeOut(2),cc.callFunc(this.removeFeedback,this,s)):cc.sequence(cc.spawn(cc.moveBy(2,cc.v2(0,100)),cc.fadeOut(2)),cc.callFunc(this.removeFeedback,this,s)),s.runAction(a);var r=cc.instantiate(this.logPrefab);r.parent=this.feedbackLog,r.getComponent(cc.Label).string=e,r.color=t},removeFeedback:function(e){e.destroy()}});t.exports=n,cc._RF.pop()},{}]},{},["analytics","achievementController","deathController","feedbackController","hudController","inventoryController","jobController","logController","optionsController","popupController","rewardController","storeController","tutorialController","upgradeController","gridController","loadAnimation","loadingController"]);