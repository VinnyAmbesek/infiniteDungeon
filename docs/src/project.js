require=function o(a,r,d){function c(i,e){if(!r[i]){if(!a[i]){var n="function"==typeof require&&require;if(!e&&n)return n(i,!0);if(l)return l(i,!0);var t=new Error("Cannot find module '"+i+"'");throw t.code="MODULE_NOT_FOUND",t}var s=r[i]={exports:{}};a[i][0].call(s.exports,function(e){return c(a[i][1][e]||e)},s,s.exports,o,a,r,d)}return r[i].exports}for(var l="function"==typeof require&&require,e=0;e<d.length;e++)c(d[e]);return c}({1:[function(e,i,n){"use strict";var t,c,s,d,o,a,r,l,u,m,g,h,p=p||function(r,e){var i={},n=i.lib={},t=function(){},s=n.Base={extend:function(e){t.prototype=this;var i=new t;return e&&i.mixIn(e),i.hasOwnProperty("init")||(i.init=function(){i.$super.init.apply(this,arguments)}),(i.init.prototype=i).$super=this,i},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},d=n.WordArray=s.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=null!=i?i:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var i=this.words,n=e.words,t=this.sigBytes;if(e=e.sigBytes,this.clamp(),t%4)for(var s=0;s<e;s++)i[t+s>>>2]|=(n[s>>>2]>>>24-s%4*8&255)<<24-(t+s)%4*8;else if(65535<n.length)for(s=0;s<e;s+=4)i[t+s>>>2]=n[s>>>2];else i.push.apply(i,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=r.ceil(i/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var i=[],n=0;n<e;n+=4)i.push(4294967296*r.random()|0);return new d.init(i,e)}}),o=i.enc={},a=o.Hex={stringify:function(e){var i=e.words;e=e.sigBytes;for(var n=[],t=0;t<e;t++){var s=i[t>>>2]>>>24-t%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var i=e.length,n=[],t=0;t<i;t+=2)n[t>>>3]|=parseInt(e.substr(t,2),16)<<24-t%8*4;return new d.init(n,i/2)}},c=o.Latin1={stringify:function(e){var i=e.words;e=e.sigBytes;for(var n=[],t=0;t<e;t++)n.push(String.fromCharCode(i[t>>>2]>>>24-t%4*8&255));return n.join("")},parse:function(e){for(var i=e.length,n=[],t=0;t<i;t++)n[t>>>2]|=(255&e.charCodeAt(t))<<24-t%4*8;return new d.init(n,i)}},l=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var i=this._data,n=i.words,t=i.sigBytes,s=this.blockSize,o=t/(4*s);if(e=(o=e?r.ceil(o):r.max((0|o)-this._minBufferSize,0))*s,t=r.min(4*e,t),e){for(var a=0;a<e;a+=s)this._doProcessBlock(n,a);a=n.splice(0,e),i.sigBytes-=t}return new d.init(a,t)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=u.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,i){return new n.init(i).finalize(e)}},_createHmacHelper:function(n){return function(e,i){return new m.HMAC.init(n,i).finalize(e)}}});var m=i.algo={};return i}(Math);(function(s){for(var e=p,i=(t=e.lib).WordArray,n=t.Hasher,t=e.algo,o=[],h=[],a=function(e){return 4294967296*(e-(0|e))|0},r=2,d=0;d<64;){var c;e:{c=r;for(var l=s.sqrt(c),u=2;u<=l;u++)if(!(c%u)){c=!1;break e}c=!0}c&&(d<8&&(o[d]=a(s.pow(r,.5))),h[d]=a(s.pow(r,1/3)),d++),r++}var w=[];t=t.SHA256=n.extend({_doReset:function(){this._hash=new i.init(o.slice(0))},_doProcessBlock:function(e,i){for(var n=this._hash.words,t=n[0],s=n[1],o=n[2],a=n[3],r=n[4],d=n[5],c=n[6],l=n[7],u=0;u<64;u++){if(u<16)w[u]=0|e[i+u];else{var m=w[u-15],g=w[u-2];w[u]=((m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3)+w[u-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+w[u-16]}m=l+((r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25))+(r&d^~r&c)+h[u]+w[u],g=((t<<30|t>>>2)^(t<<19|t>>>13)^(t<<10|t>>>22))+(t&s^t&o^s&o),l=c,c=d,d=r,r=a+m|0,a=o,o=s,s=t,t=m+g|0}n[0]=n[0]+t|0,n[1]=n[1]+s|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+r|0,n[5]=n[5]+d|0,n[6]=n[6]+c|0,n[7]=n[7]+l|0},_doFinalize:function(){var e=this._data,i=e.words,n=8*this._nDataBytes,t=8*e.sigBytes;return i[t>>>5]|=128<<24-t%32,i[14+(t+64>>>9<<4)]=s.floor(n/4294967296),i[15+(t+64>>>9<<4)]=n,e.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA256=n._createHelper(t),e.HmacSHA256=n._createHmacHelper(t)})(Math),c=(t=p).enc.Utf8,t.algo.HMAC=t.lib.Base.extend({init:function(e,i){e=this._hasher=new e.init,"string"==typeof i&&(i=c.parse(i));var n=e.blockSize,t=4*n;i.sigBytes>t&&(i=e.finalize(i)),i.clamp();for(var s=this._oKey=i.clone(),o=this._iKey=i.clone(),a=s.words,r=o.words,d=0;d<n;d++)a[d]^=1549556828,r[d]^=909522486;s.sigBytes=o.sigBytes=t,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var i=this._hasher;return e=i.finalize(e),i.reset(),i.finalize(this._oKey.clone().concat(e))}}),d=(s=p).lib.WordArray,s.enc.Base64={stringify:function(e){var i=e.words,n=e.sigBytes,t=this._map;e.clamp(),e=[];for(var s=0;s<n;s+=3)for(var o=(i[s>>>2]>>>24-s%4*8&255)<<16|(i[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|i[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<n;a++)e.push(t.charAt(o>>>6*(3-a)&63));if(i=t.charAt(64))for(;e.length%4;)e.push(i);return e.join("")},parse:function(e){var i=e.length,n=this._map;(t=n.charAt(64))&&-1!=(t=e.indexOf(t))&&(i=t);for(var t=[],s=0,o=0;o<i;o++)if(o%4){var a=n.indexOf(e.charAt(o-1))<<o%4*2,r=n.indexOf(e.charAt(o))>>>6-o%4*2;t[s>>>2]|=(a|r)<<24-s%4*8,s++}return d.create(t,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o=Ce||(Ce={}),(a=o.EGAErrorSeverity||(o.EGAErrorSeverity={}))[a.Undefined=0]="Undefined",a[a.Debug=1]="Debug",a[a.Info=2]="Info",a[a.Warning=3]="Warning",a[a.Error=4]="Error",a[a.Critical=5]="Critical",(r=o.EGAGender||(o.EGAGender={}))[r.Undefined=0]="Undefined",r[r.Male=1]="Male",r[r.Female=2]="Female",(l=o.EGAProgressionStatus||(o.EGAProgressionStatus={}))[l.Undefined=0]="Undefined",l[l.Start=1]="Start",l[l.Complete=2]="Complete",l[l.Fail=3]="Fail",(u=o.EGAResourceFlowType||(o.EGAResourceFlowType={}))[u.Undefined=0]="Undefined",u[u.Source=1]="Source",u[u.Sink=2]="Sink",m=o.http||(o.http={}),(g=m.EGASdkErrorType||(m.EGASdkErrorType={}))[g.Undefined=0]="Undefined",g[g.Rejected=1]="Rejected",(h=m.EGAHTTPApiResponse||(m.EGAHTTPApiResponse={}))[h.NoResponse=0]="NoResponse",h[h.BadResponse=1]="BadResponse",h[h.RequestTimeout=2]="RequestTimeout",h[h.JsonEncodeFailed=3]="JsonEncodeFailed",h[h.JsonDecodeFailed=4]="JsonDecodeFailed",h[h.InternalServerError=5]="InternalServerError",h[h.BadRequest=6]="BadRequest",h[h.Unauthorized=7]="Unauthorized",h[h.UnknownResponseCode=8]="UnknownResponseCode",h[h.Ok=9]="Ok";var w,S,v,f,y,b,k,C,A,E,T,F,B,M,G,P,I,x,D,_,R,N,L,O,V,z,H,q,K,U,j,J,Q,X,W,Y,Z,$,ee,ie,ne,te,se,oe,ae,re,de,ce,le,ue,me,ge,he,we,pe,Se,ve,fe,ye,be,ke,Ce,Ae,Ee,Te,Fe,Be,Me,Ge,Pe,Ie,xe,De,_e;Ce.EGAErrorSeverity,Ce.EGAGender,Ce.EGAProgressionStatus,Ce.EGAResourceFlowType;(function(e){var t,i;(i=t||(t={}))[i.Error=0]="Error",i[i.Warning=1]="Warning",i[i.Info=2]="Info",i[i.Debug=3]="Debug";var n=function(){function n(){n.debugEnabled=!1}return n.setInfoLog=function(e){n.instance.infoLogEnabled=e},n.setVerboseLog=function(e){n.instance.infoLogVerboseEnabled=e},n.i=function(e){if(n.instance.infoLogEnabled){var i="Info/"+n.Tag+": "+e;n.instance.sendNotificationMessage(i,t.Info)}},n.w=function(e){var i="Warning/"+n.Tag+": "+e;n.instance.sendNotificationMessage(i,t.Warning)},n.e=function(e){var i="Error/"+n.Tag+": "+e;n.instance.sendNotificationMessage(i,t.Error)},n.ii=function(e){if(n.instance.infoLogVerboseEnabled){var i="Verbose/"+n.Tag+": "+e;n.instance.sendNotificationMessage(i,t.Info)}},n.d=function(e){if(n.debugEnabled){var i="Debug/"+n.Tag+": "+e;n.instance.sendNotificationMessage(i,t.Debug)}},n.prototype.sendNotificationMessage=function(e,i){switch(i){case t.Error:console.error(e);break;case t.Warning:console.warn(e);break;case t.Debug:"function"==typeof console.debug?console.debug(e):console.log(e);break;case t.Info:console.log(e)}},n.instance=new n,n.Tag="GameAnalytics",n}();e.GALogger=n})((w=Ce||(Ce={})).logging||(w.logging={})),S=Ce||(Ce={}),v=S.utilities||(S.utilities={}),f=S.logging.GALogger,y=function(){function l(){}return l.getHmac=function(e,i){var n=p.HmacSHA256(i,e);return p.enc.Base64.stringify(n)},l.stringMatch=function(e,i){return!(!e||!i)&&i.test(e)},l.joinStringArray=function(e,i){for(var n="",t=0,s=e.length;t<s;t++)0<t&&(n+=i),n+=e[t];return n},l.stringArrayContainsString=function(e,i){if(0===e.length)return!1;for(var n in e)if(e[n]===i)return!0;return!1},l.encode64=function(e){e=encodeURI(e);for(var i,n,t,s,o,a="",r=0,d=0,c=0;t=(i=e.charCodeAt(c++))>>2,s=(3&i)<<4|(n=e.charCodeAt(c++))>>4,o=(15&n)<<2|(r=e.charCodeAt(c++))>>6,d=63&r,isNaN(n)?o=d=64:isNaN(r)&&(d=64),a=a+l.keyStr.charAt(t)+l.keyStr.charAt(s)+l.keyStr.charAt(o)+l.keyStr.charAt(d),i=n=r=0,t=s=o=d=0,c<e.length;);return a},l.decode64=function(e){var i,n,t,s,o="",a=0,r=0,d=0;for(/[^A-Za-z0-9\+\/\=]/g.exec(e)&&f.w("There were invalid base64 characters in the input text. Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='. Expect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");i=l.keyStr.indexOf(e.charAt(d++))<<2|(t=l.keyStr.indexOf(e.charAt(d++)))>>4,n=(15&t)<<4|(s=l.keyStr.indexOf(e.charAt(d++)))>>2,a=(3&s)<<6|(r=l.keyStr.indexOf(e.charAt(d++))),o+=String.fromCharCode(i),64!=s&&(o+=String.fromCharCode(n)),64!=r&&(o+=String.fromCharCode(a)),i=n=a=0,t=s=r=0,d<e.length;);return decodeURI(o)},l.timeIntervalSince1970=function(){var e=new Date;return Math.round(e.getTime()/1e3)},l.createGuid=function(){return(l.s4()+l.s4()+"-"+l.s4()+"-4"+l.s4().substr(0,3)+"-"+l.s4()+"-"+l.s4()+l.s4()+l.s4()).toLowerCase()},l.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},l.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l}(),v.GAUtilities=y,b=Ce||(Ce={}),k=b.validators||(b.validators={}),C=b.logging.GALogger,A=b.http.EGASdkErrorType,E=b.utilities.GAUtilities,T=function(){function r(){}return r.validateBusinessEvent=function(e,i,n,t,s){return r.validateCurrency(e)?i<0?(C.w("Validation fail - business event - amount. Cannot be less than 0. Failed amount: "+i),!1):r.validateShortString(n,!0)?r.validateEventPartLength(t,!1)?r.validateEventPartCharacters(t)?r.validateEventPartLength(s,!1)?!!r.validateEventPartCharacters(s)||(C.w("Validation fail - business event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+s),!1):(C.w("Validation fail - business event - itemId. Cannot be (null), empty or above 64 characters. String: "+s),!1):(C.w("Validation fail - business event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+t),!1):(C.w("Validation fail - business event - itemType: Cannot be (null), empty or above 64 characters. String: "+t),!1):(C.w("Validation fail - business event - cartType. Cannot be above 32 length. String: "+n),!1):(C.w("Validation fail - business event - currency: Cannot be (null) and need to be A-Z, 3 characters and in the standard at openexchangerates.org. Failed currency: "+e),!1)},r.validateResourceEvent=function(e,i,n,t,s,o,a){return e==b.EGAResourceFlowType.Undefined?(C.w("Validation fail - resource event - flowType: Invalid flow type."),!1):i?E.stringArrayContainsString(o,i)?0<n?t?r.validateEventPartLength(t,!1)?r.validateEventPartCharacters(t)?E.stringArrayContainsString(a,t)?r.validateEventPartLength(s,!1)?!!r.validateEventPartCharacters(s)||(C.w("Validation fail - resource event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+s),!1):(C.w("Validation fail - resource event - itemId: Cannot be (null), empty or above 64 characters. String: "+s),!1):(C.w("Validation fail - resource event - itemType: Not found in list of pre-defined available resource itemTypes. String: "+t),!1):(C.w("Validation fail - resource event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+t),!1):(C.w("Validation fail - resource event - itemType: Cannot be (null), empty or above 64 characters. String: "+t),!1):(C.w("Validation fail - resource event - itemType: Cannot be (null)"),!1):(C.w("Validation fail - resource event - amount: Float amount cannot be 0 or negative. Value: "+n),!1):(C.w("Validation fail - resource event - currency: Not found in list of pre-defined available resource currencies. String: "+i),!1):(C.w("Validation fail - resource event - currency: Cannot be (null)"),!1)},r.validateProgressionEvent=function(e,i,n,t){if(e==b.EGAProgressionStatus.Undefined)return C.w("Validation fail - progression event: Invalid progression status."),!1;if(t&&!n&&i)return C.w("Validation fail - progression event: 03 found but 01+02 are invalid. Progression must be set as either 01, 01+02 or 01+02+03."),!1;if(n&&!i)return C.w("Validation fail - progression event: 02 found but not 01. Progression must be set as either 01, 01+02 or 01+02+03"),!1;if(!i)return C.w("Validation fail - progression event: progression01 not valid. Progressions must be set as either 01, 01+02 or 01+02+03"),!1;if(!r.validateEventPartLength(i,!1))return C.w("Validation fail - progression event - progression01: Cannot be (null), empty or above 64 characters. String: "+i),!1;if(!r.validateEventPartCharacters(i))return C.w("Validation fail - progression event - progression01: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+i),!1;if(n){if(!r.validateEventPartLength(n,!0))return C.w("Validation fail - progression event - progression02: Cannot be empty or above 64 characters. String: "+n),!1;if(!r.validateEventPartCharacters(n))return C.w("Validation fail - progression event - progression02: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+n),!1}if(t){if(!r.validateEventPartLength(t,!0))return C.w("Validation fail - progression event - progression03: Cannot be empty or above 64 characters. String: "+t),!1;if(!r.validateEventPartCharacters(t))return C.w("Validation fail - progression event - progression03: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+t),!1}return!0},r.validateDesignEvent=function(e,i){return r.validateEventIdLength(e)?!!r.validateEventIdCharacters(e)||(C.w("Validation fail - design event - eventId: Non valid characters. Only allowed A-z, 0-9, -_., ()!?. String: "+e),!1):(C.w("Validation fail - design event - eventId: Cannot be (null) or empty. Only 5 event parts allowed seperated by :. Each part need to be 32 characters or less. String: "+e),!1)},r.validateErrorEvent=function(e,i){return e==b.EGAErrorSeverity.Undefined?(C.w("Validation fail - error event - severity: Severity was unsupported value."),!1):!!r.validateLongString(i,!0)||(C.w("Validation fail - error event - message: Message cannot be above 8192 characters."),!1)},r.validateSdkErrorEvent=function(e,i,n){return!(!r.validateKeys(e,i)||n===A.Undefined&&(C.w("Validation fail - sdk error event - type: Type was unsupported value."),1))},r.validateKeys=function(e,i){return!(!E.stringMatch(e,/^[A-z0-9]{32}$/)||!E.stringMatch(i,/^[A-z0-9]{40}$/))},r.validateCurrency=function(e){return!!e&&!!E.stringMatch(e,/^[A-Z]{3}$/)},r.validateEventPartLength=function(e,i){return!(!i||e)||!!e&&!(64<e.length)},r.validateEventPartCharacters=function(e){return!!E.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}$/)},r.validateEventIdLength=function(e){return!!e&&!!E.stringMatch(e,/^[^:]{1,64}(?::[^:]{1,64}){0,4}$/)},r.validateEventIdCharacters=function(e){return!!e&&!!E.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}(:[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}){0,4}$/)},r.validateAndCleanInitRequestResponse=function(i){if(null==i)return C.w("validateInitRequestResponse failed - no response dictionary."),null;var e={};try{e.enabled=i.enabled}catch(e){return C.w("validateInitRequestResponse failed - invalid type in 'enabled' field."),null}try{var n=i.server_ts;if(!(0<n))return C.w("validateInitRequestResponse failed - invalid value in 'server_ts' field."),null;e.server_ts=n}catch(e){return C.w("validateInitRequestResponse failed - invalid type in 'server_ts' field. type="+typeof i.server_ts+", value="+i.server_ts+", "+e),null}try{var t=i.configurations;e.configurations=t}catch(e){return C.w("validateInitRequestResponse failed - invalid type in 'configurations' field. type="+typeof i.configurations+", value="+i.configurations+", "+e),null}return e},r.validateBuild=function(e){return!!r.validateShortString(e,!1)},r.validateSdkWrapperVersion=function(e){return!!E.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/)},r.validateEngineVersion=function(e){return!(!e||!E.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/))},r.validateUserId=function(e){return!!r.validateString(e,!1)||(C.w("Validation fail - user id: id cannot be (null), empty or above 64 characters."),!1)},r.validateShortString=function(e,i){return!(!i||e)||!(!e||32<e.length)},r.validateString=function(e,i){return!(!i||e)||!(!e||64<e.length)},r.validateLongString=function(e,i){return!(!i||e)||!(!e||8192<e.length)},r.validateConnectionType=function(e){return E.stringMatch(e,/^(wwan|wifi|lan|offline)$/)},r.validateCustomDimensions=function(e){return r.validateArrayOfStrings(20,32,!1,"custom dimensions",e)},r.validateResourceCurrencies=function(e){if(!r.validateArrayOfStrings(20,64,!1,"resource currencies",e))return!1;for(var i=0;i<e.length;++i)if(!E.stringMatch(e[i],/^[A-Za-z]+$/))return C.w("resource currencies validation failed: a resource currency can only be A-Z, a-z. String was: "+e[i]),!1;return!0},r.validateResourceItemTypes=function(e){if(!r.validateArrayOfStrings(20,32,!1,"resource item types",e))return!1;for(var i=0;i<e.length;++i)if(!r.validateEventPartCharacters(e[i]))return C.w("resource item types validation failed: a resource item type cannot contain other characters than A-z, 0-9, -_., ()!?. String was: "+e[i]),!1;return!0},r.validateDimension01=function(e,i){return!e||!!E.stringArrayContainsString(i,e)},r.validateDimension02=function(e,i){return!e||!!E.stringArrayContainsString(i,e)},r.validateDimension03=function(e,i){return!e||!!E.stringArrayContainsString(i,e)},r.validateArrayOfStrings=function(e,i,n,t,s){var o=t;if(o||(o="Array"),!s)return C.w(o+" validation failed: array cannot be null. "),!1;if(0==n&&0==s.length)return C.w(o+" validation failed: array cannot be empty. "),!1;if(0<e&&s.length>e)return C.w(o+" validation failed: array cannot exceed "+e+" values. It has "+s.length+" values."),!1;for(var a=0;a<s.length;++a){var r=s[a]?s[a].length:0;if(0===r)return C.w(o+" validation failed: contained an empty string. Array="+JSON.stringify(s)),!1;if(0<i&&i<r)return C.w(o+" validation failed: a string exceeded max allowed length (which is: "+i+"). String was: "+s[a]),!1}return!0},r.validateFacebookId=function(e){return!!r.validateString(e,!1)||(C.w("Validation fail - facebook id: id cannot be (null), empty or above 64 characters."),!1)},r.validateGender=function(e){if(isNaN(Number(b.EGAGender[e]))){if(e==b.EGAGender.Undefined||e!=b.EGAGender.Male&&e!=b.EGAGender.Female)return C.w("Validation fail - gender: Has to be 'male' or 'female'. Was: "+e),!1}else if(e==b.EGAGender[b.EGAGender.Undefined]||e!=b.EGAGender[b.EGAGender.Male]&&e!=b.EGAGender[b.EGAGender.Female])return C.w("Validation fail - gender: Has to be 'male' or 'female'. Was: "+e),!1;return!0},r.validateBirthyear=function(e){return!(e<0||9999<e)||(C.w("Validation fail - birthYear: Cannot be (null) or invalid range."),!1)},r.validateClientTs=function(e){return!(e<-4294967294||4294967294<e)},r}(),k.GAValidator=T,function(e){var i=function(e,i,n){this.name=e,this.value=i,this.version=n};e.NameValueVersion=i;var l=function(e,i){this.name=e,this.version=i};e.NameVersion=l;var n=function(){function s(){}return s.touch=function(){},s.getRelevantSdkVersion=function(){return s.sdkGameEngineVersion?s.sdkGameEngineVersion:s.sdkWrapperVersion},s.getConnectionType=function(){return s.connectionType},s.updateConnectionType=function(){s.connectionType=navigator.onLine?"ios"===s.buildPlatform||"android"===s.buildPlatform?"wwan":"lan":"offline"},s.getOSVersionString=function(){return s.buildPlatform+" "+s.osVersionPair.version},s.runtimePlatformToString=function(){return s.osVersionPair.name},s.getBrowserVersionString=function(){var e,i=navigator.userAgent,n=i.match(/(opera|chrome|safari|firefox|ubrowser|msie|trident|fbav(?=\/))\/?\s*(\d+)/i)||[];if(0==n.length&&"ios"===s.buildPlatform)return"webkit_"+s.osVersion;if(/trident/i.test(n[1]))return"IE "+((e=/\brv[ :]+(\d+)/g.exec(i)||[])[1]||"");if("Chrome"===n[1]&&null!=(e=i.match(/\b(OPR|Edge|UBrowser)\/(\d+)/)))return e.slice(1).join(" ").replace("OPR","Opera").replace("UBrowser","UC").toLowerCase();if(n[1]&&"fbav"===n[1].toLowerCase()&&(n[1]="facebook",n[2]))return"facebook "+n[2];var t=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!=(e=i.match(/version\/(\d+)/i))&&t.splice(1,1,e[1]),t.join(" ").toLowerCase()},s.getDeviceModel=function(){return"unknown"},s.getDeviceManufacturer=function(){return"unknown"},s.matchItem=function(e,i){var n,t,s,o,a=new l("unknown","0.0.0"),r=0,d=0;for(r=0;r<i.length;r+=1)if(new RegExp(i[r].value,"i").test(e)){if(n=new RegExp(i[r].version+"[- /:;]([\\d._]+)","i"),o="",(t=e.match(n))&&t[1]&&(s=t[1]),s){var c=s.split(/[._]+/);for(d=0;d<Math.min(c.length,3);d+=1)o+=c[d]+(d<Math.min(c.length,3)-1?".":"")}else o="0.0.0";return a.name=i[r].name,a.version=o,a}return a},s.sdkWrapperVersion="javascript 3.1.2",s.osVersionPair=s.matchItem([navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor].join(" "),[new i("windows_phone","Windows Phone","OS"),new i("windows","Win","NT"),new i("ios","iPhone","OS"),new i("ios","iPad","OS"),new i("ios","iPod","OS"),new i("android","Android","Android"),new i("blackBerry","BlackBerry","/"),new i("mac_osx","Mac","OS X"),new i("tizen","Tizen","Tizen"),new i("linux","Linux","rv")]),s.buildPlatform=s.runtimePlatformToString(),s.deviceModel=s.getDeviceModel(),s.deviceManufacturer=s.getDeviceManufacturer(),s.osVersion=s.getOSVersionString(),s.browserVersion=s.getBrowserVersionString(),s.maxSafeInteger=Math.pow(2,53)-1,s}();e.GADevice=n}((F=Ce||(Ce={})).device||(F.device={})),B=Ce||(Ce={}),M=B.threading||(B.threading={}),G=function(){function i(e){this.deadline=e,this.ignore=!1,this.async=!1,this.running=!1,this.id=++i.idCounter}return i.idCounter=0,i}(),M.TimedBlock=G,P=Ce||(Ce={}),I=P.threading||(P.threading={}),x=function(){function e(e){this.comparer=e,this._subQueues={},this._sortedKeys=[]}return e.prototype.enqueue=function(e,i){-1===this._sortedKeys.indexOf(e)&&this.addQueueOfPriority(e),this._subQueues[e].push(i)},e.prototype.addQueueOfPriority=function(e){var n=this;this._sortedKeys.push(e),this._sortedKeys.sort(function(e,i){return n.comparer.compare(e,i)}),this._subQueues[e]=[]},e.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},e.prototype.hasItems=function(){return 0<this._sortedKeys.length},e.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},e.prototype.dequeueFromHighPriorityQueue=function(){var e=this._sortedKeys[0],i=this._subQueues[e].shift();return 0===this._subQueues[e].length&&(this._sortedKeys.shift(),delete this._subQueues[e]),i},e}(),I.PriorityQueue=x,function(e){var m,i,n,t,s=D.logging.GALogger;(i=m=e.EGAStoreArgsOperator||(e.EGAStoreArgsOperator={}))[i.Equal=0]="Equal",i[i.LessOrEqual=1]="LessOrEqual",i[i.NotEqual=2]="NotEqual",(t=n=e.EGAStore||(e.EGAStore={}))[t.Events=0]="Events",t[t.Sessions=1]="Sessions",t[t.Progression=2]="Progression";var o=function(){function u(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"==typeof localStorage?(localStorage.setItem("testingLocalStorage","yes"),localStorage.removeItem("testingLocalStorage"),u.storageAvailable=!0):u.storageAvailable=!1}catch(e){}}return u.isStorageAvailable=function(){return u.storageAvailable},u.isStoreTooLargeForEvents=function(){return u.instance.eventsStore.length+u.instance.sessionsStore.length>u.MaxNumberOfEntries},u.select=function(e,i,n,t){void 0===i&&(i=[]),void 0===n&&(n=!1),void 0===t&&(t=0);var s=u.getStore(e);if(!s)return null;for(var o=[],a=0;a<s.length;++a){for(var r=s[a],d=!0,c=0;c<i.length;++c){var l=i[c];if(r[l[0]])switch(l[1]){case m.Equal:d=r[l[0]]==l[2];break;case m.LessOrEqual:d=r[l[0]]<=l[2];break;case m.NotEqual:d=r[l[0]]!=l[2];break;default:d=!1}else d=!1;if(!d)break}d&&o.push(r)}return n&&o.sort(function(e,i){return e.client_ts-i.client_ts}),0<t&&o.length>t&&(o=o.slice(0,t+1)),o},u.update=function(e,i,n){void 0===n&&(n=[]);var t=u.getStore(e);if(!t)return!1;for(var s=0;s<t.length;++s){for(var o=t[s],a=!0,r=0;r<n.length;++r){var d=n[r];if(o[d[0]])switch(d[1]){case m.Equal:a=o[d[0]]==d[2];break;case m.LessOrEqual:a=o[d[0]]<=d[2];break;case m.NotEqual:a=o[d[0]]!=d[2];break;default:a=!1}else a=!1;if(!a)break}if(a)for(r=0;r<i.length;++r){var c=i[r];o[c[0]]=c[1]}}return!0},u.delete=function(e,i){var n=u.getStore(e);if(n)for(var t=0;t<n.length;++t){for(var s=n[t],o=!0,a=0;a<i.length;++a){var r=i[a];if(s[r[0]])switch(r[1]){case m.Equal:o=s[r[0]]==r[2];break;case m.LessOrEqual:o=s[r[0]]<=r[2];break;case m.NotEqual:o=s[r[0]]!=r[2];break;default:o=!1}else o=!1;if(!o)break}o&&(n.splice(t,1),--t)}},u.insert=function(e,i,n,t){void 0===n&&(n=!1),void 0===t&&(t=null);var s=u.getStore(e);if(s)if(n){if(!t)return;for(var o=!1,a=0;a<s.length;++a){var r=s[a];if(r[t]==i[t]){for(var d in i)r[d]=i[d];o=!0;break}}o||s.push(i)}else s.push(i)},u.save=function(){u.isStorageAvailable()?(localStorage.setItem(u.KeyPrefix+u.EventsStoreKey,JSON.stringify(u.instance.eventsStore)),localStorage.setItem(u.KeyPrefix+u.SessionsStoreKey,JSON.stringify(u.instance.sessionsStore)),localStorage.setItem(u.KeyPrefix+u.ProgressionStoreKey,JSON.stringify(u.instance.progressionStore)),localStorage.setItem(u.KeyPrefix+u.ItemsStoreKey,JSON.stringify(u.instance.storeItems))):s.w("Storage is not available, cannot save.")},u.load=function(){if(u.isStorageAvailable()){try{u.instance.eventsStore=JSON.parse(localStorage.getItem(u.KeyPrefix+u.EventsStoreKey)),u.instance.eventsStore||(u.instance.eventsStore=[])}catch(e){s.w("Load failed for 'events' store. Using empty store."),u.instance.eventsStore=[]}try{u.instance.sessionsStore=JSON.parse(localStorage.getItem(u.KeyPrefix+u.SessionsStoreKey)),u.instance.sessionsStore||(u.instance.sessionsStore=[])}catch(e){s.w("Load failed for 'sessions' store. Using empty store."),u.instance.sessionsStore=[]}try{u.instance.progressionStore=JSON.parse(localStorage.getItem(u.KeyPrefix+u.ProgressionStoreKey)),u.instance.progressionStore||(u.instance.progressionStore=[])}catch(e){s.w("Load failed for 'progression' store. Using empty store."),u.instance.progressionStore=[]}try{u.instance.storeItems=JSON.parse(localStorage.getItem(u.KeyPrefix+u.ItemsStoreKey)),u.instance.storeItems||(u.instance.storeItems={})}catch(e){s.w("Load failed for 'items' store. Using empty store."),u.instance.progressionStore=[]}}else s.w("Storage is not available, cannot load.")},u.setItem=function(e,i){var n=u.KeyPrefix+e;i?u.instance.storeItems[n]=i:n in u.instance.storeItems&&delete u.instance.storeItems[n]},u.getItem=function(e){var i=u.KeyPrefix+e;return i in u.instance.storeItems?u.instance.storeItems[i]:null},u.getStore=function(e){switch(e){case n.Events:return u.instance.eventsStore;case n.Sessions:return u.instance.sessionsStore;case n.Progression:return u.instance.progressionStore;default:return s.w("GAStore.getStore(): Cannot find store: "+e),null}},u.instance=new u,u.MaxNumberOfEntries=2e3,u.KeyPrefix="GA::",u.EventsStoreKey="ga_event",u.SessionsStoreKey="ga_session",u.ProgressionStoreKey="ga_progression",u.ItemsStoreKey="ga_items",u}();e.GAStore=o}((D=Ce||(Ce={})).store||(D.store={})),_=Ce||(Ce={}),R=_.state||(_.state={}),N=_.validators.GAValidator,L=_.utilities.GAUtilities,O=_.logging.GALogger,V=_.store.GAStore,z=_.device.GADevice,H=_.store.EGAStore,q=_.store.EGAStoreArgsOperator,K=function(){function l(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.configurations={},this.commandCenterListeners=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={},this._isEventSubmissionEnabled=!0}return l.setUserId=function(e){l.instance.userId=e,l.cacheIdentifier()},l.getIdentifier=function(){return l.instance.identifier},l.isInitialized=function(){return l.instance.initialized},l.setInitialized=function(e){l.instance.initialized=e},l.getSessionStart=function(){return l.instance.sessionStart},l.getSessionNum=function(){return l.instance.sessionNum},l.getTransactionNum=function(){return l.instance.transactionNum},l.getSessionId=function(){return l.instance.sessionId},l.getCurrentCustomDimension01=function(){return l.instance.currentCustomDimension01},l.getCurrentCustomDimension02=function(){return l.instance.currentCustomDimension02},l.getCurrentCustomDimension03=function(){return l.instance.currentCustomDimension03},l.getGameKey=function(){return l.instance.gameKey},l.getGameSecret=function(){return l.instance.gameSecret},l.getAvailableCustomDimensions01=function(){return l.instance.availableCustomDimensions01},l.setAvailableCustomDimensions01=function(e){N.validateCustomDimensions(e)&&(l.instance.availableCustomDimensions01=e,l.validateAndFixCurrentDimensions(),O.i("Set available custom01 dimension values: ("+L.joinStringArray(e,", ")+")"))},l.getAvailableCustomDimensions02=function(){return l.instance.availableCustomDimensions02},l.setAvailableCustomDimensions02=function(e){N.validateCustomDimensions(e)&&(l.instance.availableCustomDimensions02=e,l.validateAndFixCurrentDimensions(),O.i("Set available custom02 dimension values: ("+L.joinStringArray(e,", ")+")"))},l.getAvailableCustomDimensions03=function(){return l.instance.availableCustomDimensions03},l.setAvailableCustomDimensions03=function(e){N.validateCustomDimensions(e)&&(l.instance.availableCustomDimensions03=e,l.validateAndFixCurrentDimensions(),O.i("Set available custom03 dimension values: ("+L.joinStringArray(e,", ")+")"))},l.getAvailableResourceCurrencies=function(){return l.instance.availableResourceCurrencies},l.setAvailableResourceCurrencies=function(e){N.validateResourceCurrencies(e)&&(l.instance.availableResourceCurrencies=e,O.i("Set available resource currencies: ("+L.joinStringArray(e,", ")+")"))},l.getAvailableResourceItemTypes=function(){return l.instance.availableResourceItemTypes},l.setAvailableResourceItemTypes=function(e){N.validateResourceItemTypes(e)&&(l.instance.availableResourceItemTypes=e,O.i("Set available resource item types: ("+L.joinStringArray(e,", ")+")"))},l.getBuild=function(){return l.instance.build},l.setBuild=function(e){l.instance.build=e,O.i("Set build version: "+e)},l.getUseManualSessionHandling=function(){return l.instance.useManualSessionHandling},l.isEventSubmissionEnabled=function(){return l.instance._isEventSubmissionEnabled},l.prototype.setDefaultId=function(e){this.defaultUserId=e||"",l.cacheIdentifier()},l.getDefaultId=function(){return l.instance.defaultUserId},l.getSdkConfig=function(){var e,i=0;for(var n in l.instance.sdkConfig)0===i&&(e=n),++i;if(e&&0<i)return l.instance.sdkConfig;for(var n in i=0,l.instance.sdkConfigCached)0===i&&(e=n),++i;return e&&0<i?l.instance.sdkConfigCached:l.instance.sdkConfigDefault},l.isEnabled=function(){var e=l.getSdkConfig();return!(e.enabled&&"false"==e.enabled||!l.instance.initAuthorized)},l.setCustomDimension01=function(e){l.instance.currentCustomDimension01=e,V.setItem(l.Dimension01Key,e),O.i("Set custom01 dimension value: "+e)},l.setCustomDimension02=function(e){l.instance.currentCustomDimension02=e,V.setItem(l.Dimension02Key,e),O.i("Set custom02 dimension value: "+e)},l.setCustomDimension03=function(e){l.instance.currentCustomDimension03=e,V.setItem(l.Dimension03Key,e),O.i("Set custom03 dimension value: "+e)},l.setFacebookId=function(e){l.instance.facebookId=e,V.setItem(l.FacebookIdKey,e),O.i("Set facebook id: "+e)},l.setGender=function(e){l.instance.gender=isNaN(Number(_.EGAGender[e]))?_.EGAGender[e].toString().toLowerCase():_.EGAGender[_.EGAGender[e]].toString().toLowerCase(),V.setItem(l.GenderKey,l.instance.gender),O.i("Set gender: "+l.instance.gender)},l.setBirthYear=function(e){l.instance.birthYear=e,V.setItem(l.BirthYearKey,e.toString()),O.i("Set birth year: "+e)},l.incrementSessionNum=function(){var e=l.getSessionNum()+1;l.instance.sessionNum=e},l.incrementTransactionNum=function(){var e=l.getTransactionNum()+1;l.instance.transactionNum=e},l.incrementProgressionTries=function(e){var i=l.getProgressionTries(e)+1;l.instance.progressionTries[e]=i;var n={};n.progression=e,n.tries=i,V.insert(H.Progression,n,!0,"progression")},l.getProgressionTries=function(e){return e in l.instance.progressionTries?l.instance.progressionTries[e]:0},l.clearProgressionTries=function(e){e in l.instance.progressionTries&&delete l.instance.progressionTries[e];var i=[];i.push(["progression",q.Equal,e]),V.delete(H.Progression,i)},l.setKeys=function(e,i){l.instance.gameKey=e,l.instance.gameSecret=i},l.setManualSessionHandling=function(e){l.instance.useManualSessionHandling=e,O.i("Use manual session handling: "+e)},l.setEnabledEventSubmission=function(e){l.instance._isEventSubmissionEnabled=e},l.getEventAnnotations=function(){var e={v:2};e.user_id=l.instance.identifier,e.client_ts=l.getClientTsAdjusted(),e.sdk_version=z.getRelevantSdkVersion(),e.os_version=z.osVersion,e.manufacturer=z.deviceManufacturer,e.device=z.deviceModel,e.browser_version=z.browserVersion,e.platform=z.buildPlatform,e.session_id=l.instance.sessionId,e[l.SessionNumKey]=l.instance.sessionNum;var i=z.getConnectionType();return N.validateConnectionType(i)&&(e.connection_type=i),z.gameEngineVersion&&(e.engine_version=z.gameEngineVersion),l.instance.build&&(e.build=l.instance.build),l.instance.facebookId&&(e[l.FacebookIdKey]=l.instance.facebookId),l.instance.gender&&(e[l.GenderKey]=l.instance.gender),0!=l.instance.birthYear&&(e[l.BirthYearKey]=l.instance.birthYear),e},l.getSdkErrorEventAnnotations=function(){var e={v:2};e.category=l.CategorySdkError,e.sdk_version=z.getRelevantSdkVersion(),e.os_version=z.osVersion,e.manufacturer=z.deviceManufacturer,e.device=z.deviceModel,e.platform=z.buildPlatform;var i=z.getConnectionType();return N.validateConnectionType(i)&&(e.connection_type=i),z.gameEngineVersion&&(e.engine_version=z.gameEngineVersion),e},l.getInitAnnotations=function(){var e={};return e.user_id=l.getIdentifier(),e.sdk_version=z.getRelevantSdkVersion(),e.os_version=z.osVersion,e.platform=z.buildPlatform,e},l.getClientTsAdjusted=function(){var e=L.timeIntervalSince1970(),i=e+l.instance.clientServerTimeOffset;return N.validateClientTs(i)?i:e},l.sessionIsStarted=function(){return 0!=l.instance.sessionStart},l.cacheIdentifier=function(){l.instance.userId?l.instance.identifier=l.instance.userId:l.instance.defaultUserId&&(l.instance.identifier=l.instance.defaultUserId)},l.ensurePersistedStates=function(){V.isStorageAvailable()&&V.load();var e=l.instance;e.setDefaultId(null!=V.getItem(l.DefaultUserIdKey)?V.getItem(l.DefaultUserIdKey):L.createGuid()),e.sessionNum=null!=V.getItem(l.SessionNumKey)?Number(V.getItem(l.SessionNumKey)):0,e.transactionNum=null!=V.getItem(l.TransactionNumKey)?Number(V.getItem(l.TransactionNumKey)):0,e.facebookId?V.setItem(l.FacebookIdKey,e.facebookId):(e.facebookId=null!=V.getItem(l.FacebookIdKey)?V.getItem(l.FacebookIdKey):"",e.facebookId),e.gender?V.setItem(l.GenderKey,e.gender):(e.gender=null!=V.getItem(l.GenderKey)?V.getItem(l.GenderKey):"",e.gender),e.birthYear&&0!=e.birthYear?V.setItem(l.BirthYearKey,e.birthYear.toString()):(e.birthYear=null!=V.getItem(l.BirthYearKey)?Number(V.getItem(l.BirthYearKey)):0,e.birthYear),e.currentCustomDimension01?V.setItem(l.Dimension01Key,e.currentCustomDimension01):(e.currentCustomDimension01=null!=V.getItem(l.Dimension01Key)?V.getItem(l.Dimension01Key):"",e.currentCustomDimension01),e.currentCustomDimension02?V.setItem(l.Dimension02Key,e.currentCustomDimension02):(e.currentCustomDimension02=null!=V.getItem(l.Dimension02Key)?V.getItem(l.Dimension02Key):"",e.currentCustomDimension02),e.currentCustomDimension03?V.setItem(l.Dimension03Key,e.currentCustomDimension03):(e.currentCustomDimension03=null!=V.getItem(l.Dimension03Key)?V.getItem(l.Dimension03Key):"",e.currentCustomDimension03);var i=null!=V.getItem(l.SdkConfigCachedKey)?V.getItem(l.SdkConfigCachedKey):"";if(i){var n=JSON.parse(L.decode64(i));n&&(e.sdkConfigCached=n)}var t=V.select(H.Progression);if(t)for(var s=0;s<t.length;++s){var o=t[s];o&&(e.progressionTries[o.progression]=o.tries)}},l.calculateServerTimeOffset=function(e){return e-L.timeIntervalSince1970()},l.validateAndCleanCustomFields=function(e){var i={};if(e){var n=0;for(var t in e){var s=e[t];if(t&&s)if(n<l.MAX_CUSTOM_FIELDS_COUNT){var o=new RegExp("^[a-zA-Z0-9_]{1,"+l.MAX_CUSTOM_FIELDS_KEY_LENGTH+"}$");if(L.stringMatch(t,o)){var a=typeof s;if("string"===a||s instanceof String){var r=s;r.length<=l.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH&&0<r.length?(i[t]=r,++n):O.w("validateAndCleanCustomFields: entry with key="+t+", value="+s+" has been omitted because its value is an empty string or exceeds the max number of characters ("+l.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH+")")}else if("number"===a||s instanceof Number){var d=s;i[t]=d,++n}else O.w("validateAndCleanCustomFields: entry with key="+t+", value="+s+" has been omitted because its value is not a string or number")}else O.w("validateAndCleanCustomFields: entry with key="+t+", value="+s+" has been omitted because its key contains illegal character, is empty or exceeds the max number of characters ("+l.MAX_CUSTOM_FIELDS_KEY_LENGTH+")")}else O.w("validateAndCleanCustomFields: entry with key="+t+", value="+s+" has been omitted because it exceeds the max number of custom fields ("+l.MAX_CUSTOM_FIELDS_COUNT+")");else O.w("validateAndCleanCustomFields: entry with key="+t+", value="+s+" has been omitted because its key or value is null")}}return i},l.validateAndFixCurrentDimensions=function(){N.validateDimension01(l.getCurrentCustomDimension01(),l.getAvailableCustomDimensions01())||l.setCustomDimension01(""),N.validateDimension02(l.getCurrentCustomDimension02(),l.getAvailableCustomDimensions02())||l.setCustomDimension02(""),N.validateDimension03(l.getCurrentCustomDimension03(),l.getAvailableCustomDimensions03())||l.setCustomDimension03("")},l.getConfigurationStringValue=function(e,i){return l.instance.configurations[e]?l.instance.configurations[e].toString():i},l.isCommandCenterReady=function(){return l.instance.commandCenterIsReady},l.addCommandCenterListener=function(e){l.instance.commandCenterListeners.indexOf(e)<0&&l.instance.commandCenterListeners.push(e)},l.removeCommandCenterListener=function(e){var i=l.instance.commandCenterListeners.indexOf(e);-1<i&&l.instance.commandCenterListeners.splice(i,1)},l.getConfigurationsContentAsString=function(){return JSON.stringify(l.instance.configurations)},l.populateConfigurations=function(e){var i=e.configurations;if(i)for(var n=0;n<i.length;++n){var t=i[n];if(t){var s=t.key,o=t.value,a=t.start?t.start:Number.MIN_VALUE,r=t.end?t.end:Number.MAX_VALUE,d=l.getClientTsAdjusted();s&&o&&a<d&&d<r&&(l.instance.configurations[s]=o)}}l.instance.commandCenterIsReady=!0;var c=l.instance.commandCenterListeners;for(n=0;n<c.length;++n)c[n]&&c[n].onCommandCenterUpdated()},l.CategorySdkError="sdk_error",l.MAX_CUSTOM_FIELDS_COUNT=50,l.MAX_CUSTOM_FIELDS_KEY_LENGTH=64,l.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH=256,l.instance=new l,l.DefaultUserIdKey="default_user_id",l.SessionNumKey="session_num",l.TransactionNumKey="transaction_num",l.FacebookIdKey="facebook_id",l.GenderKey="gender",l.BirthYearKey="birth_year",l.Dimension01Key="dimension01",l.Dimension02Key="dimension02",l.Dimension03Key="dimension03",l.SdkConfigCachedKey="sdk_config_cached",l}(),R.GAState=K,U=Ce||(Ce={}),j=U.tasks||(U.tasks={}),J=U.utilities.GAUtilities,Q=U.logging.GALogger,X=function(){function a(){}return a.execute=function(e,i,n,t){if(a.countMap[i]||(a.countMap[i]=0),!(a.countMap[i]>=a.MaxCount)){var s=J.getHmac(t,n),o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){if(!o.responseText)return;if(200!=o.status)return void Q.w("sdk error failed. response code not 200. status code: "+o.status+", description: "+o.statusText+", body: "+o.responseText);a.countMap[i]=a.countMap[i]+1}},o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization",s);try{o.send(n)}catch(e){console.error(e)}}},a.MaxCount=10,a.countMap={},a}(),j.SdkErrorTask=X,W=Ce||(Ce={}),Y=W.http||(W.http={}),Z=W.state.GAState,$=W.logging.GALogger,ee=W.utilities.GAUtilities,ie=W.validators.GAValidator,ne=W.tasks.SdkErrorTask,te=function(){function l(){this.protocol="https",this.hostName="api.gameanalytics.com",this.version="v2",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}return l.prototype.requestInit=function(e){var i=Z.getGameKey(),n=(this.baseUrl,this.initializeUrlPath);n="https://rubick.gameanalytics.com/v2/command_center?game_key="+i+"&interval_seconds=1000000";var t=Z.getInitAnnotations(),s=JSON.stringify(t);if(s){var o=this.createPayloadData(s,this.useGzip),a=[];a.push(s),l.sendRequest(n,o,a,this.useGzip,l.initRequestCallback,e)}else e(Y.EGAHTTPApiResponse.JsonEncodeFailed,null)},l.prototype.sendEventsInArray=function(e,i,n){if(0!=e.length){var t=Z.getGameKey(),s=this.baseUrl+"/"+t+"/"+this.eventsUrlPath,o=JSON.stringify(e);if(o){var a=this.createPayloadData(o,this.useGzip),r=[];r.push(o),r.push(i),r.push(e.length.toString()),l.sendRequest(s,a,r,this.useGzip,l.sendEventInArrayRequestCallback,n)}else n(Y.EGAHTTPApiResponse.JsonEncodeFailed,null,i,e.length)}},l.prototype.sendSdkErrorEvent=function(e){if(Z.isEventSubmissionEnabled()){var i=Z.getGameKey(),n=Z.getGameSecret();if(ie.validateSdkErrorEvent(i,n,e)){var t,s=this.baseUrl+"/"+i+"/"+this.eventsUrlPath,o=Z.getSdkErrorEventAnnotations(),a=l.sdkErrorTypeToString(e);o.type=a;var r=[];r.push(o),(t=JSON.stringify(r))?ne.execute(s,e,t,n):$.w("sendSdkErrorEvent: JSON encoding failed.")}}},l.sendEventInArrayRequestCallback=function(e,i,n,t){void 0===t&&(t=null),t[0],t[1];var s,o,a=t[2],r=parseInt(t[3]);s=e.responseText,o=e.status;var d=l.instance.processRequestResponse(o,e.statusText,s,"Events");if(d==Y.EGAHTTPApiResponse.Ok||d==Y.EGAHTTPApiResponse.BadRequest){var c=s?JSON.parse(s):{};null!=c?(Y.EGAHTTPApiResponse.BadRequest,n(d,c,a,r)):n(Y.EGAHTTPApiResponse.JsonDecodeFailed,null,a,r)}else n(d,null,a,r)},l.sendRequest=function(e,i,n,t,s,o){var a=new XMLHttpRequest,r=Z.getGameSecret(),d=ee.getHmac(r,i),c=[];for(var l in c.push(d),n)c.push(n[l]);if(a.onreadystatechange=function(){4===a.readyState&&s(a,e,o,c)},a.open("POST",e,!0),a.setRequestHeader("Content-Type","text/plain"),a.setRequestHeader("Authorization",d),t)throw new Error("gzip not supported");try{a.send(i)}catch(e){console.error(e.stack)}},l.initRequestCallback=function(e,i,n,t){var s,o;void 0===t&&(t=null),t[0],t[1],s=e.responseText,o=e.status;var a=s?JSON.parse(s):{},r=l.instance.processRequestResponse(o,e.statusText,s,"Init");if(r==Y.EGAHTTPApiResponse.Ok||r==Y.EGAHTTPApiResponse.BadRequest)if(null!=a)if(r!==Y.EGAHTTPApiResponse.BadRequest){var d=ie.validateAndCleanInitRequestResponse(a);d?n(Y.EGAHTTPApiResponse.Ok,d,"",0):n(Y.EGAHTTPApiResponse.BadResponse,null,"",0)}else n(r,null,"",0);else n(Y.EGAHTTPApiResponse.JsonDecodeFailed,null,"",0);else n(r,null,"",0)},l.prototype.createPayloadData=function(e,i){if(i)throw new Error("gzip not supported");return e},l.prototype.processRequestResponse=function(e,i,n,t){return n?200===e?Y.EGAHTTPApiResponse.Ok:0===e||401===e?Y.EGAHTTPApiResponse.Unauthorized:400===e?Y.EGAHTTPApiResponse.BadRequest:500===e?Y.EGAHTTPApiResponse.InternalServerError:Y.EGAHTTPApiResponse.UnknownResponseCode:Y.EGAHTTPApiResponse.NoResponse},l.sdkErrorTypeToString=function(e){switch(e){case Y.EGASdkErrorType.Rejected:return"rejected";default:return""}},l.instance=new l,l}(),Y.GAHTTPApi=te,se=Ce||(Ce={}),oe=se.events||(se.events={}),ae=se.store.GAStore,re=se.store.EGAStore,de=se.store.EGAStoreArgsOperator,ce=se.state.GAState,le=se.logging.GALogger,ue=se.utilities.GAUtilities,me=se.http.EGAHTTPApiResponse,ge=se.http.GAHTTPApi,he=se.validators.GAValidator,we=se.http.EGASdkErrorType,pe=function(){function m(){}return m.addSessionStartEvent=function(){if(ce.isEventSubmissionEnabled()){var e={};e.category=m.CategorySessionStart,ce.incrementSessionNum(),ae.setItem(ce.SessionNumKey,ce.getSessionNum().toString()),m.addDimensionsToEvent(e),m.addEventToStore(e),le.i("Add SESSION START event"),m.processEvents(m.CategorySessionStart,!1)}},m.addSessionEndEvent=function(){if(ce.isEventSubmissionEnabled()){var e=ce.getSessionStart(),i=ce.getClientTsAdjusted()-e;i<0&&(le.w("Session length was calculated to be less then 0. Should not be possible. Resetting to 0."),i=0);var n={};n.category=m.CategorySessionEnd,n.length=i,m.addDimensionsToEvent(n),m.addEventToStore(n),le.i("Add SESSION END event."),m.processEvents("",!1)}},m.addBusinessEvent=function(e,i,n,t,s,o){if(void 0===s&&(s=null),ce.isEventSubmissionEnabled())if(he.validateBusinessEvent(e,i,s,n,t)){var a={};ce.incrementTransactionNum(),ae.setItem(ce.TransactionNumKey,ce.getTransactionNum().toString()),a.event_id=n+":"+t,a.category=m.CategoryBusiness,a.currency=e,a.amount=i,a[ce.TransactionNumKey]=ce.getTransactionNum(),s&&(a.cart_type=s),m.addDimensionsToEvent(a),m.addFieldsToEvent(a,ce.validateAndCleanCustomFields(o)),le.i("Add BUSINESS event: {currency:"+e+", amount:"+i+", itemType:"+n+", itemId:"+t+", cartType:"+s+"}"),m.addEventToStore(a)}else ge.instance.sendSdkErrorEvent(we.Rejected)},m.addResourceEvent=function(e,i,n,t,s,o){if(ce.isEventSubmissionEnabled())if(he.validateResourceEvent(e,i,n,t,s,ce.getAvailableResourceCurrencies(),ce.getAvailableResourceItemTypes())){e===se.EGAResourceFlowType.Sink&&(n*=-1);var a={},r=m.resourceFlowTypeToString(e);a.event_id=r+":"+i+":"+t+":"+s,a.category=m.CategoryResource,a.amount=n,m.addDimensionsToEvent(a),m.addFieldsToEvent(a,ce.validateAndCleanCustomFields(o)),le.i("Add RESOURCE event: {currency:"+i+", amount:"+n+", itemType:"+t+", itemId:"+s+"}"),m.addEventToStore(a)}else ge.instance.sendSdkErrorEvent(we.Rejected)},m.addProgressionEvent=function(e,i,n,t,s,o,a){if(ce.isEventSubmissionEnabled()){var r=m.progressionStatusToString(e);if(he.validateProgressionEvent(e,i,n,t)){var d,c={};d=n?t?i+":"+n+":"+t:i+":"+n:i,c.category=m.CategoryProgression,c.event_id=r+":"+d;var l=0;o&&e!=se.EGAProgressionStatus.Start&&(c.score=s),e===se.EGAProgressionStatus.Fail&&ce.incrementProgressionTries(d),e===se.EGAProgressionStatus.Complete&&(ce.incrementProgressionTries(d),l=ce.getProgressionTries(d),c.attempt_num=l,ce.clearProgressionTries(d)),m.addDimensionsToEvent(c),m.addFieldsToEvent(c,ce.validateAndCleanCustomFields(a)),le.i("Add PROGRESSION event: {status:"+r+", progression01:"+i+", progression02:"+n+", progression03:"+t+", score:"+s+", attempt:"+l+"}"),m.addEventToStore(c)}else ge.instance.sendSdkErrorEvent(we.Rejected)}},m.addDesignEvent=function(e,i,n,t){if(ce.isEventSubmissionEnabled())if(he.validateDesignEvent(e,i)){var s={};s.category=m.CategoryDesign,s.event_id=e,n&&(s.value=i),m.addDimensionsToEvent(s),m.addFieldsToEvent(s,ce.validateAndCleanCustomFields(t)),le.i("Add DESIGN event: {eventId:"+e+", value:"+i+"}"),m.addEventToStore(s)}else ge.instance.sendSdkErrorEvent(we.Rejected)},m.addErrorEvent=function(e,i,n){if(ce.isEventSubmissionEnabled()){var t=m.errorSeverityToString(e);if(he.validateErrorEvent(e,i)){var s={};s.category=m.CategoryError,s.severity=t,s.message=i,m.addDimensionsToEvent(s),m.addFieldsToEvent(s,ce.validateAndCleanCustomFields(n)),le.i("Add ERROR event: {severity:"+t+", message:"+i+"}"),m.addEventToStore(s)}else ge.instance.sendSdkErrorEvent(we.Rejected)}},m.processEvents=function(e,i){if(ce.isEventSubmissionEnabled())try{var n=ue.createGuid();i&&(m.cleanupEvents(),m.fixMissingSessionEndEvents());var t=[];t.push(["status",de.Equal,"new"]);var s=[];s.push(["status",de.Equal,"new"]),e&&(t.push(["category",de.Equal,e]),s.push(["category",de.Equal,e]));var o=[];o.push(["status",n]);var a=ae.select(re.Events,t);if(!a||0==a.length)return le.i("Event queue: No events to send"),void m.updateSessionStore();if(a.length>m.MaxEventCount){if(!(a=ae.select(re.Events,t,!0,m.MaxEventCount)))return;var r=a[a.length-1].client_ts;if(t.push(["client_ts",de.LessOrEqual,r]),!(a=ae.select(re.Events,t)))return;s.push(["client_ts",de.LessOrEqual,r])}if(le.i("Event queue: Sending "+a.length+" events."),!ae.update(re.Events,o,s))return;for(var d=[],c=0;c<a.length;++c){var l=a[c],u=JSON.parse(ue.decode64(l.event));0!=u.length&&d.push(u)}ge.instance.sendEventsInArray(d,n,m.processEventsCallback)}catch(e){le.e("Error during ProcessEvents(): "+e.stack)}},m.processEventsCallback=function(e,i,n,t){var s=[];if(s.push(["status",de.Equal,n]),e===me.Ok)ae.delete(re.Events,s),le.i("Event queue: "+t+" events sent.");else if(e===me.NoResponse){var o=[];o.push(["status","new"]),le.w("Event queue: Failed to send events to collector - Retrying next time"),ae.update(re.Events,o,s)}else{if(i){var a,r=0;for(var d in i)0==r&&(a=i[d]),++r;e===me.BadRequest&&a.constructor===Array?le.w("Event queue: "+t+" events sent. "+r+" events failed GA server validation."):le.w("Event queue: Failed to send events.")}else le.w("Event queue: Failed to send events.");ae.delete(re.Events,s)}},m.cleanupEvents=function(){ae.update(re.Events,[["status","new"]])},m.fixMissingSessionEndEvents=function(){if(ce.isEventSubmissionEnabled()){var e=[];e.push(["session_id",de.NotEqual,ce.getSessionId()]);var i=ae.select(re.Sessions,e);if(i&&0!=i.length){le.i(i.length+" session(s) located with missing session_end event.");for(var n=0;n<i.length;++n){var t=JSON.parse(ue.decode64(i[n].event)),s=t.client_ts-i[n].timestamp;s=Math.max(0,s),t.category=m.CategorySessionEnd,t.length=s,m.addEventToStore(t)}}}},m.addEventToStore=function(e){if(ce.isEventSubmissionEnabled())if(ce.isInitialized())try{if(ae.isStoreTooLargeForEvents()&&!ue.stringMatch(e.category,/^(user|session_end|business)$/))return void le.w("Database too large. Event has been blocked.");var i=ce.getEventAnnotations(),n=ue.encode64(JSON.stringify(i));for(var t in e)i[t]=e[t];var s=JSON.stringify(i);le.ii("Event added to queue: "+s);var o={status:"new"};o.category=i.category,o.session_id=i.session_id,o.client_ts=i.client_ts,o.event=ue.encode64(JSON.stringify(i)),ae.insert(re.Events,o),e.category==m.CategorySessionEnd?ae.delete(re.Sessions,[["session_id",de.Equal,i.session_id]]):((o={}).session_id=i.session_id,o.timestamp=ce.getSessionStart(),o.event=n,ae.insert(re.Sessions,o,!0,"session_id")),ae.isStorageAvailable()&&ae.save()}catch(t){le.e("addEventToStore: error"),le.e(t.stack)}else le.w("Could not add event: SDK is not initialized")},m.updateSessionStore=function(){if(ce.sessionIsStarted()){var e={};e.session_id=ce.instance.sessionId,e.timestamp=ce.getSessionStart(),e.event=ue.encode64(JSON.stringify(ce.getEventAnnotations())),ae.insert(re.Sessions,e,!0,"session_id"),ae.isStorageAvailable()&&ae.save()}},m.addDimensionsToEvent=function(e){e&&(ce.getCurrentCustomDimension01()&&(e.custom_01=ce.getCurrentCustomDimension01()),ce.getCurrentCustomDimension02()&&(e.custom_02=ce.getCurrentCustomDimension02()),ce.getCurrentCustomDimension03()&&(e.custom_03=ce.getCurrentCustomDimension03()))},m.addFieldsToEvent=function(e,i){e&&i&&0<Object.keys(i).length&&(e.custom_fields=i)},m.resourceFlowTypeToString=function(e){return e==se.EGAResourceFlowType.Source||e==se.EGAResourceFlowType[se.EGAResourceFlowType.Source]?"Source":e==se.EGAResourceFlowType.Sink||e==se.EGAResourceFlowType[se.EGAResourceFlowType.Sink]?"Sink":""},m.progressionStatusToString=function(e){return e==se.EGAProgressionStatus.Start||e==se.EGAProgressionStatus[se.EGAProgressionStatus.Start]?"Start":e==se.EGAProgressionStatus.Complete||e==se.EGAProgressionStatus[se.EGAProgressionStatus.Complete]?"Complete":e==se.EGAProgressionStatus.Fail||e==se.EGAProgressionStatus[se.EGAProgressionStatus.Fail]?"Fail":""},m.errorSeverityToString=function(e){return e==se.EGAErrorSeverity.Debug||e==se.EGAErrorSeverity[se.EGAErrorSeverity.Debug]?"debug":e==se.EGAErrorSeverity.Info||e==se.EGAErrorSeverity[se.EGAErrorSeverity.Info]?"info":e==se.EGAErrorSeverity.Warning||e==se.EGAErrorSeverity[se.EGAErrorSeverity.Warning]?"warning":e==se.EGAErrorSeverity.Error||e==se.EGAErrorSeverity[se.EGAErrorSeverity.Error]?"error":e==se.EGAErrorSeverity.Critical||e==se.EGAErrorSeverity[se.EGAErrorSeverity.Critical]?"critical":""},m.instance=new m,m.CategorySessionStart="user",m.CategorySessionEnd="session_end",m.CategoryDesign="design",m.CategoryBusiness="business",m.CategoryProgression="progression",m.CategoryResource="resource",m.CategoryError="error",m.MaxEventCount=500,m}(),oe.GAEvents=pe,Se=Ce||(Ce={}),ve=Se.threading||(Se.threading={}),fe=Se.logging.GALogger,ye=Se.state.GAState,be=Se.events.GAEvents,ke=function(){function s(){this.blocks=new ve.PriorityQueue({compare:function(e,i){return e-i}}),this.id2TimedBlockMap={},s.startThread()}return s.createTimedBlock=function(e){void 0===e&&(e=0);var i=new Date;return i.setSeconds(i.getSeconds()+e),new ve.TimedBlock(i)},s.performTaskOnGAThread=function(e,i){void 0===i&&(i=0);var n=new Date;n.setSeconds(n.getSeconds()+i);var t=new ve.TimedBlock(n);t.block=e,s.instance.id2TimedBlockMap[t.id]=t,s.instance.addTimedBlock(t)},s.performTimedBlockOnGAThread=function(e){s.instance.id2TimedBlockMap[e.id]=e,s.instance.addTimedBlock(e)},s.scheduleTimer=function(e,i){var n=new Date;n.setSeconds(n.getSeconds()+e);var t=new ve.TimedBlock(n);return t.block=i,s.instance.id2TimedBlockMap[t.id]=t,s.instance.addTimedBlock(t),t.id},s.getTimedBlockById=function(e){return e in s.instance.id2TimedBlockMap?s.instance.id2TimedBlockMap[e]:null},s.ensureEventQueueIsRunning=function(){s.instance.keepRunning=!0,s.instance.isRunning||(s.instance.isRunning=!0,s.scheduleTimer(s.ProcessEventsIntervalInSeconds,s.processEventQueue))},s.endSessionAndStopQueue=function(){ye.isInitialized()&&(fe.i("Ending session."),s.stopEventQueue(),ye.isEnabled()&&ye.sessionIsStarted()&&(be.addSessionEndEvent(),ye.instance.sessionStart=0))},s.stopEventQueue=function(){s.instance.keepRunning=!1},s.ignoreTimer=function(e){e in s.instance.id2TimedBlockMap&&(s.instance.id2TimedBlockMap[e].ignore=!0)},s.setEventProcessInterval=function(e){0<e&&(s.ProcessEventsIntervalInSeconds=e)},s.prototype.addTimedBlock=function(e){this.blocks.enqueue(e.deadline.getTime(),e)},s.run=function(){clearTimeout(s.runTimeoutId);try{for(var e;e=s.getNextBlock();)if(!e.ignore)if(e.async){if(!e.running){e.running=!0,e.block();break}}else e.block();return void(s.runTimeoutId=setTimeout(s.run,s.ThreadWaitTimeInMs))}catch(e){fe.e("Error on GA thread"),fe.e(e.stack)}},s.startThread=function(){s.runTimeoutId=setTimeout(s.run,0)},s.getNextBlock=function(){var e=new Date;return s.instance.blocks.hasItems()&&s.instance.blocks.peek().deadline.getTime()<=e.getTime()?s.instance.blocks.peek().async&&s.instance.blocks.peek().running?s.instance.blocks.peek():s.instance.blocks.dequeue():null},s.processEventQueue=function(){be.processEvents("",!0),s.instance.keepRunning?s.scheduleTimer(s.ProcessEventsIntervalInSeconds,s.processEventQueue):s.instance.isRunning=!1},s.instance=new s,s.ThreadWaitTimeInMs=1e3,s.ProcessEventsIntervalInSeconds=8,s}(),ve.GAThreading=ke,Ae=Ce||(Ce={}),Ee=Ae.threading.GAThreading,Te=Ae.logging.GALogger,Fe=Ae.store.GAStore,Be=Ae.state.GAState,Me=Ae.http.GAHTTPApi,Ge=Ae.device.GADevice,Pe=Ae.validators.GAValidator,Ie=Ae.http.EGAHTTPApiResponse,xe=Ae.utilities.GAUtilities,De=Ae.events.GAEvents,_e=function(){function a(){}return a.init=function(){if(Ge.touch(),a.methodMap.configureAvailableCustomDimensions01=a.configureAvailableCustomDimensions01,a.methodMap.configureAvailableCustomDimensions02=a.configureAvailableCustomDimensions02,a.methodMap.configureAvailableCustomDimensions03=a.configureAvailableCustomDimensions03,a.methodMap.configureAvailableResourceCurrencies=a.configureAvailableResourceCurrencies,a.methodMap.configureAvailableResourceItemTypes=a.configureAvailableResourceItemTypes,a.methodMap.configureBuild=a.configureBuild,a.methodMap.configureSdkGameEngineVersion=a.configureSdkGameEngineVersion,a.methodMap.configureGameEngineVersion=a.configureGameEngineVersion,a.methodMap.configureUserId=a.configureUserId,a.methodMap.initialize=a.initialize,a.methodMap.addBusinessEvent=a.addBusinessEvent,a.methodMap.addResourceEvent=a.addResourceEvent,a.methodMap.addProgressionEvent=a.addProgressionEvent,a.methodMap.addDesignEvent=a.addDesignEvent,a.methodMap.addErrorEvent=a.addErrorEvent,a.methodMap.addErrorEvent=a.addErrorEvent,a.methodMap.setEnabledInfoLog=a.setEnabledInfoLog,a.methodMap.setEnabledVerboseLog=a.setEnabledVerboseLog,a.methodMap.setEnabledManualSessionHandling=a.setEnabledManualSessionHandling,a.methodMap.setEnabledEventSubmission=a.setEnabledEventSubmission,a.methodMap.setCustomDimension01=a.setCustomDimension01,a.methodMap.setCustomDimension02=a.setCustomDimension02,a.methodMap.setCustomDimension03=a.setCustomDimension03,a.methodMap.setFacebookId=a.setFacebookId,a.methodMap.setGender=a.setGender,a.methodMap.setBirthYear=a.setBirthYear,a.methodMap.setEventProcessInterval=a.setEventProcessInterval,a.methodMap.startSession=a.startSession,a.methodMap.endSession=a.endSession,a.methodMap.onStop=a.onStop,a.methodMap.onResume=a.onResume,a.methodMap.addCommandCenterListener=a.addCommandCenterListener,a.methodMap.removeCommandCenterListener=a.removeCommandCenterListener,a.methodMap.getCommandCenterValueAsString=a.getCommandCenterValueAsString,a.methodMap.isCommandCenterReady=a.isCommandCenterReady,a.methodMap.getConfigurationsContentAsString=a.getConfigurationsContentAsString,"undefined"!=typeof window&&void 0!==window.GameAnalytics&&void 0!==window.GameAnalytics.q){var e=window.GameAnalytics.q;for(var i in e)a.gaCommand.apply(null,e[i])}},a.gaCommand=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];0<e.length&&e[0]in Ae.GameAnalytics.methodMap&&(1<e.length?Ae.GameAnalytics.methodMap[e[0]].apply(null,Array.prototype.slice.call(e,1)):Ae.GameAnalytics.methodMap[e[0]]())},a.configureAvailableCustomDimensions01=function(e){void 0===e&&(e=[]),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!1)?Te.w("Available custom dimensions must be set before SDK is initialized"):Be.setAvailableCustomDimensions01(e)})},a.configureAvailableCustomDimensions02=function(e){void 0===e&&(e=[]),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!1)?Te.w("Available custom dimensions must be set before SDK is initialized"):Be.setAvailableCustomDimensions02(e)})},a.configureAvailableCustomDimensions03=function(e){void 0===e&&(e=[]),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!1)?Te.w("Available custom dimensions must be set before SDK is initialized"):Be.setAvailableCustomDimensions03(e)})},a.configureAvailableResourceCurrencies=function(e){void 0===e&&(e=[]),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!1)?Te.w("Available resource currencies must be set before SDK is initialized"):Be.setAvailableResourceCurrencies(e)})},a.configureAvailableResourceItemTypes=function(e){void 0===e&&(e=[]),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!1)?Te.w("Available resource item types must be set before SDK is initialized"):Be.setAvailableResourceItemTypes(e)})},a.configureBuild=function(e){void 0===e&&(e=""),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!1)?Te.w("Build version must be set before SDK is initialized."):Pe.validateBuild(e)?Be.setBuild(e):Te.i("Validation fail - configure build: Cannot be null, empty or above 32 length. String: "+e)})},a.configureSdkGameEngineVersion=function(e){void 0===e&&(e=""),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!1)||(Pe.validateSdkWrapperVersion(e)?Ge.sdkGameEngineVersion=e:Te.i("Validation fail - configure sdk version: Sdk version not supported. String: "+e))})},a.configureGameEngineVersion=function(e){void 0===e&&(e=""),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!1)||(Pe.validateEngineVersion(e)?Ge.gameEngineVersion=e:Te.i("Validation fail - configure game engine version: Game engine version not supported. String: "+e))})},a.configureUserId=function(e){void 0===e&&(e=""),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!1)?Te.w("A custom user id must be set before SDK is initialized."):Pe.validateUserId(e)?Be.setUserId(e):Te.i("Validation fail - configure user_id: Cannot be null, empty or above 64 length. Will use default user_id method. Used string: "+e)})},a.initialize=function(e,i){void 0===e&&(e=""),void 0===i&&(i=""),Ge.updateConnectionType();var n=Ee.createTimedBlock();n.async=!0,a.initTimedBlockId=n.id,n.block=function(){a.isSdkReady(!0,!1)?Te.w("SDK already initialized. Can only be called once."):Pe.validateKeys(e,i)?(Be.setKeys(e,i),a.internalInitialize()):Te.w("SDK failed initialize. Game key or secret key is invalid. Can only contain characters A-z 0-9, gameKey is 32 length, gameSecret is 40 length. Failed keys - gameKey: "+e+", secretKey: "+i)},Ee.performTimedBlockOnGAThread(n)},a.addBusinessEvent=function(e,i,n,t,s){void 0===e&&(e=""),void 0===i&&(i=0),void 0===n&&(n=""),void 0===t&&(t=""),void 0===s&&(s=""),Ge.updateConnectionType(),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!0,"Could not add business event")&&De.addBusinessEvent(e,i,n,t,s,{})})},a.addResourceEvent=function(e,i,n,t,s){void 0===e&&(e=Ae.EGAResourceFlowType.Undefined),void 0===i&&(i=""),void 0===n&&(n=0),void 0===t&&(t=""),void 0===s&&(s=""),Ge.updateConnectionType(),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!0,"Could not add resource event")&&De.addResourceEvent(e,i,n,t,s,{})})},a.addProgressionEvent=function(i,n,t,s,o){void 0===i&&(i=Ae.EGAProgressionStatus.Undefined),void 0===n&&(n=""),void 0===t&&(t=""),void 0===s&&(s=""),Ge.updateConnectionType(),Ee.performTaskOnGAThread(function(){if(a.isSdkReady(!0,!0,"Could not add progression event")){var e="number"==typeof o;De.addProgressionEvent(i,n,t,s,e?o:0,e,{})}})},a.addDesignEvent=function(i,n){Ge.updateConnectionType(),Ee.performTaskOnGAThread(function(){if(a.isSdkReady(!0,!0,"Could not add design event")){var e="number"==typeof n;De.addDesignEvent(i,e?n:0,e,{})}})},a.addErrorEvent=function(e,i){void 0===e&&(e=Ae.EGAErrorSeverity.Undefined),void 0===i&&(i=""),Ge.updateConnectionType(),Ee.performTaskOnGAThread(function(){a.isSdkReady(!0,!0,"Could not add error event")&&De.addErrorEvent(e,i,{})})},a.setEnabledInfoLog=function(e){void 0===e&&(e=!1),Ee.performTaskOnGAThread(function(){e?(Te.setInfoLog(e),Te.i("Info logging enabled")):(Te.i("Info logging disabled"),Te.setInfoLog(e))})},a.setEnabledVerboseLog=function(e){void 0===e&&(e=!1),Ee.performTaskOnGAThread(function(){e?(Te.setVerboseLog(e),Te.i("Verbose logging enabled")):(Te.i("Verbose logging disabled"),Te.setVerboseLog(e))})},a.setEnabledManualSessionHandling=function(e){void 0===e&&(e=!1),Ee.performTaskOnGAThread(function(){Be.setManualSessionHandling(e)})},a.setEnabledEventSubmission=function(e){void 0===e&&(e=!1),Ee.performTaskOnGAThread(function(){e?(Be.setEnabledEventSubmission(e),Te.i("Event submission enabled")):(Te.i("Event submission disabled"),Be.setEnabledEventSubmission(e))})},a.setCustomDimension01=function(e){void 0===e&&(e=""),Ee.performTaskOnGAThread(function(){Pe.validateDimension01(e,Be.getAvailableCustomDimensions01())?Be.setCustomDimension01(e):Te.w("Could not set custom01 dimension value to '"+e+"'. Value not found in available custom01 dimension values")})},a.setCustomDimension02=function(e){void 0===e&&(e=""),Ee.performTaskOnGAThread(function(){Pe.validateDimension02(e,Be.getAvailableCustomDimensions02())?Be.setCustomDimension02(e):Te.w("Could not set custom02 dimension value to '"+e+"'. Value not found in available custom02 dimension values")})},a.setCustomDimension03=function(e){void 0===e&&(e=""),Ee.performTaskOnGAThread(function(){Pe.validateDimension03(e,Be.getAvailableCustomDimensions03())?Be.setCustomDimension03(e):Te.w("Could not set custom03 dimension value to '"+e+"'. Value not found in available custom03 dimension values")})},a.setFacebookId=function(e){void 0===e&&(e=""),Ee.performTaskOnGAThread(function(){Pe.validateFacebookId(e)&&Be.setFacebookId(e)})},a.setGender=function(e){void 0===e&&(e=Ae.EGAGender.Undefined),Ee.performTaskOnGAThread(function(){Pe.validateGender(e)&&Be.setGender(e)})},a.setBirthYear=function(e){void 0===e&&(e=0),Ee.performTaskOnGAThread(function(){Pe.validateBirthyear(e)&&Be.setBirthYear(e)})},a.setEventProcessInterval=function(e){Ee.performTaskOnGAThread(function(){Ee.setEventProcessInterval(e)})},a.startSession=function(){if(Be.isInitialized()){var e=Ee.createTimedBlock();e.async=!0,a.initTimedBlockId=e.id,e.block=function(){Be.isEnabled()&&Be.sessionIsStarted()&&Ee.endSessionAndStopQueue(),a.resumeSessionAndStartQueue()},Ee.performTimedBlockOnGAThread(e)}},a.endSession=function(){a.onStop()},a.onStop=function(){Ee.performTaskOnGAThread(function(){try{Ee.endSessionAndStopQueue()}catch(e){}})},a.onResume=function(){var e=Ee.createTimedBlock();e.async=!0,a.initTimedBlockId=e.id,e.block=function(){a.resumeSessionAndStartQueue()},Ee.performTimedBlockOnGAThread(e)},a.getCommandCenterValueAsString=function(e,i){return void 0===i&&(i=null),Be.getConfigurationStringValue(e,i)},a.isCommandCenterReady=function(){return Be.isCommandCenterReady()},a.addCommandCenterListener=function(e){Be.addCommandCenterListener(e)},a.removeCommandCenterListener=function(e){Be.removeCommandCenterListener(e)},a.getConfigurationsContentAsString=function(){return Be.getConfigurationsContentAsString()},a.internalInitialize=function(){Be.ensurePersistedStates(),Fe.setItem(Be.DefaultUserIdKey,Be.getDefaultId()),Be.setInitialized(!0),a.newSession(),Be.isEnabled()&&Ee.ensureEventQueueIsRunning()},a.newSession=function(){Te.i("Starting a new session."),Be.validateAndFixCurrentDimensions(),Me.instance.requestInit(a.startNewSessionCallback)},a.startNewSessionCallback=function(e,i){if(e===Ie.Ok&&i){var n=0;if(i.server_ts){var t=i.server_ts;n=Be.calculateServerTimeOffset(t)}i.time_offset=n,Fe.setItem(Be.SdkConfigCachedKey,xe.encode64(JSON.stringify(i))),Be.instance.sdkConfigCached=i,Be.instance.sdkConfig=i,Be.instance.initAuthorized=!0}else e==Ie.Unauthorized?(Te.w("Initialize SDK failed - Unauthorized"),Be.instance.initAuthorized=!1):(e===Ie.NoResponse||e===Ie.RequestTimeout?Te.i("Init call (session start) failed - no response. Could be offline or timeout."):e===Ie.BadResponse||e===Ie.JsonEncodeFailed||e===Ie.JsonDecodeFailed?Te.i("Init call (session start) failed - bad response. Could be bad response from proxy or GA servers."):e!==Ie.BadRequest&&e!==Ie.UnknownResponseCode||Te.i("Init call (session start) failed - bad request or unknown response."),null==Be.instance.sdkConfig?null!=Be.instance.sdkConfigCached?(Te.i("Init call (session start) failed - using cached init values."),Be.instance.sdkConfig=Be.instance.sdkConfigCached):(Te.i("Init call (session start) failed - using default init values."),Be.instance.sdkConfig=Be.instance.sdkConfigDefault):Te.i("Init call (session start) failed - using cached init values."),Be.instance.initAuthorized=!0);if(Be.instance.clientServerTimeOffset=Be.getSdkConfig().time_offset?Be.getSdkConfig().time_offset:0,Be.populateConfigurations(Be.getSdkConfig()),!Be.isEnabled())return Te.w("Could not start session: SDK is disabled."),void Ee.stopEventQueue();Ee.ensureEventQueueIsRunning();var s=xe.createGuid();Be.instance.sessionId=s,Be.instance.sessionStart=Be.getClientTsAdjusted(),De.addSessionStartEvent();var o=Ee.getTimedBlockById(a.initTimedBlockId);null!=o&&(o.running=!1),a.initTimedBlockId=-1},a.resumeSessionAndStartQueue=function(){Be.isInitialized()&&(Te.i("Resuming session."),Be.sessionIsStarted()||a.newSession())},a.isSdkReady=function(e,i,n){return void 0===i&&(i=!0),void 0===n&&(n=""),n&&(n+=": "),e&&!Be.isInitialized()?(i&&Te.w(n+"SDK is not initialized"),!1):e&&!Be.isEnabled()?(i&&Te.w(n+"SDK is disabled"),!1):!(e&&!Be.sessionIsStarted())||(i&&Te.w(n+"Session has not started yet"),!1)},a.initTimedBlockId=-1,a.methodMap={},a}(),Ae.GameAnalytics=_e,Ce.GameAnalytics.init();Ce.GameAnalytics.gaCommand;i.exports=Ce},{}],achievementController:[function(e,i,n){"use strict";cc._RF.push(i,"e094eAGealM05kL+kYX2izY","achievementController");cc.Class({extends:cc.Component,properties:{list:cc.Node,button:cc.Prefab,popups:[cc.Node],icons:[cc.SpriteFrame],dungeonXP:cc.Label},onEnable:function(){this.updateSpecialButton("truedeath"),this.updateSpecialButton("daredevil"),this.updateSpecialButton("already"),this.updateSpecialButton("overkill"),this.updateSpecialButton("darkness"),this.updateSpecialButton("lucky"),this.updateButton(this.levelMax),this.updateButton(this.xp),this.updateButton(this.tiles),this.updateButton(this.killstotal),this.updateButton(this.killsmelee),this.updateButton(this.killsranged),this.updateButton(this.killsmagic),this.updateButton(this.trapstotal),this.updateButton(this.trapsfire),this.updateButton(this.trapsice),this.updateButton(this.trapsacid),this.updateButton(this.trapselectricity),this.updateButton(this.trapsspikes),this.updateButton(this.trapspoison),this.updateButton(this.itemschests),this.updateButton(this.itemstotal),this.updateButton(this.itemsfire),this.updateButton(this.itemsice),this.updateButton(this.itemsacid),this.updateButton(this.itemselectricity),this.updateButton(this.itemsspikes),this.updateButton(this.itemspoison),this.updateButton(this.itemspotion),this.updateButton(this.damagetotal),this.updateButton(this.damagefire),this.updateButton(this.damageice),this.updateButton(this.damageacid),this.updateButton(this.damageelectricity),this.updateButton(this.damagespikes),this.updateButton(this.damagepoison),this.updateButton(this.damagemelee),this.updateButton(this.damageranged),this.updateButton(this.damagemagic),this.updateButton(this.deathtotal),this.updateButton(this.deathfire),this.updateButton(this.deathice),this.updateButton(this.deathacid),this.updateButton(this.deathelectricity),this.updateButton(this.deathspikes),this.updateButton(this.deathpoison),this.updateButton(this.deathmelee),this.updateButton(this.deathranged),this.updateButton(this.deathmagic)},start:function(){this.createSpecialButton("True Death","Get to -10HP","truedeath",1),this.createSpecialButton("Daredevil","Face a trap with 1HP and 0 shields","daredevil",1),this.createSpecialButton("Already back?","Die, then die again in the next floor","already",1),this.createSpecialButton("Overkill","Get an enemy to -10HP","overkill",1),this.createSpecialButton("Stop Moving!","Get 'Dungeon Moves' twice in a floor","darkness",1),this.createSpecialButton("Lucky","Cross a floor without hitting any trap","lucky",1),this.createButton("Explorer","Deepest floor you went",null,"levelMax",2,100),this.createButton("High level","Total XP spent",null,"xp",2,.001),this.createButton("Runner","Tiles walked",null,"tiles",2,.1),this.createButton("God of War","Enemies you defeated","kills","total",3,1),this.createButton("Warrior","Enemies you defeated with your sword","kills","melee",3,5),this.createButton("Archer","Enemies you defeated with your bow","kills","ranged",4,5),this.createButton("Archmage","Enemies you defeated with your wand","kills","magic",5,5),this.createButton("Trap Finder","Total traps found the hard way","traps","total",6,1),this.createButton("Getting warmer","Total fire traps found the hard way","traps","fire",6,50),this.createButton("Getting colder","Total ice traps found the hard way","traps","ice",6,50),this.createButton("Dirty floor","Total acid traps found the hard way","traps","acid",6,50),this.createButton("Tesla attack","Total electricity traps found the hard way","traps","electricity",6,50),this.createButton("Holed floor","Total spikes traps found the hard way","traps","spikes",6,50),this.createButton("Holed wall","Total poisoned dart traps found the hard way","traps","poison",6,50),this.createButton("Treasure Hunter","Total chests found","items","chests",7,1),this.createButton("Spender","Total items used","items","total",8,.25),this.createButton("Like sunscreen","Total fire shields used","items","fire",9,5),this.createButton("A warm blanket","Total ice shields used","items","ice",9,5),this.createButton("Still intact","Total acid shields used","items","acid",9,5),this.createButton("Fully isolated","Total electricity shields used","items","electricity",9,5),this.createButton("Steel boots","Total spikes shields used","items","spikes",9,5),this.createButton("Antidote","Total poison shields used","items","poison",9,5),this.createButton("Not addicted","Total potions used","items","potion",10,5),this.createButton("It hurts everywhere","Total damage taken","damage","total",11,5),this.createButton("Needs some Aloe","Total fire damage","damage","fire",11,100),this.createButton("I want a blanket","Total ice damage","damage","ice",11,100),this.createButton("I need a base","Total acid damage","damage","acid",11,100),this.createButton("I need rubber boots","Total electricity damage","damage","electricity",11,100),this.createButton("Not again...","Total spikes damage","damage","spikes",11,100),this.createButton("Feeling kind green","Total poison damage","damage","poison",11,100),this.createButton("I need a shield","Total damage in melee combat","damage","melee",3,100),this.createButton("This bow is bad","Total damage in ranged combat","damage","ranged",4,100),this.createButton("I need a staff","Total damage in magic combat","damage","magic",5,100),this.createButton("Kenny","Total deaths","death","total",12,250),this.createButton("Barbecue","Total burned deaths","death","fire",12,500),this.createButton("Popsicle","Total frozen deaths","death","ice",12,500),this.createButton("Not much left","Total dissolved deaths","death","acid",12,500),this.createButton("Full of Energy","Total electricity deaths","death","electricity",12,500),this.createButton("Is Vlad here?","Total impaled deaths","death","spikes",12,500),this.createButton("Is there an antidote?","Total poisoned deaths","death","poison",12,500),this.createButton("Shaky hand","Total deaths in melee combat","death","melee",12,500),this.createButton("Bad Sight","Total deaths in ranged combat","death","ranged",12,500),this.createButton("Curled Tongue","Total deaths in magic combat","death","magic",12,500)},createSpecialButton:function(e,i,n,t){var s=0;window.gameSession.stats.unique[n]&&(s=1);var o="unique"+n,a=s/1,r=s+" / 1",d=cc.instantiate(this.button);d.parent=this.list,d.progress=a,d.prize=1e4,d.sub="unique",d.field=n,d.mult=1,d.id=t,d.getChildByName("Name").getComponent(cc.Label).string=e,d.getChildByName("Description").getComponent(cc.Label).string=i,d.getChildByName("Value").getComponent(cc.Label).string=1e4+"XP",d.getChildByName("Progress").getComponent(cc.ProgressBar).progress=a,d.getChildByName("Completion").getComponent(cc.Label).string=r,window.gameSession.achievements.unique[n]?d.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[t]:d.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[0];var c=new cc.Component.EventHandler;c.target=this.node,c.component="achievementController",c.handler="getSpecialPrize",d.getComponent(cc.Button).clickEvents.push(c),this[o]=d},getSpecialPrize:function(e){var i=e.target,n=i.progress,t=(i.sub,i.field);1<=n&&!window.gameSession.achievements.unique[t]&&(window.analytics.Design_event("achievement:unique:"+t),window.gameSession.xp+=i.prize,this.dungeonXP.string=window.gameSession.xp,window.gameSession.achievements.unique[t]=!0),this.updateSpecialButton(t),this.saveGame()},updateSpecialButton:function(e){var i=this["unique"+e];if(i){var n=0;window.gameSession.stats.unique[e]&&(n=1);var t=n/1,s=n+" / 1";i.progress=t,i.prize=1e4,i.getChildByName("Value").getComponent(cc.Label).string=1e4+"XP",i.getChildByName("Progress").getComponent(cc.ProgressBar).progress=t,i.getChildByName("Completion").getComponent(cc.Label).string=s,window.gameSession.achievements.unique[e]?i.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[i.id]:i.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[0]}},createButton:function(e,i,n,t,s,o){var a=void 0,r=void 0,d=void 0;n?(a=window.gameSession.achievements[n][t],r=window.gameSession.stats[n][t],d=n+t):(a=window.gameSession.achievements[t],r=window.gameSession.stats[t],d=t);var c=100*(a+1),l=c,u=r/c,m=r+" / "+c;1<o?l*=o:o<1&&(u=r/(c/o),m=r+" / "+c/o);var g=cc.instantiate(this.button);g.parent=this.list,g.progress=u,g.prize=l,g.sub=n,g.field=t,g.mult=o,g.id=s,g.getChildByName("Name").getComponent(cc.Label).string=e,g.getChildByName("Description").getComponent(cc.Label).string=i,g.getChildByName("Value").getComponent(cc.Label).string=l+"XP",g.getChildByName("Progress").getComponent(cc.ProgressBar).progress=u,g.getChildByName("Completion").getComponent(cc.Label).string=m,g.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=a<1?this.icons[0]:this.icons[s];var h=new cc.Component.EventHandler;h.target=this.node,h.component="achievementController",h.handler="getPrize",g.getComponent(cc.Button).clickEvents.push(h),this[d]=g},getPrize:function(e){var i=e.target,n=i.progress,t=i.sub,s=i.field;1<=n&&(t?(window.gameSession.achievements[t][s]++,100<window.gameSession.achievements[t][s]?(window.gameSession.achievements[t][s]=100,window.gameSession.xp-=i.prize):window.analytics.Design_event("achievement:multiple:"+t+":"+s,window.gameSession.achievements[t][s])):(window.gameSession.achievements[s]++,100<window.gameSession.achievements[s]?(window.gameSession.achievements[s]=100,window.gameSession.xp-=i.prize):window.analytics.Design_event("achievement:multiple:"+s,window.gameSession.achievements[s])),window.gameSession.xp+=i.prize,this.dungeonXP.string=window.gameSession.xp),this.updateButton(i,t,s),this.saveGame()},updateButton:function(e){if(e){var i=e.mult,n=e.sub,t=e.field,s=void 0,o=void 0;n?(s=window.gameSession.achievements[n][t],o=window.gameSession.stats[n][t]):(s=window.gameSession.achievements[t],o=window.gameSession.stats[t]);var a=100*(s+1),r=a,d=o/a,c=o+" / "+a;1<i?r*=i:i<1&&(d=o/(a/i),c=o+" / "+a/i),e.progress=d,e.prize=r,e.getChildByName("Value").getComponent(cc.Label).string=r+"XP",e.getChildByName("Progress").getComponent(cc.ProgressBar).progress=d,e.getChildByName("Completion").getComponent(cc.Label).string=c,e.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=s<1?this.icons[0]:this.icons[e.id]}},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},close:function(){this.node.active=!1,window.gameGlobals.popup=!1},open:function(){if(!(window.gameSession.hp<1)){for(var e=0;e<this.popups.length;e++)this.popups[e].active=!1;this.node.active=!0,window.gameGlobals.popup=!0}}});cc._RF.pop()},{}],analytics:[function(e,i,n){"use strict";var t;function s(e,i,n){return i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}cc._RF.push(i,"1f007vKAV5O5rj1ZBpAqkDr","analytics");var o=e("gameanalytics"),a=cc.Class((s(t={extends:cc.Component,properties:{Info_Log:!0,Analytics_Enabled:!0,Analytics_Initialized:{default:!1,visible:!1}},onLoad:function(){},start:function(){this.Init_Analytics()},Init_Analytics:function(){this.Analytics_Initialized||(this.Info_Log&&o.GameAnalytics.setEnabledInfoLog(!0),this.Analytics_Enabled||o.GameAnalytics.setEnabledEventSubmission(!1),o.GameAnalytics.configureBuild("0.5.0"),o.GameAnalytics.initialize("63d0bf37a3c7e7bbb8ece69373eabb43","3f919b525355ccba0faabc45f7cd0108908abe1f"),this.Analytics_Initialized=!0,cc.log("Analytics is on")),window.analytics=this},Analytics_Ready:function(){return o.GameAnalytics.isSdkReady(!0,!1)},Start_Analytics_Session:function(){o.GameAnalytics.startSession()},End_Analytics_Session:function(){o.GameAnalytics.endSessionImmediate()},Get_User_ID:function(){return o.GameAnalytics.Get_User_ID()},Level_Start:function(e,i){i=i||cc.director.getScene().name,this.Analytics_Ready()&&o.GameAnalytics.addProgressionEvent(o.EGAProgressionStatus.Start,i,e)}},"Level_Start",function(e,i){i=i||cc.director.getScene().name,this.Analytics_Ready()&&o.GameAnalytics.addProgressionEvent(o.EGAProgressionStatus.Start,i,e)}),s(t,"Level_Fail",function(e,i){i=i||cc.director.getScene().name,this.Analytics_Ready()&&o.GameAnalytics.addProgressionEvent(o.EGAProgressionStatus.Fail,i,e)}),s(t,"Level_Complete",function(e,i){i=i||cc.director.getScene().name,this.Analytics_Ready()&&o.GameAnalytics.addProgressionEvent(o.EGAProgressionStatus.Complete,i,e)}),s(t,"Design_event",function(e,i){i||(i=-1),this.Analytics_Ready()&&o.GameAnalytics.addDesignEvent(e,i)}),t));i.exports=a,cc._RF.pop()},{gameanalytics:1}],deathController:[function(e,i,n){"use strict";cc._RF.push(i,"6c4a65Zyl5N9a5j6+E0StCV","deathController"),cc.Class({extends:cc.Component,properties:{deathPopup:cc.Node,hp:cc.Label},iDied:function(){this.close(),window.analytics.Level_Fail("Floor "+window.gameSession.level,"Dungeon Scene"),window.gameSession.level=window.gameSession.levelMin,window.gameSession.hp=window.gameSession.hpMax,window.gameSession.death=!0,window.gameSession.job=0,window.gameSession.inventory.fire=Math.min(window.gameSession.inventory.fireMin,window.gameSession.inventory.fireMax),window.gameSession.inventory.ice=Math.min(window.gameSession.inventory.iceMin,window.gameSession.inventory.iceMax),window.gameSession.inventory.acid=Math.min(window.gameSession.inventory.acidMin,window.gameSession.inventory.acidMax),window.gameSession.inventory.electricity=Math.min(window.gameSession.inventory.electricityMin,window.gameSession.inventory.electricityMax),window.gameSession.inventory.spikes=Math.min(window.gameSession.inventory.spikesMin,window.gameSession.inventory.spikesMax),window.gameSession.inventory.poison=Math.min(window.gameSession.inventory.poisonMin,window.gameSession.inventory.poisonMax),window.gameSession.inventory.potion=Math.min(window.gameSession.inventory.potionMin,window.gameSession.inventory.potionMax),cc.director.loadScene("gameScene")},iAmBack:function(){window.gameSession.currency<100||(window.gameSession.currency-=100,window.analytics.Design_event("event:ressurrection",window.gameSession.currency),window.gameSession.hp=window.gameSession.hpMax,this.hp.string=window.gameSession.hp,this.saveGame(),this.close())},start:function(){},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},close:function(){this.node.active=!1,window.gameGlobals.popup=!1},open:function(){this.node.active=!0,window.gameGlobals.popup=!0}}),cc._RF.pop()},{}],gridController:[function(e,i,n){"use strict";cc._RF.push(i,"2bcdfsBj75NDKCCf3TUBANw","gridController");cc.Class({extends:cc.Component,properties:{tilePrefab:cc.Prefab,feedbackPrefab:cc.Prefab,logPrefab:cc.Prefab,gridNode:cc.Node,nextButton:cc.Node,upgradePopup:cc.Node,deathPopup:cc.Node,jobPopup:cc.Node,rewardPopup:cc.Node,canvas:cc.Node,inventoryButton:cc.Node,dungeonAchievement:cc.Node,feedbackLog:cc.Node,dungeonHP:cc.Label,dungeonLevel:cc.Label,dungeonXP:cc.Label,trapFinder:cc.Label,treasureHunter:cc.Label,tracker:cc.Label,deathMessage:cc.Label,currencyLabel:cc.Label,shields:[cc.Label],trapsQtd:[cc.Label],door_corner:cc.SpriteFrame,door_side:cc.SpriteFrame,deadend:cc.SpriteFrame,line:cc.SpriteFrame,curve:cc.SpriteFrame,threeway:cc.SpriteFrame,fourway:cc.SpriteFrame,unknown:cc.SpriteFrame,open:cc.SpriteFrame,danger:[cc.SpriteFrame],monster:[cc.SpriteFrame],chest:cc.SpriteFrame,stair_down:cc.SpriteFrame,stair_up:cc.SpriteFrame,lever:cc.SpriteFrame,stone:cc.SpriteFrame},start:function(){window.analytics.Level_Start("Floor "+window.gameSession.level,"Dungeon Scene"),this.enumSides={undefined:0,block:1,wall:2,open:3},this.enumTile={undefined:0,entrance:1,exit:2,deadend:3,corridor:4},this.enumStatus={hidden:0,flashing:1,visible:2},this.enumContent={empty:0,treasure:1,danger:2,darkness:3,monster:4,lever:5},this.enumSprite={entrance:0,exit:1,deadend:2,curve:3,line:4,threeway:5,fourway:6},this.enumClass={undefined:0,rogue:1,fighter:2,wizard:3},this.initUI(),window.gameSession.job<1&&this.showJobSelection(),this.showUpgrades(),this.checkTime(),window.gameSession.currency||(window.gameSession.currency=0),this.currencyLabel.string=window.gameSession.currency,this.saveGame(),this.clicks=0,this.dangers=0,this.dangersType=[0,0,0,0,0,0],this.treasures=0,this.monsters=0,this.clickable=0,this.dungeonMoves=0,this.running=!1,this.hitTrap=!1,this.timeToRun=.5;var e=Math.min(Math.floor(window.gameSession.level/10),10);this.size=10+e;this.tileWidth=[75,68,62.1,57.2,53,49.3,46.1,43.2,40.7,38.5,36.5][e],this.subtileWidth=[54,48.9,44.7,41.2,38.1,35.5,33.2,31.1,29.3,27.7,26.2][e],this.gridSize=this.size*this.size-1,this.initGrid(this.size),this.closed=window.gameSession.level%25==0,this.setDoorDirection(this.size),this.closed&&this.setLever(this.size),this.buildStack=new Array,this.buildMaze(this.entrance.x,this.entrance.y),this.fillGrid(this.size),this.showClickZones(this.entrance.x,this.entrance.y),this.revealSubSprite(this.entrance.x,this.entrance.y),window.gameSession.treasureHunter&&(this.treasureHunter.node.active=!0),window.gameSession.trapFinder&&(this.trapFinder.node.active=!0),window.gameSession.fireFinder&&(this.trapsQtd[0].node.active=!0),window.gameSession.iceFinder&&(this.trapsQtd[1].node.active=!0),window.gameSession.acidFinder&&(this.trapsQtd[2].node.active=!0),window.gameSession.electricityFinder&&(this.trapsQtd[3].node.active=!0),window.gameSession.spikesFinder&&(this.trapsQtd[4].node.active=!0),window.gameSession.poisonFinder&&(this.trapsQtd[5].node.active=!0),window.gameSession.tracker&&(this.tracker.node.active=!0)},checkTime:function(){var e=new Date,i={d:e.getDate(),m:e.getMonth(),y:e.getFullYear()},n=window.gameSession.date;this.isNewDay(i,n)&&(this.wbPrize(),this.rewardPopup.active=!0,window.gameSession.date=i,this.saveGame())},isNewDay:function(e,i){return i.y<e.y||!(i.y>e.y)&&(i.m<e.m||!(i.m>e.m)&&(i.d<e.d||(i.d,e.d,!1)))},wbPrize:function(){var e=Math.min(window.gameSession.upgrades.fireMin,window.gameSession.upgrades.fireMax,window.gameSession.upgrades.iceMin,window.gameSession.upgrades.iceMax,window.gameSession.upgrades.acidMin,window.gameSession.upgrades.acidMax,window.gameSession.upgrades.electricityMin,window.gameSession.upgrades.electricityMax,window.gameSession.upgrades.spikesMin,window.gameSession.upgrades.spikesMax,window.gameSession.upgrades.poisonMin,window.gameSession.upgrades.poisonMax,window.gameSession.upgrades.potionMin,window.gameSession.upgrades.potionMax,window.gameSession.upgrades.hpMax);window.gameSession.xp+=e,window.gameGlobals.xpReward=e,this.dungeonXP.string=window.gameSession.xp,this.showFeedback("+"+e+"XP",new cc.Color(0,255,0),this.dungeonXP.node,!1),window.analytics.Design_event("event:dailyXP",e)},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},showUpgrades:function(){var e=Math.min(window.gameSession.upgrades.fireMin,window.gameSession.upgrades.fireMax,window.gameSession.upgrades.iceMin,window.gameSession.upgrades.iceMax,window.gameSession.upgrades.acidMin,window.gameSession.upgrades.acidMax,window.gameSession.upgrades.electricityMin,window.gameSession.upgrades.electricityMax,window.gameSession.upgrades.spikesMin,window.gameSession.upgrades.spikesMax,window.gameSession.upgrades.poisonMin,window.gameSession.upgrades.poisonMax,window.gameSession.upgrades.potionMin,window.gameSession.upgrades.potionMax,window.gameSession.upgrades.hpMax);window.gameSession.xp>e&&(this.upgradePopup.active=!0,window.gameGlobals.popup=!0)},showJobSelection:function(){this.jobPopup.active=!0},initUI:function(){this.dungeonLevel.string=window.gameSession.level,this.dungeonXP.string=window.gameSession.xp,this.dungeonHP.string=window.gameSession.hp,this.shields[0].string=window.gameSession.inventory.fire,this.shields[1].string=window.gameSession.inventory.ice,this.shields[2].string=window.gameSession.inventory.acid,this.shields[3].string=window.gameSession.inventory.electricity,this.shields[4].string=window.gameSession.inventory.spikes,this.shields[5].string=window.gameSession.inventory.poison},cleanGrid:function(e){this.nextButton.active=!1,this.clicks=0,this.dangers=0,this.dangersType=[0,0,0,0,0,0],this.treasures=0;for(var i=this.monsters=0;i<e;i++)for(var n=0;n<e;n++)this.gridUI[i][n].destroy()},initGrid:function(e){this.grid=new Array(e),this.gridUI=new Array(e);for(var i=0;i<e;i++){this.grid[i]=new Array(e),this.gridUI[i]=new Array(e);for(var n=0;n<e;n++)this.grid[i][n]={},this.grid[i][n].x=i,this.grid[i][n].y=n,this.grid[i][n].north=this.enumSides[void 0],this.grid[i][n].south=this.enumSides[void 0],this.grid[i][n].east=this.enumSides[void 0],this.grid[i][n].west=this.enumSides[void 0],this.grid[i][n].tile=this.enumTile[void 0],this.grid[i][n].status=this.enumStatus.hidden,this.grid[i][n].content=this.enumContent.empty,0==i&&(this.grid[i][n].north=this.enumSides.block),i==e-1&&(this.grid[i][n].south=this.enumSides.block),0==n&&(this.grid[i][n].west=this.enumSides.block),n==e-1&&(this.grid[i][n].east=this.enumSides.block)}},showClickZones:function(e,i){var n=this.grid[e][i],t=0;n.north==this.enumSides.open&&this.addClickFunction(e-1,i)&&t++,n.south==this.enumSides.open&&this.addClickFunction(e+1,i)&&t++,n.east==this.enumSides.open&&this.addClickFunction(e,i+1)&&t++,n.west==this.enumSides.open&&this.addClickFunction(e,i-1)&&t++,1<t&&(this.running=!1)},addClickFunction:function(e,i){var n=this.grid[e][i];if(n.status==this.enumStatus.visible)return!1;if(n.status==this.enumStatus.flashing)return this.lastClickZone=this.gridUI[e][i],!0;n.status=this.enumStatus.flashing,this.clickable++;var t=this.gridUI[e][i];t.getComponent(cc.Sprite).spriteFrame=this.open;var s=new cc.Component.EventHandler;return s.target=this.node,s.component="gridController",s.handler="gridClick",t.tile=n,t.getComponent(cc.Button).clickEvents.push(s),this.lastClickZone=t,!0},startRunning:function(){this.running=!0,this.timeToRun=.5},run:function(e){var i={};this.lastClickZone?(i.target=this.lastClickZone,(this.lastClickZone=null)!=i.target&&this.gridClick(i)):this.running=!1},gridClick:function(e){if(!(window.gameSession.hp<1||window.gameGlobals.popup))if(e.target.tile.tile!=this.enumTile.exit||!e.target.used||this.closed){if(!e.target.used){e.target.used=!0,this.clickable--,window.gameSession.stats.tiles++,window.gameSession.stats.tiles%1e3==0&&this.showFeedback("Achievement: Runner",new cc.Color(0,255,0),this.dungeonAchievement,!0),window.gameSession.treasureHunter&&(this.treasureHunter.node.active=!0),window.gameSession.trapFinder&&(this.trapFinder.node.active=!0),window.gameSession.fireFinder&&(this.trapsQtd[0].node.active=!0),window.gameSession.iceFinder&&(this.trapsQtd[1].node.active=!0),window.gameSession.acidFinder&&(this.trapsQtd[2].node.active=!0),window.gameSession.electricityFinder&&(this.trapsQtd[3].node.active=!0),window.gameSession.spikesFinder&&(this.trapsQtd[4].node.active=!0),window.gameSession.poisonFinder&&(this.trapsQtd[5].node.active=!0),window.gameSession.tracker&&(this.tracker.node.active=!0),this.startRunning();var i=e.target.tile;i.status=this.enumStatus.visible,e.target.getComponent(cc.Sprite).spriteFrame=i.sprite,this.showClickZones(i.x,i.y),window.gameSession.hp<window.gameSession.hpMax&&0<window.gameSession.inventory.potion&&(window.analytics.Design_event("event:potion"),window.gameSession.inventory.potion--,window.gameSession.stats.items.potion++,window.gameSession.stats.items.potion%100==0&&this.showFeedback("Achievement: Not addicted",new cc.Color(0,255,0),this.dungeonAchievement,!0),window.gameSession.stats.items.total++,window.gameSession.stats.items.total%100==0&&this.showFeedback("Achievement: Spender",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.showFeedback("Used potion",new cc.Color(0,255,0),e.target,!0),window.gameSession.job==this.enumClass.wizard?(window.gameSession.hp+=2,this.showFeedback("+2HP",new cc.Color(0,255,0),this.dungeonHP.node,!1)):(window.gameSession.hp++,this.showFeedback("+1HP",new cc.Color(0,255,0),this.dungeonHP.node,!1)),this.dungeonHP.string=window.gameSession.hp);var n=0;if(this.clicks++,this.clicks==this.gridSize&&(window.analytics.Design_event("event:cleanFloor",window.gameSession.level),n+=window.gameSession.level*(this.gridSize+1),window.gameSession.job==this.enumClass.wizard&&(n+=window.gameSession.level*this.gridSize)),n+=window.gameSession.level,window.gameSession.job==this.enumClass.wizard&&(n+=window.gameSession.level),i.content==this.enumContent.treasure&&(this.running=!1,this.giveTreasure(Math.floor(100*Math.random()+1),e.target)),i.content==this.enumContent.danger&&(this.running=!1,this.fightDanger(i.contentType,e.target),this.findSubSprite(i,i.contentType),0<window.gameSession.hp?(n+=25*window.gameSession.level,window.gameSession.job==this.enumClass.rogue&&(n+=25*window.gameSession.level),window.gameSession.stats.traps.total++,window.gameSession.stats.traps.total%100==0&&this.showFeedback("Achievement: Trap Finder",new cc.Color(0,255,0),this.dungeonAchievement,!0)):(this.deathPopup.active=!0,window.gameGlobals.popup=!0,this.deathMessage.string="You died! \n You were "+this.lastDanger+"!")),i.content==this.enumContent.darkness){this.showFeedback("Dungeon Moves!",new cc.Color(255,0,0),this.dungeonLevel.node,!0),this.dungeonMoves++,window.analytics.Design_event("event:darkness",this.dungeonMoves),1<this.dungeonMoves&&(window.gameSession.stats.unique.darkness=!0,window.gameSession.achievements.unique.darkness||this.showFeedback("Achievement: Stop Moving!",new cc.Color(0,255,0),this.dungeonAchievement,!0)),this.running=!1;var t=e.target.tile.x,s=e.target.tile.y;this.cleanGrid(this.size),this.initGrid(this.size),this.closed=window.gameSession.level%25==0,this.setDoorDirection(this.size),this.closed&&this.setLever(this.size),this.buildStack=new Array,this.buildMaze(this.entrance.x,this.entrance.y),this.grid[this.entrance.x][this.entrance.y].status=this.enumStatus.hidden,this.grid[t][s].status=this.enumStatus.visible,this.fillGrid(this.size),this.showClickZones(t,s)}if(i.content==this.enumContent.monster){this.running=!1;var o=Math.floor(3*Math.random()+1);this.fightMonster(o,e.target,0),this.findSubSprite(i,o),0<window.gameSession.hp?(n+=25*window.gameSession.level,window.gameSession.job==this.enumClass.fighter&&(n+=25*window.gameSession.level)):(this.deathPopup.active=!0,window.gameGlobals.popup=!0,this.deathMessage.string="You died! \n You were "+this.lastDanger+"!")}if(i.content==this.enumContent.lever){window.analytics.Design_event("event:lever",window.gameSession.level),this.showFeedback("Stairs Unlocked",new cc.Color(0,255,0),this.dungeonLevel.node,!0),this.closed=!1;var a=this.grid[this.exit.x][this.exit.y];this.findSubSprite(a,-1),a.status==this.enumStatus.visible&&(this.revealSubSprite(this.exit.x,this.exit.y),this.nextButton.active=!0)}if(this.revealSubSprite(i.x,i.y),i.tile==this.enumTile.exit){this.running=!1,this.closed?(this.showFeedback("Stairs Locked",new cc.Color(255,0,0),this.dungeonLevel.node,!0),window.analytics.Design_event("event:stairsLocked",window.gameSession.level)):this.nextButton.active=!0;var r=0;if(window.gameSession.level%10==0?r=2:window.gameSession.level%5==0&&(r=1),0<r){this.monsters++;var d=Math.floor(3*Math.random()+1);this.fightMonster(d,e.target,r),this.findSubSprite(i,d),0<window.gameSession.hp?(n+=25*window.gameSession.level,window.gameSession.job==this.enumClass.fighter&&(n+=25*window.gameSession.level)):(this.deathPopup.active=!0,window.gameGlobals.popup=!0,this.deathMessage.string="You died! \n You were "+this.lastDanger+"!")}}window.gameSession.xp+=n,this.dungeonXP.string=window.gameSession.xp,this.showFeedback("+"+n+"XP",new cc.Color(0,255,0),this.dungeonXP.node,!1)}}else this.nextLevel()},revealSubSprite:function(e,i){var n=this.grid[e][i],t=this.gridUI[e][i],s=t.getChildByName("content");s.rotation=360-t.rotation,n.subsprite&&(s.getComponent(cc.Sprite).spriteFrame=n.subsprite)},fightMonster:function(e,i,n){this.monsters--,this.tracker.string=this.monsters;var t=Math.floor(window.gameSession.level/5)+1+n;window.gameSession.job==this.enumClass.fighter&&t--;var s=void 0,o=void 0,a=void 0,r=void 0,d=void 0,c=void 0;switch(e){case 1:s="Fought Orc",o="murdered",a="melee",r="I need a shield",d="Warrior",c="Shaky Hand";break;case 2:s="Fought Cockatrice",o="petrified",a="ranged",r="This bow is bad",d="Archer",c="Bad Sight";break;case 3:s="Fought Ghost",o="drained of life",a="magic",r="I need a staff",d="Archmage",c="Curled Tongue"}1<n?s+=" Boss":0<n&&(s+=" Sub-boss"),this.showFeedback(s,new cc.Color(255,0,0),i,!0),this.lastDanger=o,t-window.gameSession.inventory[a]<-9&&(window.gameSession.stats.unique.overkill=!0,window.gameSession.achievements.unique.overkill||this.showFeedback("Achievement: Overkill",new cc.Color(0,255,0),this.dungeonAchievement,!0)),window.analytics.Design_event("Fight:"+a+":"+t,window.gameSession.inventory[a]),0<(t-=Math.min(t,window.gameSession.inventory[a]))&&(this.showFeedback("-"+t+"HP",new cc.Color(255,0,0),this.dungeonHP.node,!1),window.gameSession.hp-=t,window.gameSession.stats.damage[a]+=t,window.gameSession.stats.damage[a]%100==0&&this.showFeedback("Achievement: "+r,new cc.Color(0,255,0),this.dungeonAchievement,!0),window.gameSession.stats.damage.total+=t,window.gameSession.stats.damage.total%100==0&&this.showFeedback("Achievement: It hurts everywhere",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonHP.string=window.gameSession.hp),0<window.gameSession.hp?(window.gameSession.stats.kills[a]++,window.gameSession.stats.kills[a]%100==0&&this.showFeedback("Achievement: "+d,new cc.Color(0,255,0),this.dungeonAchievement,!0),window.gameSession.stats.kills.total++,window.gameSession.stats.kills.total%100==0&&this.showFeedback("Achievement: God of War",new cc.Color(0,255,0),this.dungeonAchievement,!0)):(window.gameSession.hp<-9&&(window.gameSession.stats.unique.truedeath=!0,window.gameSession.achievements.unique.truedeath||this.showFeedback("Achievement: True Death",new cc.Color(0,255,0),this.dungeonAchievement,!0)),window.gameSession.death&&(window.gameSession.stats.unique.already=!0,window.gameSession.achievements.unique.already||this.showFeedback("Achievement: Already Back?",new cc.Color(0,255,0),this.dungeonAchievement,!0)),window.gameSession.stats.death[a]++,window.gameSession.stats.death[a]%100==0&&this.showFeedback("Achievement: "+c,new cc.Color(0,255,0),this.dungeonAchievement,!0),window.gameSession.stats.death.total++,window.gameSession.stats.death.total%100==0&&this.showFeedback("Achievement: Kenny",new cc.Color(0,255,0),this.dungeonAchievement,!0))},fightDanger:function(e,i){this.dangers--,this.hitTrap=!0,this.trapFinder.string=this.dangers;var n=Math.floor(window.gameSession.level/10+1);window.gameSession.job==this.enumClass.rogue&&n--;var t=void 0,s=void 0,o=void 0,a=void 0,r=void 0,d=void 0,c=void 0;switch(window.gameSession.hp<2&&window.gameSession.inventory.fire+window.gameSession.inventory.ice+window.gameSession.inventory.acid+window.gameSession.inventory.electricity+window.gameSession.inventory.spikes+window.gameSession.inventory.poison<1&&(window.gameSession.stats.unique.daredevil=!0,window.gameSession.achievements.unique.daredevil||this.showFeedback("Achievement: Daredevil",new cc.Color(0,255,0),this.dungeonAchievement,!0)),this.dangersType[e-1]--,this.trapsQtd[e-1].string=this.dangersType[e-1],e){case 1:t="Fire Trap",s="burned",o="fire",a="Fire",r="Getting warmer",d="Like sunscreen",c="Barbecue";break;case 2:t="Freezing Trap",s="frozen",o="ice",a="Ice",r="Getting colder",d="A warm blanket",c="Popsicle";break;case 3:t="Acid Trap",s="dissolved",o="acid",a="Acid",r="Dirty floor",d="Still intact",c="Not much left";break;case 4:t="Electricity Trap",s="electrocuted",o="electricity",a="Electricity",r="Tesla attack",d="Fully isolated",c="Full of Energy";break;case 5:t="Floor Spikes Trap",s="impaled",o="spikes",a="Spikes",r="Holed floor",d="Steel boots",c="Is Vlad here?";break;case 6:t="Poisoned Dart Trap",s="poisoned",o="poison",a="Poison",r="Holed wall",d="Antidote",c="Is there an antidote?"}if(window.analytics.Design_event("Trap:"+o+":"+n,window.gameSession.inventory[o]),n-=window.gameSession.skills[o+"Shield"],this.showFeedback(t,new cc.Color(255,0,0),i,!0),this.lastDanger=s,window.gameSession.stats.traps[o]++,window.gameSession.stats.traps[o]%100==0&&this.showFeedback("Achievement: "+r,new cc.Color(0,255,0),this.dungeonAchievement,!0),0<window.gameSession.inventory[o]){var l=window.gameSession.inventory[o],u=Math.min(n,l);window.gameSession.inventory[o]-=u,window.gameSession.stats.items[o]+=u,this.shields[e-1].string=window.gameSession.inventory[o],window.gameSession.stats.items[o]%100==0&&this.showFeedback("Achievement: "+d,new cc.Color(0,255,0),this.dungeonAchievement,!0),window.gameSession.stats.items.total+=u,window.gameSession.stats.items.total%100==0&&this.showFeedback("Achievement: Spender",new cc.Color(0,255,0),this.dungeonAchievement,!0),n-=u,this.showFeedback("-"+u+" "+a+" Shield",new cc.Color(255,0,0),this.dungeonLevel.node,!0)}0<n&&(this.showFeedback("-"+n+"HP",new cc.Color(255,0,0),this.dungeonHP.node,!1),window.gameSession.hp-=n,window.gameSession.stats.damage[o]+=n,window.gameSession.stats.items[o]%100==0&&this.showFeedback("Achievement: "+d,new cc.Color(0,255,0),this.dungeonAchievement,!0),window.gameSession.stats.damage.total+=n,window.gameSession.stats.damage.total%100==0&&this.showFeedback("Achievement: It hurts everywhere",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonHP.string=window.gameSession.hp),window.gameSession.hp<=0&&(window.gameSession.hp<-9&&(window.gameSession.stats.unique.truedeath=!0,window.gameSession.achievements.unique.truedeath||this.showFeedback("Achievement: True Death",new cc.Color(0,255,0),this.dungeonAchievement,!0)),window.gameSession.death&&(window.gameSession.stats.unique.already=!0,window.gameSession.achievements.unique.already||this.showFeedback("Achievement: Already Back?",new cc.Color(0,255,0),this.dungeonAchievement,!0)),window.gameSession.stats.death[o]++,window.gameSession.stats.death[o]%100==0&&this.showFeedback("Achievement: "+c,new cc.Color(0,255,0),this.dungeonAchievement,!0),window.gameSession.stats.death.total++,window.gameSession.stats.death.total%100==0&&this.showFeedback("Achievement: Kenny",new cc.Color(0,255,0),this.dungeonAchievement,!0))},giveTreasure:function(e,i){this.treasures--,this.treasureHunter.string=this.treasures;var n=1+window.gameSession.skills.totalShield;window.gameSession.stats.items.chests+=n,window.gameSession.stats.items.chests%100==0&&this.showFeedback("Achievement: Treasure Hunter",new cc.Color(0,255,0),this.dungeonAchievement,!0),e<=10?(window.analytics.Design_event("Treasure:potion",n),window.gameSession.inventory.potion=Math.min(window.gameSession.inventory.potion+n,window.gameSession.inventory.potionMax),this.showFeedback("Got "+n+" Potion",new cc.Color(0,255,0),i,!0)):e<=25?(window.analytics.Design_event("Treasure:fire",n),window.gameSession.inventory.fire=Math.min(window.gameSession.inventory.fire+n,window.gameSession.inventory.fireMax),this.showFeedback("Got "+n+" Fire Shield",new cc.Color(0,255,0),i,!0),this.shields[0].string=window.gameSession.inventory.fire):e<=40?(window.analytics.Design_event("Treasure:ice",n),window.gameSession.inventory.ice=Math.min(window.gameSession.inventory.ice+n,window.gameSession.inventory.iceMax),this.showFeedback("Got "+n+" Ice Shield",new cc.Color(0,255,0),i,!0),this.shields[1].string=window.gameSession.inventory.ice):e<=55?(window.analytics.Design_event("Treasure:acid",n),window.gameSession.inventory.acid=Math.min(window.gameSession.inventory.acid+n,window.gameSession.inventory.acidMax),this.showFeedback("Got "+n+" Acid Shield",new cc.Color(0,255,0),i,!0),this.shields[2].string=window.gameSession.inventory.acid):e<=70?(window.analytics.Design_event("Treasure:electricity",n),window.gameSession.inventory.electricity=Math.min(window.gameSession.inventory.electricity+n,window.gameSession.inventory.electricityMax),this.showFeedback("Got "+n+" Electricity Shield",new cc.Color(0,255,0),i,!0),this.shields[3].string=window.gameSession.inventory.electricity):e<=85?(window.analytics.Design_event("Treasure:spikes",n),window.gameSession.inventory.spikes=Math.min(window.gameSession.inventory.spikes+n,window.gameSession.inventory.spikesMax),this.showFeedback("Got "+n+" Spikes Shield",new cc.Color(0,255,0),i,!0),this.shields[4].string=window.gameSession.inventory.spikes):e<=100&&(window.analytics.Design_event("Treasure:poison",n),window.gameSession.inventory.poison=Math.min(window.gameSession.inventory.poison+n,window.gameSession.inventory.poisonMax),this.showFeedback("Got "+n+" Poison Shield",new cc.Color(0,255,0),i,!0),this.shields[5].string=window.gameSession.inventory.poison)},nextLevel:function(){window.gameSession.hp<1||(window.gameSession.death=!1,this.hitTrap||(window.gameSession.stats.unique.lucky=!0,window.gameSession.achievements.unique.lucky||this.showFeedback("Achievement: Lucky",new cc.Color(0,255,0),this.dungeonAchievement,!0)),window.gameSession.currency++,window.analytics.Level_Complete("Floor "+window.gameSession.level,"Dungeon Scene"),window.gameSession.level++,window.gameSession.level>window.gameSession.stats.levelMax&&(window.gameSession.stats.levelMax=window.gameSession.level),window.gameSession.stats.levelMax%100==0&&this.showFeedback("Achievement: Explorer",new cc.Color(0,255,0),this.dungeonAchievement,!0),cc.director.loadScene("gameScene"))},fillGrid:function(e){for(var i=0;i<e;i++)for(var n=0;n<e;n++){var t=this.grid[i][n];this.makeWall(t),this.findSprite(t),this.findSubSprite(t,-1);var s=cc.instantiate(this.tilePrefab);(this.gridUI[i][n]=s).width=this.tileWidth,s.height=this.tileWidth;var o=s.getChildByName("content");o.width=this.subtileWidth,o.height=this.subtileWidth,s.parent=this.gridNode,s.rotation=t.rotation;var a=s.getComponent(cc.Sprite);t.status==this.enumStatus.visible?a.spriteFrame=t.sprite:t.status==this.enumStatus.hidden&&(a.spriteFrame=this.unknown)}},findSubSprite:function(e,i){e.tile==this.enumTile.entrance?e.subsprite=this.stair_up:e.tile==this.enumTile.exit&&this.closed?e.subsprite=this.stone:e.tile==this.enumTile.exit?e.subsprite=this.stair_down:e.content==this.enumContent.treasure?e.subsprite=this.chest:e.content==this.enumContent.danger&&-1<i?e.subsprite=this.danger[i-1]:e.content==this.enumContent.monster&&-1<i?e.subsprite=this.monster[i-1]:e.content==this.enumContent.lever&&(e.subsprite=this.lever)},findSprite:function(e){if(e.tile==this.enumTile.deadend)this.showDeadend(e);else{var i=0;e.north==this.enumSides.open&&i++,e.south==this.enumSides.open&&i++,e.east==this.enumSides.open&&i++,e.west==this.enumSides.open&&i++,1==i?this.showDeadend(e):2==i&&(e.north==this.enumSides.open&&e.south==this.enumSides.open||e.east==this.enumSides.open&&e.west==this.enumSides.open)?this.showLine(e):2==i?this.showCurve(e):3==i?this.showThreeWay(e):4==i?this.showFourWay(e):console.error("ERROR: no sprite",e)}},showDoor:function(e){var i=0;e.north==this.enumSides.block&&i++,e.south==this.enumSides.block&&i++,e.east==this.enumSides.block&&i++,e.west==this.enumSides.block&&i++,2==i?(e.sprite=this.door_corner,1==e.north?1==e.west?e.rotation=0:1==e.east&&(e.rotation=90):1==e.south&&(1==e.west?e.rotation=270:1==e.east&&(e.rotation=180))):1==i?(e.sprite=this.door_side,1==e.north?e.rotation=0:1==e.east?e.rotation=90:1==e.south?e.rotation=180:1==e.west&&(e.rotation=270)):console.error("ERROR: should not have that amount of blocks",e,i)},showDeadend:function(e){e.sprite=this.deadend,e.north==this.enumSides.open?e.rotation=270:e.east==this.enumSides.open?e.rotation=0:e.south==this.enumSides.open?e.rotation=90:e.west==this.enumSides.open&&(e.rotation=180),Math.floor(100*Math.random()+1)<=25+Math.min(25,window.gameSession.level)&&e.content==this.enumContent.empty&&e.tile!=this.enumTile.entrance&&e.tile!=this.enumTile.exit?(e.content=this.enumContent.danger,e.contentType=Math.floor(6*Math.random()+1),this.dangersType[e.contentType-1]++,this.trapsQtd[e.contentType-1].string=this.dangersType[e.contentType-1],this.dangers++,this.trapFinder.string=this.dangers):e.content==this.enumContent.empty&&e.tile!=this.enumTile.entrance&&e.tile!=this.enumTile.exit&&(e.content=this.enumContent.treasure,this.treasures++,this.treasureHunter.string=this.treasures)},showLine:function(e){e.sprite=this.line,e.north==this.enumSides.open?e.rotation=0:e.east==this.enumSides.open&&(e.rotation=90)},showCurve:function(e){e.sprite=this.curve,e.north==this.enumSides.open?e.west==this.enumSides.open?e.rotation=180:e.east==this.enumSides.open&&(e.rotation=270):e.south==this.enumSides.open&&(e.west==this.enumSides.open?e.rotation=90:e.east==this.enumSides.open&&(e.rotation=0))},showThreeWay:function(e){e.sprite=this.threeway,e.north==this.enumSides.wall||e.north==this.enumSides.block?e.rotation=0:e.east==this.enumSides.wall||e.east==this.enumSides.block?e.rotation=90:e.south==this.enumSides.wall||e.south==this.enumSides.block?e.rotation=180:e.west==this.enumSides.wall||e.west==this.enumSides.block?e.rotation=270:console.error("ERROR: no wall",e)},showFourWay:function(e){e.sprite=this.fourway,e.rotation=0},makeWall:function(e){e.north==this.enumSides[void 0]&&(e.north=this.enumSides.wall),e.south==this.enumSides[void 0]&&(e.south=this.enumSides.wall),e.east==this.enumSides[void 0]&&(e.east=this.enumSides.wall),e.west==this.enumSides[void 0]&&(e.west=this.enumSides.wall)},buildMaze:function(e,i){this.buildStack.push({x:e,y:i});var n=this.grid[e][i],t=this.findPath(n);if(0==t){if(n.tile==this.enumTile[void 0]&&(n.tile=this.enumTile.deadend),this.buildStack.pop(),0<this.buildStack.length){var s=this.buildStack.pop();this.buildMaze(s.x,s.y)}}else{if(n.tile==this.enumTile[void 0]){n.tile=this.enumTile.corridor;var o=Math.floor(100*Math.random()+1);if(o<=5&&n.content==this.enumContent.empty){var a=Math.floor(100*Math.random()+1),r=Math.min(25,window.gameSession.level);0==window.gameSession.level%5&&a<=1?n.content=this.enumContent.darkness:a<=25+r?(n.content=this.enumContent.danger,n.contentType=Math.floor(6*Math.random()+1),this.dangersType[n.contentType-1]++,this.trapsQtd[n.contentType-1].string=this.dangersType[n.contentType-1],this.dangers++,this.trapFinder.string=this.dangers):(n.content=this.enumContent.treasure,this.treasures++,this.treasureHunter.string=this.treasures)}else o<=10&&n.content==this.enumContent.empty&&(n.content=this.enumContent.monster,this.monsters++,this.tracker.string=this.monsters)}var d=Math.floor(Math.random()*t+1);this.makePath(e,i,d)}},makePath:function(e,i,n){var t=this.grid[e][i],s=0;return t.north==this.enumSides[void 0]&&s++,s==n?(t.north=this.enumSides.open,this.grid[e-1][i].south=this.enumSides.open,void this.buildMaze(e-1,i)):(t.east==this.enumSides[void 0]&&s++,s==n?(t.east=this.enumSides.open,this.grid[e][i+1].west=this.enumSides.open,void this.buildMaze(e,i+1)):(t.south==this.enumSides[void 0]&&s++,s==n?(t.south=this.enumSides.open,this.grid[e+1][i].north=this.enumSides.open,void this.buildMaze(e+1,i)):(t.west==this.enumSides[void 0]&&s++,s==n?(t.west=this.enumSides.open,this.grid[e][i-1].east=this.enumSides.open,void this.buildMaze(e,i-1)):void 0)))},findPath:function(e){var i=0;return e.north==this.enumSides[void 0]&&this.isPathFree("north",e,e.x-1,e.y)?i++:e.north==this.enumSides[void 0]&&(e.north=this.enumSides.wall),e.south==this.enumSides[void 0]&&this.isPathFree("south",e,e.x+1,e.y)?i++:e.south==this.enumSides[void 0]&&(e.south=this.enumSides.wall),e.east==this.enumSides[void 0]&&this.isPathFree("east",e,e.x,e.y+1)?i++:e.east==this.enumSides[void 0]&&(e.east=this.enumSides.wall),e.west==this.enumSides[void 0]&&this.isPathFree("west",e,e.x,e.y-1)?i++:e.west==this.enumSides[void 0]&&(e.west=this.enumSides.wall),i},isPathFree:function(e,i,n,t){if(i[e]==this.enumSides.block)return!1;var s=this.grid[n][t];return s.tile!=this.enumTile.deadend&&s.tile!=this.enumTile.corridor&&(s.tile==this.enumTile[void 0]||s.tile==this.enumTile.exit)},setDoorDirection:function(e){var i=Math.floor(4*Math.random()+1),n=Math.floor(Math.random()*Math.floor(this.size/2));switch(i){case 1:this.makeDoors(0,Math.floor(Math.random()*e),e-1-n,Math.floor(Math.random()*e));break;case 2:this.makeDoors(e-1,Math.floor(Math.random()*e),0+n,Math.floor(Math.random()*e));break;case 3:this.makeDoors(Math.floor(Math.random()*e),0,Math.floor(Math.random()*e),e-1-n);break;case 4:this.makeDoors(Math.floor(Math.random()*e),e-1,Math.floor(Math.random()*e),0+n)}},setLever:function(e){var i=Math.floor(Math.random()*(e-2)+1),n=Math.floor(Math.random()*(e-2)+1);this.grid[i][n].content=this.enumContent.lever},makeDoors:function(e,i,n,t){var s=this.grid[e][i];s.tile=this.enumTile.entrance,s.status=this.enumStatus.visible,this.entrance={x:e,y:i},(s=this.grid[n][t]).tile=this.enumTile.exit,this.exit={x:n,y:t}},showFeedback:function(e,i,n,t){var s=cc.instantiate(this.feedbackPrefab);s.parent=this.canvas,s.color=i;var o=n.parent.convertToWorldSpaceAR(n.position);o=this.canvas.convertToNodeSpaceAR(o),s.x=o.x,s.y=o.y,s.getComponent(cc.Label).string=e;var a=void 0;a=t?cc.sequence(cc.moveBy(2,cc.v2(0,100)),cc.fadeOut(2),cc.callFunc(this.removeFeedback,this,s)):cc.sequence(cc.spawn(cc.moveBy(2,cc.v2(0,100)),cc.fadeOut(2)),cc.callFunc(this.removeFeedback,this,s)),s.runAction(a);var r=cc.instantiate(this.logPrefab);r.parent=this.feedbackLog,r.getComponent(cc.Label).string=e,r.color=i},removeFeedback:function(e){e.destroy()},update:function(e){this.running&&(this.timeToRun-=e,this.timeToRun<0&&(this.startRunning(),this.run(this.size)))}});cc._RF.pop()},{}],inventoryController:[function(e,i,n){"use strict";cc._RF.push(i,"417d1Ks4C1G6rI6w1DtonjZ","inventoryController"),cc.Class({extends:cc.Component,properties:{inventoryFire:cc.Label,inventoryIce:cc.Label,inventoryAcid:cc.Label,inventoryElectricity:cc.Label,inventorySpikes:cc.Label,inventoryPoison:cc.Label,inventoryPotion:cc.Label,popups:[cc.Node]},onEnable:function(){this.updateLabel("fire"," Shield"),this.updateLabel("ice"," Shield"),this.updateLabel("acid"," Shield"),this.updateLabel("electricity"," Shield"),this.updateLabel("spikes"," Shield"),this.updateLabel("poison"," Shield"),this.updateLabel("potion","")},start:function(){},updateLabel:function(e,i){var n=this.jsUcfirst(e);this["inventory"+n].string=n+i+": "+window.gameSession.inventory[e]+"/"+window.gameSession.inventory[e+"Max"]},jsUcfirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},close:function(){this.node.active=!1,window.gameGlobals.popup=!1},open:function(){if(!(window.gameSession.hp<1)){for(var e=0;e<this.popups.length;e++)this.popups[e].active=!1;this.node.active=!0,window.gameGlobals.popup=!0}}}),cc._RF.pop()},{}],jobController:[function(e,i,n){"use strict";cc._RF.push(i,"27833am8SxCGaYvkSU/1GHv","jobController"),cc.Class({extends:cc.Component,properties:{jobPrefab:cc.Prefab,popups:[cc.Node],icons:[cc.SpriteFrame]},start:function(){this.enumClass={undefined:0,rogue:1,fighter:2,wizard:3}},setClass:function(e,i){window.analytics.Design_event("class:"+i),window.gameSession.job=this.enumClass[i],this.saveGame(),this.close()},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},close:function(){this.node.active=!1,window.gameGlobals.popup=!1},open:function(){if(!(window.gameSession.hp<1)){for(var e=0;e<this.popups.length;e++)this.popups[e].active=!1;this.node.active=!0,window.gameGlobals.popup=!0}}}),cc._RF.pop()},{}],loadingController:[function(e,i,n){"use strict";cc._RF.push(i,"eb052hXqyVDe45o+9GyjV2u","loadingController");var t=e("analytics");cc.Class({extends:cc.Component,properties:{analytics:t,sprite:cc.Sprite,tutorial:[cc.SpriteFrame],animated:cc.Node},start:function(){this.saveLoaded=!1,this.timer=0,this.animate();this.index=0;this.initSession({major:0,minor:5,fix:0}),this.saveLoaded=!0},verifyUpdate:function(e){0==e.major&&1==e.minor&&this.updateV2(),0==e.major&&2==e.minor&&this.updateV3(),0==e.major&&3==e.minor&&this.updateV4(),0==e.major&&4==e.minor&&e.fix<=2&&this.updateV4b(),0==e.major&&4==e.minor&&2<e.fix&&this.updateV5()},initSession:function(e){if(this.loadGame(),window.gameGlobals={},null!=window.gameSession)return window.gameSession.saveVersion||(window.gameSession.saveVersion={major:0,minor:1,fix:0}),void this.verifyUpdate(window.gameSession.saveVersion);window.gameSession={},window.gameSession.xp=0,window.gameSession.currency=0,window.gameSession.hp=3,window.gameSession.hpMax=3,window.gameSession.level=1,window.gameSession.levelMin=1,window.gameSession.treasureHunter=!1,window.gameSession.trapFinder=!1,window.gameSession.tracker=!1,window.gameSession.inventory={},window.gameSession.inventory.fire=0,window.gameSession.inventory.fireMin=0,window.gameSession.inventory.fireMax=3,window.gameSession.inventory.ice=0,window.gameSession.inventory.iceMin=0,window.gameSession.inventory.iceMax=3,window.gameSession.inventory.acid=0,window.gameSession.inventory.acidMin=0,window.gameSession.inventory.acidMax=3,window.gameSession.inventory.electricity=0,window.gameSession.inventory.electricityMin=0,window.gameSession.inventory.electricityMax=3,window.gameSession.inventory.spikes=0,window.gameSession.inventory.spikesMin=0,window.gameSession.inventory.spikesMax=3,window.gameSession.inventory.poison=0,window.gameSession.inventory.poisonMin=0,window.gameSession.inventory.poisonMax=3,window.gameSession.inventory.potion=0,window.gameSession.inventory.potionMin=0,window.gameSession.inventory.potionMax=3,window.gameSession.inventory.melee=1,window.gameSession.inventory.ranged=1,window.gameSession.inventory.magic=1,window.gameSession.upgrades={},window.gameSession.upgrades.fireMin=1e3,window.gameSession.upgrades.fireMax=1e3,window.gameSession.upgrades.iceMin=1e3,window.gameSession.upgrades.iceMax=1e3,window.gameSession.upgrades.acidMin=1e3,window.gameSession.upgrades.acidMax=1e3,window.gameSession.upgrades.electricityMin=1e3,window.gameSession.upgrades.electricityMax=1e3,window.gameSession.upgrades.spikesMin=1e3,window.gameSession.upgrades.spikesMax=1e3,window.gameSession.upgrades.poisonMin=1e3,window.gameSession.upgrades.poisonMax=1e3,window.gameSession.upgrades.potionMin=1e3,window.gameSession.upgrades.potionMax=1e3,window.gameSession.upgrades.hpMax=1e3,window.gameSession.upgrades.levelMin=1e3,window.gameSession.upgrades.info=1e3,window.gameSession.upgrades.melee=1e3,window.gameSession.upgrades.ranged=1e3,window.gameSession.upgrades.magic=1e3,window.gameSession.stats={},window.gameSession.stats.unique={},window.gameSession.stats.death={},window.gameSession.stats.death.total=0,window.gameSession.stats.death.fire=0,window.gameSession.stats.death.ice=0,window.gameSession.stats.death.acid=0,window.gameSession.stats.death.electricity=0,window.gameSession.stats.death.spikes=0,window.gameSession.stats.death.poison=0,window.gameSession.stats.death.melee=0,window.gameSession.stats.death.ranged=0,window.gameSession.stats.death.magic=0,window.gameSession.stats.damage={},window.gameSession.stats.damage.total=0,window.gameSession.stats.damage.fire=0,window.gameSession.stats.damage.ice=0,window.gameSession.stats.damage.acid=0,window.gameSession.stats.damage.electricity=0,window.gameSession.stats.damage.spikes=0,window.gameSession.stats.damage.poison=0,window.gameSession.stats.damage.melee=0,window.gameSession.stats.damage.ranged=0,window.gameSession.stats.damage.magic=0,window.gameSession.stats.items={},window.gameSession.stats.items.chests=0,window.gameSession.stats.items.total=0,window.gameSession.stats.items.fire=0,window.gameSession.stats.items.ice=0,window.gameSession.stats.items.acid=0,window.gameSession.stats.items.electricity=0,window.gameSession.stats.items.spikes=0,window.gameSession.stats.items.poison=0,window.gameSession.stats.items.potion=0,window.gameSession.stats.kills={},window.gameSession.stats.kills.total=0,window.gameSession.stats.kills.melee=0,window.gameSession.stats.kills.ranged=0,window.gameSession.stats.kills.magic=0,window.gameSession.stats.traps={},window.gameSession.stats.traps.total=0,window.gameSession.stats.traps.fire=0,window.gameSession.stats.traps.ice=0,window.gameSession.stats.traps.acid=0,window.gameSession.stats.traps.electricity=0,window.gameSession.stats.traps.spikes=0,window.gameSession.stats.traps.poison=0,window.gameSession.stats.levelMax=0,window.gameSession.stats.xp=0,window.gameSession.stats.tiles=0,window.gameSession.achievements={},window.gameSession.achievements.unique={},window.gameSession.achievements.death={},window.gameSession.achievements.death.total=0,window.gameSession.achievements.death.fire=0,window.gameSession.achievements.death.ice=0,window.gameSession.achievements.death.acid=0,window.gameSession.achievements.death.electricity=0,window.gameSession.achievements.death.spikes=0,window.gameSession.achievements.death.poison=0,window.gameSession.achievements.death.melee=0,window.gameSession.achievements.death.ranged=0,window.gameSession.achievements.death.magic=0,window.gameSession.achievements.damage={},window.gameSession.achievements.damage.total=0,window.gameSession.achievements.damage.fire=0,window.gameSession.achievements.damage.ice=0,window.gameSession.achievements.damage.acid=0,window.gameSession.achievements.damage.electricity=0,window.gameSession.achievements.damage.spikes=0,window.gameSession.achievements.damage.poison=0,window.gameSession.achievements.damage.melee=0,window.gameSession.achievements.damage.ranged=0,window.gameSession.achievements.damage.magic=0,window.gameSession.achievements.items={},window.gameSession.achievements.items.chests=0,window.gameSession.achievements.items.total=0,window.gameSession.achievements.items.fire=0,window.gameSession.achievements.items.ice=0,window.gameSession.achievements.items.acid=0,window.gameSession.achievements.items.electricity=0,window.gameSession.achievements.items.spikes=0,window.gameSession.achievements.items.poison=0,window.gameSession.achievements.items.potion=0,window.gameSession.achievements.kills={},window.gameSession.achievements.kills.total=0,window.gameSession.achievements.kills.melee=0,window.gameSession.achievements.kills.ranged=0,window.gameSession.achievements.kills.magic=0,window.gameSession.achievements.traps={},window.gameSession.achievements.traps.total=0,window.gameSession.achievements.traps.fire=0,window.gameSession.achievements.traps.ice=0,window.gameSession.achievements.traps.acid=0,window.gameSession.achievements.traps.electricity=0,window.gameSession.achievements.traps.spikes=0,window.gameSession.achievements.traps.poison=0,window.gameSession.achievements.levelMax=0,window.gameSession.achievements.xp=0,window.gameSession.achievements.tiles=0,window.gameSession.tutorial={},window.gameSession.skills={},window.gameSession.skills.treasureHunter=window.gameSession.treasureHunter,window.gameSession.skills.fireShield=0,window.gameSession.skills.iceShield=0,window.gameSession.skills.acidShield=0,window.gameSession.skills.electricityShield=0,window.gameSession.skills.spikesShield=0,window.gameSession.skills.poisonShield=0,window.gameSession.skills.totalShield=0,window.gameSession.skills.trapFinder=window.gameSession.trapFinder,window.gameSession.skills.fireFinder=!1,window.gameSession.skills.iceFinder=!1,window.gameSession.skills.acidFinder=!1,window.gameSession.skills.electricityFinder=!1,window.gameSession.skills.spikesFinder=!1,window.gameSession.skills.poisonFinder=!1,window.gameSession.skills.tracker=window.gameSession.tracker,window.gameSession.skills.meleeTracker=!1,window.gameSession.skills.rangedTracker=!1,window.gameSession.skills.magicTracker=!1,window.gameSession.job=0;var i=new Date;window.gameSession.date={d:i.getDate(),m:i.getMonth(),y:i.getFullYear()},window.gameSession.saveVersion=e},loadGame:function(){window.gameSession=JSON.parse(cc.sys.localStorage.getItem("gameSession"))},next:function(){cc.director.loadScene("gameScene")},updateV2:function(){window.gameSession.treasures=0,window.gameSession.traps=0,window.gameSession.treasureHunter=!1,window.gameSession.trapFinder=!1,window.gameSession.saveVersion={major:0,minor:2,fix:0}},updateV3:function(){window.gameSession.tracker=!1,window.gameSession.inventory.melee=1,window.gameSession.inventory.ranged=1,window.gameSession.inventory.magic=1,window.gameSession.upgrades.melee=1e3,window.gameSession.upgrades.ranged=1e3,window.gameSession.upgrades.magic=1e3,window.gameSession.stats={},window.gameSession.stats.death={},window.gameSession.stats.death.total=0,window.gameSession.stats.death.fire=0,window.gameSession.stats.death.ice=0,window.gameSession.stats.death.acid=0,window.gameSession.stats.death.electricity=0,window.gameSession.stats.death.spikes=0,window.gameSession.stats.death.poison=0,window.gameSession.stats.death.melee=0,window.gameSession.stats.death.ranged=0,window.gameSession.stats.death.magic=0,window.gameSession.stats.damage={},window.gameSession.stats.damage.total=0,window.gameSession.stats.damage.fire=0,window.gameSession.stats.damage.ice=0,window.gameSession.stats.damage.acid=0,window.gameSession.stats.damage.electricity=0,window.gameSession.stats.damage.spikes=0,window.gameSession.stats.damage.poison=0,window.gameSession.stats.damage.melee=0,window.gameSession.stats.damage.ranged=0,window.gameSession.stats.damage.magic=0,window.gameSession.stats.items={},window.gameSession.stats.items.chests=window.gameSession.treasures,window.gameSession.stats.items.total=0,window.gameSession.stats.items.fire=0,window.gameSession.stats.items.ice=0,window.gameSession.stats.items.acid=0,window.gameSession.stats.items.electricity=0,window.gameSession.stats.items.spikes=0,window.gameSession.stats.items.poison=0,window.gameSession.stats.items.potion=0,window.gameSession.stats.kills={},window.gameSession.stats.kills.total=0,window.gameSession.stats.kills.melee=0,window.gameSession.stats.kills.ranged=0,window.gameSession.stats.kills.magic=0,window.gameSession.stats.traps={},window.gameSession.stats.traps.total=window.gameSession.traps,window.gameSession.stats.traps.fire=0,window.gameSession.stats.traps.ice=0,window.gameSession.stats.traps.acid=0,window.gameSession.stats.traps.electricity=0,window.gameSession.stats.traps.spikes=0,window.gameSession.stats.traps.poison=0,window.gameSession.stats.unique={},window.gameSession.stats.levelMax=window.gameSession.levelMax,window.gameSession.stats.xp=0,window.gameSession.stats.tiles=0,window.gameSession.achievements={},window.gameSession.achievements.death={},window.gameSession.achievements.death.total=0,window.gameSession.achievements.death.fire=0,window.gameSession.achievements.death.ice=0,window.gameSession.achievements.death.acid=0,window.gameSession.achievements.death.electricity=0,window.gameSession.achievements.death.spikes=0,window.gameSession.achievements.death.poison=0,window.gameSession.achievements.death.melee=0,window.gameSession.achievements.death.ranged=0,window.gameSession.achievements.death.magic=0,window.gameSession.achievements.damage={},window.gameSession.achievements.damage.total=0,window.gameSession.achievements.damage.fire=0,window.gameSession.achievements.damage.ice=0,window.gameSession.achievements.damage.acid=0,window.gameSession.achievements.damage.electricity=0,window.gameSession.achievements.damage.spikes=0,window.gameSession.achievements.damage.poison=0,window.gameSession.achievements.damage.melee=0,window.gameSession.achievements.damage.ranged=0,window.gameSession.achievements.damage.magic=0,window.gameSession.achievements.items={},window.gameSession.achievements.items.chests=0,window.gameSession.achievements.items.total=0,window.gameSession.achievements.items.fire=0,window.gameSession.achievements.items.ice=0,window.gameSession.achievements.items.acid=0,window.gameSession.achievements.items.electricity=0,window.gameSession.achievements.items.spikes=0,window.gameSession.achievements.items.poison=0,window.gameSession.achievements.items.potion=0,window.gameSession.achievements.kills={},window.gameSession.achievements.kills.total=0,window.gameSession.achievements.kills.melee=0,window.gameSession.achievements.kills.ranged=0,window.gameSession.achievements.kills.magic=0,window.gameSession.achievements.traps={},window.gameSession.achievements.traps.total=0,window.gameSession.achievements.traps.fire=0,window.gameSession.achievements.traps.ice=0,window.gameSession.achievements.traps.acid=0,window.gameSession.achievements.traps.electricity=0,window.gameSession.achievements.traps.spikes=0,window.gameSession.achievements.traps.poison=0,window.gameSession.achievements.unique={},window.gameSession.achievements.levelMax=0,window.gameSession.achievements.xp=0,window.gameSession.achievements.tiles=0,window.gameSession.saveVersion={major:0,minor:3,fix:0}},updateV4:function(){window.gameSession.tutorial={},window.gameSession.skills={},window.gameSession.skills.treasureHunter=window.gameSession.treasureHunter,window.gameSession.skills.fireShield=0,window.gameSession.skills.iceShield=0,window.gameSession.skills.acidShield=0,window.gameSession.skills.electricityShield=0,window.gameSession.skills.spikesShield=0,window.gameSession.skills.poisonShield=0,window.gameSession.skills.totalShield=0,window.gameSession.skills.trapFinder=window.gameSession.trapFinder,window.gameSession.skills.fireFinder=!1,window.gameSession.skills.iceFinder=!1,window.gameSession.skills.acidFinder=!1,window.gameSession.skills.electricityFinder=!1,window.gameSession.skills.spikesFinder=!1,window.gameSession.skills.poisonFinder=!1,window.gameSession.skills.tracker=window.gameSession.tracker,window.gameSession.skills.meleeTracker=!1,window.gameSession.skills.rangedTracker=!1,window.gameSession.skills.magicTracker=!1,window.gameSession.job=0,window.gameSession.saveVersion={major:0,minor:4,fix:0}},updateV4b:function(){window.gameSession.tutorial||(window.gameSession.tutorial={}),window.gameSession.skills||(window.gameSession.skills={},window.gameSession.skills.treasureHunter=window.gameSession.treasureHunter,window.gameSession.skills.fireShield=0,window.gameSession.skills.iceShield=0,window.gameSession.skills.acidShield=0,window.gameSession.skills.electricityShield=0,window.gameSession.skills.spikesShield=0,window.gameSession.skills.poisonShield=0,window.gameSession.skills.totalShield=0,window.gameSession.skills.trapFinder=window.gameSession.trapFinder,window.gameSession.skills.fireFinder=!1,window.gameSession.skills.iceFinder=!1,window.gameSession.skills.acidFinder=!1,window.gameSession.skills.electricityFinder=!1,window.gameSession.skills.spikesFinder=!1,window.gameSession.skills.poisonFinder=!1,window.gameSession.skills.tracker=window.gameSession.tracker,window.gameSession.skills.meleeTracker=!1,window.gameSession.skills.rangedTracker=!1,window.gameSession.skills.magicTracker=!1),window.gameSession.job||(window.gameSession.job=0),window.gameSession.saveVersion={major:0,minor:4,fix:3}},updateV5:function(){var e=new Date;window.gameSession.date={d:e.getDate(),m:e.getMonth(),y:e.getFullYear()},window.gameSession.saveVersion={major:0,minor:5,fix:0}},animate:function(){var e=cc.sequence(cc.moveBy(.1,cc.v2(-100,0)),cc.moveBy(.2,cc.v2(0,200)),cc.moveBy(.2,cc.v2(-200,0)),cc.moveBy(.4,cc.v2(0,-400)),cc.moveBy(.2,cc.v2(200,0)),cc.moveBy(.2,cc.v2(0,200)),cc.moveBy(.2,cc.v2(200,0)),cc.moveBy(.2,cc.v2(0,200)),cc.moveBy(.2,cc.v2(200,0)),cc.moveBy(.4,cc.v2(0,-400)),cc.moveBy(.2,cc.v2(-200,0)),cc.moveBy(.2,cc.v2(0,200)),cc.moveBy(.1,cc.v2(-100,0)));this.animated.runAction(cc.repeatForever(e))},update:function(e){this.timer+=e,this.saveLoaded&&this.analytics.Analytics_Ready()&&(this.saveLoaded=!1,this.next()),30<this.timer&&this.saveLoaded&&(this.saveLoaded=!1,cc.log("Analytics is taking too long"),this.next())}}),cc._RF.pop()},{analytics:"analytics"}],logController:[function(e,i,n){"use strict";cc._RF.push(i,"e14cbLjOG5L8JgGJDveC/6v","logController"),cc.Class({extends:cc.Component,properties:{popups:[cc.Node]},onEnable:function(){},start:function(){},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},close:function(){this.node.active=!1,window.gameGlobals.popup=!1},open:function(){if(!(window.gameSession.hp<1)){for(var e=0;e<this.popups.length;e++)this.popups[e].active=!1;this.node.active=!0,window.gameGlobals.popup=!0}}}),cc._RF.pop()},{}],rewardController:[function(e,i,n){"use strict";cc._RF.push(i,"6cf2bszDFtBvIkJL8O0GFNP","rewardController"),cc.Class({extends:cc.Component,properties:{reward:cc.Label},onEnable:function(){this.reward.string=window.gameGlobals.xpReward+"XP"},start:function(){},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},close:function(){this.node.active=!1,window.gameGlobals.popup=!1},open:function(){this.node.active=!0,window.gameGlobals.popup=!0}}),cc._RF.pop()},{}],tutorialController:[function(e,i,n){"use strict";cc._RF.push(i,"ea3e5sNQUVBsJin+etBB5Q2","tutorialController"),cc.Class({extends:cc.Component,properties:{popups:[cc.Node]},onEnable:function(){},start:function(){},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},close:function(){this.node.active=!1,window.gameGlobals.popup=!1},open:function(){if(!(window.gameSession.hp<1)){for(var e=0;e<this.popups.length;e++)this.popups[e].active=!1;this.node.active=!0,window.gameGlobals.popup=!0}}}),cc._RF.pop()},{}],upgradeController:[function(e,i,n){"use strict";cc._RF.push(i,"c4e2cji+KROBamtHwGOccSx","upgradeController");cc.Class({extends:cc.Component,properties:{grid:cc.Node,canvas:cc.Node,dungeonAchievement:cc.Node,feedbackLog:cc.Node,button:cc.Prefab,feedbackPrefab:cc.Prefab,logPrefab:cc.Prefab,dungeonXP:cc.Label,inventoryFire:cc.Label,inventoryIce:cc.Label,inventoryAcid:cc.Label,inventoryElectricity:cc.Label,inventorySpikes:cc.Label,inventoryPoison:cc.Label,inventoryPotion:cc.Label,popups:[cc.Node],icons:[cc.SpriteFrame]},start:function(){this.setButtons()},onEnable:function(){this.checkSecretPassage(),this.checkSpecialButton(window.gameSession.stats.traps.total,window.gameSession.trapFinder,this.trapFinder),this.checkSpecialButton(window.gameSession.stats.traps.fire,window.gameSession.fireFinder,this.fireFinder),this.checkSpecialButton(window.gameSession.stats.traps.ice,window.gameSession.iceFinder,this.iceFinder),this.checkSpecialButton(window.gameSession.stats.traps.acid,window.gameSession.acidFinder,this.acidFinder),this.checkSpecialButton(window.gameSession.stats.traps.electricity,window.gameSession.electricityFinder,this.electricityFinder),this.checkSpecialButton(window.gameSession.stats.traps.spikes,window.gameSession.spikesFinder,this.spikesFinder),this.checkSpecialButton(window.gameSession.stats.traps.poison,window.gameSession.poisonFinder,this.poisonFinder),this.checkSpecialButton(window.gameSession.stats.items.chests,window.gameSession.treasureHunter,this.treasureHunter),this.checkSpecialButton(window.gameSession.stats.kills.total,window.gameSession.tracker,this.tracker),this.checkPermanentShield("fire"),this.checkPermanentShield("ice"),this.checkPermanentShield("acid"),this.checkPermanentShield("electricity"),this.checkPermanentShield("spikes"),this.checkPermanentShield("poison"),this.checkPermanentShield("total")},setButtons:function(){window.gameSession&&(this.createButton("Fire Protection","fireMin","fire","Starting amount of Fire Shields",0,1,0),this.createButton("Ice Protection","iceMin","ice","Starting amount of Ice Shields",0,1,0),this.createButton("Acid Protection","acidMin","acid","Starting amount of Acid Shields",0,1,0),this.createButton("Electricity Protection","electricityMin","electricity","Starting amount of Electricity Shields",0,1,0),this.createButton("Spikes Protection","spikesMin","spikes","Starting amount of Spikes Shields",0,1,0),this.createButton("Poison Protection","poisonMin","poison","Starting amount of Poison Shields",0,1,0),this.createButton("Fire Pocket","fireMax",null,"Maximum amount of Fire Shields",1,1,3),this.createButton("Ice Pocket","iceMax",null,"Maximum amount of Ice Shields",1,1,3),this.createButton("Acid Pocket","acidMax",null,"Maximum amount of Acid Shields",1,1,3),this.createButton("Electricity Pocket","electricityMax",null,"Maximum amount of Electricity Shields",1,1,3),this.createButton("Spikes Pocket","spikesMax",null,"Maximum amount of Spikes Shields",1,1,3),this.createButton("Poison Pocket","poisonMax",null,"Maximum amount of Poison Shields",1,1,3),this.createButton("Starting Potion","potionMin","potion","Starting amount of Potions",3,1,0),this.createButton("Potion Pocket","potionMax",null,"Maximum amount of Potions",1,1,3),this.createButton("Health Points","hpMax",null,"Increases maximum HP",2,1,3),this.createButton("Sword Skill","melee",null,"Increases skill with swords",5,2,1),this.createButton("Bow Skill","ranged",null,"Increases skill with bows",6,2,1),this.createButton("Wand Skill","magic",null,"Increases skill with wands",7,2,1),this.createSecretPassageButton(),this.checkSecretPassage(),this.createSpecialButton("trapFinder","Trap Finder","Find how many traps exist in a floor.","upgradeTrapFinder"),this.checkSpecialButton(window.gameSession.stats.traps.total,window.gameSession.trapFinder,this.trapFinder),this.createSpecialButton("fireFinder","Fire Finder","Find how many fire traps exist in a floor.","upgradeFireFinder"),this.checkSpecialButton(window.gameSession.stats.traps.fire,window.gameSession.fireFinder,this.fireFinder),this.createSpecialButton("iceFinder","Ice Finder","Find how many ice traps exist in a floor.","upgradeIceFinder"),this.checkSpecialButton(window.gameSession.stats.traps.ice,window.gameSession.iceFinder,this.iceFinder),this.createSpecialButton("acidFinder","Acid Finder","Find how many acid traps exist in a floor.","upgradeAcidFinder"),this.checkSpecialButton(window.gameSession.stats.traps.acid,window.gameSession.acidFinder,this.acidFinder),this.createSpecialButton("electricityFinder","Electricity Finder","Find how many electricity traps exist in a floor.","upgradeElectricityFinder"),this.checkSpecialButton(window.gameSession.stats.traps.electricity,window.gameSession.electricityFinder,this.electricityFinder),this.createSpecialButton("spikesFinder","Spikes Finder","Find how many spikes traps exist in a floor.","upgradeSpikesFinder"),this.checkSpecialButton(window.gameSession.stats.traps.spikes,window.gameSession.spikesFinder,this.spikesFinder),this.createSpecialButton("poisonFinder","Poison Finder","Find how many poison traps exist in a floor.","upgradePoisonFinder"),this.checkSpecialButton(window.gameSession.stats.traps.poison,window.gameSession.poisonFinder,this.poisonFinder),this.createSpecialButton("treasureHunter","Treasure Hunter","Find how many chests exist in a floor.","upgradeTreasureHunter"),this.checkSpecialButton(window.gameSession.stats.items.chests,window.gameSession.treasureHunter,this.treasureHunter),this.createSpecialButton("tracker","Tracker","Find how many enemies are in a floor.","upgradeTracker"),this.checkSpecialButton(window.gameSession.stats.kills.total,window.gameSession.tracker,this.tracker),this.createPermanentShield("Fireproof","Permanent fire shield","fire",8),this.checkPermanentShield("fire"),this.createPermanentShield("Freezeproof","Permanent ice shield","ice",8),this.checkPermanentShield("ice"),this.createPermanentShield("Non-corrosive","Permanent acid shield","acid",8),this.checkPermanentShield("acid"),this.createPermanentShield("Ground Wire","Permanent electricity shield","electricity",8),this.checkPermanentShield("electricity"),this.createPermanentShield("Impenetrable","Permanent spikes shield","spikes",8),this.checkPermanentShield("spikes"),this.createPermanentShield("Mithridatism","Permanent poison shield","poison",8),this.checkPermanentShield("poison"),this.createPermanentShield("Scavenger","Increase itens got by chest","total",9),this.checkPermanentShield("total"))},createPermanentShield:function(e,i,n,t){var s=cc.instantiate(this.button);s.parent=this.grid,s.getChildByName("Name").getComponent(cc.Label).string=e,s.getChildByName("Description").getComponent(cc.Label).string=i,s.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.skills[n+"Shield"],s.getChildByName("Price").getComponent(cc.Label).string=5e3*(window.gameSession.skills[n+"Shield"]+1)+"XP",s.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[t],s.field=n;var o=new cc.Component.EventHandler;o.target=this.node,o.component="upgradeController",o.handler="permanentShield",s.getComponent(cc.Button).clickEvents.push(o),this["perm"+n]=s},checkPermanentShield:function(e){window.gameSession.skills[e+"Shield"]<window.gameSession.achievements.items[e]&&this["perm"+e]?this["perm"+e].active=!0:this["perm"+e]&&(this["perm"+e].active=!1)},permanentShield:function(e){var i=e.target,n=i.field,t=5e3*(window.gameSession.skills[n+"Shield"]+1);window.gameSession.xp>=t&&(window.gameSession.xp-=t,window.gameSession.stats.xp+=t,window.gameSession.stats.xp%1e5==0&&this.showFeedback("Achievement: High Level",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonXP.string=window.gameSession.xp,window.gameSession.skills[n+"Shield"]++,window.analytics.Design_event("upgrade:permanentShield:"+n,window.gameSession.skills[n+"Shield"]),i.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.skills[n+"Shield"],i.getChildByName("Price").getComponent(cc.Label).string=t+5e3+"XP",this.saveGame()),this.checkPermanentShield(n)},createSpecialButton:function(e,i,n,t){var s=cc.instantiate(this.button);s.parent=this.grid,(this[e]=s).getChildByName("Name").getComponent(cc.Label).string=i,s.getChildByName("Description").getComponent(cc.Label).string=n,s.getChildByName("Value").getComponent(cc.Label).string=0,s.getChildByName("Price").getComponent(cc.Label).string="5000XP",s.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[4];var o=new cc.Component.EventHandler;o.target=this.node,o.component="upgradeController",o.handler=t,s.getComponent(cc.Button).clickEvents.push(o)},checkSpecialButton:function(e,i,n){99<e&&!i&&n?n.active=!0:n&&(n.active=!1)},upgradeSpecial:function(e,i){var n=e.target;5e3<=window.gameSession.xp&&(window.analytics.Design_event("upgrade:special:"+i),window.gameSession.xp-=5e3,window.gameSession.stats.xp+=5e3,window.gameSession.stats.xp%1e5==0&&this.showFeedback("Achievement: High Level",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonXP.string=window.gameSession.xp,window.gameSession[i]=!0,n.getChildByName("Value").getComponent(cc.Label).string=1,n.getChildByName("Price").getComponent(cc.Label).string="5000XP",this.saveGame())},upgradeFireFinder:function(e){this.upgradeSpecial(e,"fireFinder"),this.checkSpecialButton(window.gameSession.stats.traps.fire,window.gameSession.fireFinder,this.fireFinder)},upgradeIceFinder:function(e){this.upgradeSpecial(e,"iceFinder"),this.checkSpecialButton(window.gameSession.stats.traps.ice,window.gameSession.iceFinder,this.iceFinder)},upgradeAcidFinder:function(e){this.upgradeSpecial(e,"acidFinder"),this.checkSpecialButton(window.gameSession.stats.traps.acid,window.gameSession.acidFinder,this.acidFinder)},upgradeElectricityFinder:function(e){this.upgradeSpecial(e,"electricityFinder"),this.checkSpecialButton(window.gameSession.stats.traps.electricity,window.gameSession.electricityFinder,this.electricityFinder)},upgradeSpikesFinder:function(e){this.upgradeSpecial(e,"spikesFinder"),this.checkSpecialButton(window.gameSession.stats.traps.spikes,window.gameSession.spikesFinder,this.spikesFinder)},upgradePoisonFinder:function(e){this.upgradeSpecial(e,"poisonFinder"),this.checkSpecialButton(window.gameSession.stats.traps.poison,window.gameSession.poisonFinder,this.poisonFinder)},upgradeTrapFinder:function(e){this.upgradeSpecial(e,"trapFinder"),this.checkSpecialButton(window.gameSession.stats.traps.total,window.gameSession.trapFinder,this.trapFinder)},upgradeTreasureHunter:function(e){this.upgradeSpecial(e,"treasureHunter"),this.checkSpecialButton(window.gameSession.stats.items.chests,window.gameSession.treasureHunter,this.treasureHunter)},upgradeTracker:function(e){this.upgradeSpecial(e,"tracker"),this.checkSpecialButton(window.gameSession.stats.kills.total,window.gameSession.tracker,this.tracker)},createSecretPassageButton:function(){var e=cc.instantiate(this.button);e.parent=this.grid,(this.secretPassage=e).getChildByName("Name").getComponent(cc.Label).string="Secret Passage",e.getChildByName("Description").getComponent(cc.Label).string="The floor you start back when you die.",e.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.levelMin,window.gameSession.upgrades.levelMin||(window.gameSession.upgrades.levelMin=1e3),e.getChildByName("Price").getComponent(cc.Label).string=window.gameSession.upgrades.levelMin+"XP",e.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[4];var i=new cc.Component.EventHandler;i.target=this.node,i.component="upgradeController",i.handler="upgradeSecretPassage",e.getComponent(cc.Button).clickEvents.push(i)},checkSecretPassage:function(){window.gameSession.levelMin+5<window.gameSession.stats.levelMax&&this.secretPassage?this.secretPassage.active=!0:this.secretPassage&&(this.secretPassage.active=!1)},upgradeSecretPassage:function(e){var i=e.target;window.gameSession.xp>=window.gameSession.upgrades.levelMin&&(window.gameSession.xp-=window.gameSession.upgrades.levelMin,window.gameSession.stats.xp+=window.gameSession.upgrades.levelMin,window.gameSession.stats.xp%1e5==0&&this.showFeedback("Achievement: High Level",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonXP.string=window.gameSession.xp,1==window.gameSession.levelMin?window.gameSession.levelMin=5:window.gameSession.levelMin+=5,window.analytics.Design_event("upgrade:special:secretPassage",window.gameSession.levelMin),i.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.levelMin,window.gameSession.upgrades.levelMin+=1e3,i.getChildByName("Price").getComponent(cc.Label).string=window.gameSession.upgrades.levelMin+"XP",this.saveGame()),this.checkSecretPassage()},createButton:function(e,i,n,t,s,o,a){var r=cc.instantiate(this.button);r.parent=this.grid,r.getChildByName("Name").getComponent(cc.Label).string=e,r.getChildByName("Description").getComponent(cc.Label).string=t;var d=void 0;null!=window.gameSession.inventory[i]?(r.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.inventory[i],d=window.gameSession.inventory[i]+1):(r.getChildByName("Value").getComponent(cc.Label).string=window.gameSession[i],d=window.gameSession[i]+1),d-=a,window.gameSession.upgrades[i]=1e3*d*o,r.getChildByName("Price").getComponent(cc.Label).string=window.gameSession.upgrades[i]+"XP",r.getChildByName("Icon").getComponent(cc.Sprite).spriteFrame=this.icons[s],r.field=i,r.item=n,r.mult=o,r.start=a;var c=new cc.Component.EventHandler;c.target=this.node,c.component="upgradeController",c.handler="upgrade",r.getComponent(cc.Button).clickEvents.push(c)},upgrade:function(e){var i=e.target,n=i.field;if(window.gameSession.xp>=window.gameSession.upgrades[n]){window.gameSession.xp-=window.gameSession.upgrades[n],window.gameSession.stats.xp+=window.gameSession.upgrades[n],window.gameSession.stats.xp%1e5==0&&this.showFeedback("Achievement: High Level",new cc.Color(0,255,0),this.dungeonAchievement,!0),this.dungeonXP.string=window.gameSession.xp;var t=void 0;null!=window.gameSession.inventory[n]?(window.gameSession.inventory[n]+=1,window.analytics.Design_event("upgrade:common:inventory:"+n,window.gameSession.inventory[n]),t=window.gameSession.inventory[n]+1,i.getChildByName("Value").getComponent(cc.Label).string=window.gameSession.inventory[n],i.item&&this.giveItem(i.item)):(window.gameSession[n]+=1,window.analytics.Design_event("upgrade:common:"+n,window.gameSession[n]),t=window.gameSession[n]+1,i.getChildByName("Value").getComponent(cc.Label).string=window.gameSession[n]),t-=i.start,window.gameSession.upgrades[n]=1e3*t*i.mult,i.getChildByName("Price").getComponent(cc.Label).string=window.gameSession.upgrades[n]+"XP",this.saveGame()}},giveItem:function(e){window.gameSession.inventory[e]+1<=window.gameSession.inventory[e+"Max"]&&window.gameSession.inventory[e]++},saveGame:function(){cc.sys.localStorage.setItem("gameSession",JSON.stringify(window.gameSession))},close:function(){this.node.active=!1,window.gameGlobals.popup=!1},open:function(){if(!(window.gameSession.hp<1)){for(var e=0;e<this.popups.length;e++)this.popups[e].active=!1;this.node.active=!0,window.gameGlobals.popup=!0}},showFeedback:function(e,i,n,t){var s=cc.instantiate(this.feedbackPrefab);s.parent=this.canvas,s.color=i;var o=n.parent.convertToWorldSpaceAR(n.position);o=this.canvas.convertToNodeSpaceAR(o),s.x=o.x,s.y=o.y,s.getComponent(cc.Label).string=e;var a=void 0;a=t?cc.sequence(cc.moveBy(2,cc.v2(0,100)),cc.fadeOut(2),cc.callFunc(this.removeFeedback,this,s)):cc.sequence(cc.spawn(cc.moveBy(2,cc.v2(0,100)),cc.fadeOut(2)),cc.callFunc(this.removeFeedback,this,s)),s.runAction(a);var r=cc.instantiate(this.logPrefab);r.parent=this.feedbackLog,r.getComponent(cc.Label).string=e,r.color=i},removeFeedback:function(e){e.destroy()}});cc._RF.pop()},{}]},{},["analytics","gridController","loadingController","achievementController","deathController","inventoryController","jobController","logController","rewardController","tutorialController","upgradeController"]);